(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-1f3cb16e"],{"114b":function(t,s,i){"use strict";i.d(s,"a",(function(){return a}));i("a7fa"),i("f17d"),i("cac0"),i("0f4e"),i("c9c8"),i("c565"),i("96bb");var e=i("5f87");function a(){var t=this;this.apiUrl="/web.php/chat/sendText",this.onMessage=function(){},this.onError=function(){},this.onFinish=function(){},this.fetchCtrl="",this.outputStacks=[],this.outputSI=0,this.request=function(s){t.fetchCtrl=new AbortController;var i=new Headers;i.append("Content-Type","application/json"),i.append("X-token",Object(e["d"])()||""),i.append("X-site",Object(e["a"])()||""),fetch(this.apiUrl,{method:"POST",headers:i,body:JSON.stringify(s),signal:t.fetchCtrl.signal}).then((function(s){if(s.ok){var i=s.body.getReader(),e=new TextDecoder("utf-8");a(),t.startOutput()}else t.onError(s.statusText);function a(){i.read().then((function(s){var i=s.done,n=s.value;if(i)return t.stopOutput(),void t.onFinish();if(n){var r=e.decode(n);if(r){if(-1!==r.indexOf("[error]"))return t.stopOutput(),t.onError(r.replace("[error]","")),void t.onFinish();for(var o=0;o<r.length;o++)t.outputStacks.push(r[o])}}a()}))}})).catch((function(s){"AbortError"===s.name?(t.stopOutput(),t.onFinish(),console.log("请求已被取消")):console.log("网络错误",s)}))},this.startOutput=function(){t.stopOutput(),t.outputSI=setInterval((function(){t.outputStacks.length>0&&t.onMessage(t.outputStacks.shift())}),24)},this.stopOutput=function(){t.outputSI&&clearInterval(t.outputSI),t.outputSI=0,t.outputStacks.length>0&&t.onMessage(t.outputStacks.join("")),t.outputStacks=[]},this.stop=function(){t.fetchCtrl&&(t.fetchCtrl.abort(),t.fetchCtrl=null),t.stopOutput(),t.onFinish()}}},"96bb":function(t,s,i){"use strict";var e=i("a158"),a=i("9372"),n=i("86aa"),r=i("2663"),o=i("a05b"),c=a([].join),l=n!==Object,u=l||!o("join",",");e({target:"Array",proto:!0,forced:u},{join:function(t){return c(r(this),void 0===t?",":t)}})},a0d8:function(t,s,i){"use strict";i.r(s);var e=function(){var t=this,s=t.$createElement,i=t._self._c||s;return i("div",{staticClass:"module-pk box-chat"},[i("div",{staticClass:"chat-msg style-chat"},[i("div",{staticClass:"box-a"}),i("div",{staticClass:"box-b"}),i("el-scrollbar",{ref:"msglist",attrs:{"wrap-class":"scrollbar-wrapper"}},[t.lists&&t.lists.length>0?i("div",{staticClass:"msg-list"},[t._l(t.lists,(function(s,e){return i("div",{staticClass:"msg-row"},[i("div",{staticClass:"role-a"},[i("div",{staticClass:"row-user"},[i("div",{staticClass:"msg-item"},[i("div",{staticClass:"avatar",staticStyle:{background:"#9aa37e"}},[i("img",{attrs:{src:t.userAvatar,alt:""}})]),i("div",{staticClass:"text markdown-body",domProps:{innerHTML:t._s(t.textToHtml(s.message))}})])]),s.response_a?i("div",{staticClass:"row-ai"},[i("div",{staticClass:"msg-item"},[i("div",{staticClass:"avatar"},[i("img",{attrs:{src:t.aiAvatar,alt:""}})]),i("div",{staticClass:"text markdown-body"},[i("Markdown",{attrs:{text:s.response_a,"show-tools":!0,"show-ppt":t.isPPT(s.message),"show-table":t.isTable(s.message),index:e},on:{retry:function(i){return t.retryRequest(s.message)}}})],1)])]):t._e()]),i("div",{staticClass:"role-b"},[i("div",{staticClass:"row-user"},[i("div",{staticClass:"msg-item"},[i("div",{staticClass:"avatar",staticStyle:{background:"#9aa37e"}},[i("img",{attrs:{src:t.userAvatar,alt:""}})]),i("div",{staticClass:"text markdown-body",domProps:{innerHTML:t._s(t.textToHtml(s.message))}})])]),s.response_b?i("div",{staticClass:"row-ai"},[i("div",{staticClass:"msg-item"},[i("div",{staticClass:"avatar"},[i("img",{attrs:{src:t.aiAvatar}})]),i("div",{staticClass:"text markdown-body"},[i("Markdown",{attrs:{text:s.response_b,"show-tools":!0,"show-ppt":t.isPPT(s.message),"show-table":t.isTable(s.message),index:e},on:{retry:function(i){return t.retryRequest(s.message)}}})],1)])]):t._e()])])})),t.writingA||t.writingTextA||t.writingB||t.writingTextB?i("div",{staticClass:"msg-row"},[i("div",{staticClass:"role-a"},[t.writingA||t.writingTextA?i("div",{staticClass:"row-ai"},[i("div",{staticClass:"msg-item"},[i("div",{staticClass:"avatar"},[i("img",{attrs:{src:t.aiAvatar,alt:""}})]),i("div",{staticClass:"text markdown-body"},[i("Markdown",{attrs:{text:t.writingTextA,writing:t.writingA}})],1)])]):t._e()]),i("div",{staticClass:"role-b"},[t.writingB||t.writingTextB?i("div",{staticClass:"row-ai"},[i("div",{staticClass:"msg-item"},[i("div",{staticClass:"avatar"},[i("img",{attrs:{src:t.aiAvatar,alt:""}})]),i("div",{staticClass:"text markdown-body"},[i("Markdown",{attrs:{text:t.writingTextB,writing:t.writingB}})],1)])]):t._e()])]):t._e()],2):i("div",{staticClass:"msg-list"},[i("div",{staticClass:"msg-row"},[i("div",{staticClass:"role-a"},[i("div",{staticClass:"row-ai"},[i("div",{staticClass:"msg-item"},[i("div",{staticClass:"avatar"},[i("img",{attrs:{src:t.aiAvatar,alt:""}})]),i("div",{staticClass:"text markdown-body"},[t._v(" 请选择一个模型，开始你的提问 ")])])])]),i("div",{staticClass:"role-b"},[i("div",{staticClass:"row-ai"},[i("div",{staticClass:"msg-item"},[i("div",{staticClass:"avatar"},[i("img",{attrs:{src:t.aiAvatar,alt:""}})]),i("div",{staticClass:"text markdown-body"},[t._v(" 请选择一个模型，开始你的提问 ")])])])])])])])],1),i("div",{staticClass:"chat-input"},[i("div",{staticClass:"select"},[i("p",[t._v("选择左侧AI")]),i("el-select",{attrs:{placeholder:"请选择"},on:{change:t.switchAI_A},model:{value:t.aiA,callback:function(s){t.aiA=s},expression:"aiA"}},t._l(t.aiList,(function(t){return i("el-option",{attrs:{label:t.alias,value:t.name}})})),1)],1),i("div",{staticClass:"input"},[i("el-input",{ref:"messageInput",attrs:{placeholder:t._f("lang")("输入您的问题，Ctrl+回车发送"),type:"textarea",autofocus:!0,autosize:{minRows:2,maxRows:8}},nativeOn:{keyup:function(s){return!s.type.indexOf("key")&&t._k(s.keyCode,"enter",13,s.key,"Enter")?null:t.onEnter(s)}},model:{value:t.message,callback:function(s){t.message=s},expression:"message"}}),i("el-button",{staticClass:"btn-send",attrs:{type:"default",loading:t.writingA||t.writingB,title:t._f("lang")("发送")},on:{click:t.createPk}},[t.writingA||t.writingB?t._e():i("i",{staticClass:"el-icon-position"}),t._v(" 发送 ")])],1),i("div",{staticClass:"select"},[i("p",{staticStyle:{"text-align":"right"}},[t._v("选择右侧AI")]),i("el-select",{attrs:{placeholder:"请选择"},on:{change:t.switchAI_B},model:{value:t.aiB,callback:function(s){t.aiB=s},expression:"aiB"}},t._l(t.aiList,(function(t){return i("el-option",{attrs:{label:t.alias,value:t.name}})})),1)],1)])])},a=[],n=i("e089"),r=(i("c9c8"),i("a7fa"),i("d3da"),i("c565"),i("30f8"),i("6db4")),o=i("d800"),c=i("5f87"),l=i("61b2"),u=i("ca00"),d=i("114b"),g=new d["a"],h=new d["a"],f=0,p={name:"Pk",components:{Markdown:l["c"]},data:function(){return{message:"",aiA:"",lists:[],writingTextA:"",writingA:!1,aiB:"",writingTextB:"",writingB:!1,channelA:"",channelB:""}},computed:Object(n["a"])(Object(n["a"])({},Object(r["b"])(["avatar","aiList"])),{},{aiAvatar:function(){return"/static/img/ic_ai.png"},userAvatar:function(){return this.avatar||"/static/img/ic_user.png"}}),mounted:function(){this.setDefaultAI(),this.getHistoryMsg(),this.startAutoFocus(),window.handlInputValue=this.miclinkInput},destroyed:function(){f&&clearInterval(f)},methods:{createPk:function(){var t=this;if(!this.writing&&!this.writingText)if(this.aiA&&this.aiB){var s=Object(u["f"])(this.message);if(!s)return this.$message.error("请输入您的问题"),void(this.message="");Object(o["a"])({message:s,channel_a:this.aiA,channel_b:this.aiB}).then((function(i){var e=i.data.pk_id;t.lists.push({id:e,channel_a:t.aiA,channel_b:t.aiB,message:s,response_a:"",response_b:""}),t.requestAI_A(e,s),t.requestAI_B(e,s),t.message=""})).catch((function(s){403===s.errno&&t.$modals.showLogin()}))}else this.$message.error("请先选择模型")},requestAI_A:function(t,s){this.writingA=!0,this.scrollBottom();var i=this;g.onMessage=function(t){t&&(i.writingTextA+=t,i.scrollBottom())},g.onError=function(t){i.writingA=!1,i.writingTextA="",i.message=s,-1!==t.indexOf("请登录")?(i.$modals.showLogin(),setTimeout((function(){i.$message.error(i.$lang(t))}),500)):-1!==t.indexOf("请充值")?(Object(u["a"])(i.aiA)?i.priceSetting.text40_vip?i.$modals.showPay("vip"):i.$modals.showPay("point"):i.$modals.showPay("vip"),setTimeout((function(){i.$message.error(i.$lang(t))}),500)):i.$alert(t,"系统提示")},g.onFinish=function(){i.writingTextA&&(i.lists[i.lists.length-1].response_a=i.writingTextA),i.writingTextA="",i.writingA=!1},g.request({message:s,ai:this.aiA,pk_id:t,pk_role:"a"})},requestAI_B:function(t,s){this.writingB=!0,this.scrollBottom();var i=this;h.onMessage=function(t){t&&(i.writingTextB+=t,i.scrollBottom())},h.onError=function(t){i.writingB=!1,i.writingTextB="",i.message=s,-1!==t.indexOf("请登录")?(i.$modals.showLogin(),setTimeout((function(){i.$message.error(i.$lang(t))}),500)):-1!==t.indexOf("请充值")?(Object(u["a"])(i.aiB)?i.priceSetting.text40_vip?i.$modals.showPay("vip"):i.$modals.showPay("point"):i.$modals.showPay("vip"),setTimeout((function(){i.$message.error(i.$lang(t))}),500)):i.$alert(t,"系统提示")},h.onFinish=function(){i.writingTextB&&(i.lists[i.lists.length-1].response_b=i.writingTextB),i.writingTextB="",i.writingB=!1},h.request({message:s,ai:this.aiB,pk_id:t,pk_role:"b"})},miclinkInput:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;t&&(this.message=t),2!==s&&3!==s||this.requestAI()},switchAI_A:function(t){this.switchAI("a",t)},switchAI_B:function(t){this.switchAI("b",t)},setDefaultAI:function(){var t=Object(c["b"])("pk_ai_a"),s=Object(c["b"])("pk_ai_b");t&&(this.aiA=t),s&&(this.aiB=s)},switchAI:function(t,s){var i=s;this.aiList.forEach((function(t){t.name===s&&(i=t.alias)})),this.$message.success(("a"===t?"左侧":"右侧")+"已切换至【"+i+"】"),"a"===t?Object(c["g"])("pk_ai_a",s):Object(c["g"])("pk_ai_b",s),this.$refs.messageInput.focus()},startAutoFocus:function(){var t=this;f=setInterval((function(){var s=window.getSelection?window.getSelection():document.selection.createRange().text;if(s.anchorNode){var i=s.anchorNode.className;if(i&&(-1!==i.indexOf("el-input")||-1!==i.indexOf("el-textarea")))return}!s.toString()&&t.$refs.messageInput&&t.$refs.messageInput.focus()}),1e3)},getHistoryMsg:function(){var t=this,s={page:this.page,pagesize:this.pagesize};Object(o["d"])(s).then((function(s){t.lists=s.data.list,t.$nextTick((function(){t.scrollBottom()}))}))},onEnter:function(t){return t.ctrlKey&&this.createPk(),!1},retryRequest:function(t){this.message=t,this.createPk()},stopRequest:function(){var t=this;g.stop(),setTimeout((function(){t.writingTextA&&(t.lists[t.lists.length-1].response_a=t.writingTextA),t.writingTextA="",t.writingA=!1}),50),h.stop(),setTimeout((function(){t.writingTextB&&(t.lists[t.lists.length-1].response_b=t.writingTextB),t.writingTextB="",t.writingB=!1}),50)},scrollBottom:function(){var t=this;this.$nextTick((function(){if(t.$refs["msglist"]){var s=t.$refs["msglist"].wrap;setTimeout((function(){s.scrollTop=s.scrollHeight}),200)}}))},textToHtml:u["d"],toDoc:u["e"],isPPT:u["b"],isTable:u["c"]}},m=p,v=i("76b2"),w=Object(v["a"])(m,e,a,!1,null,null,null);s["default"]=w.exports},d800:function(t,s,i){"use strict";i.d(s,"c",(function(){return a})),i.d(s,"d",(function(){return n})),i.d(s,"b",(function(){return r})),i.d(s,"a",(function(){return o}));var e=i("b775");function a(t){return Object(e["a"])({url:"/chat/getHistoryMsg",method:"post",data:t})}function n(t){return Object(e["a"])({url:"/chat/getPkHistoryMsg",method:"post",data:t})}function r(t){return Object(e["a"])({url:"/chat/getChatSetting",method:"post",data:t})}function o(t){return Object(e["a"])({url:"/chat/createPk",method:"post",data:t})}}}]);
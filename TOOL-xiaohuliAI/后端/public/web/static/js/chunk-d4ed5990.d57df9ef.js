(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-d4ed5990"],{"07c0":function(t,s,i){"use strict";i.r(s);var e=function(){var t=this,s=t.$createElement,i=t._self._c||s;return i("div",{staticClass:"module-cosplay"},[i("role-list",{staticClass:"sub-sidebar",on:{setRoleId:t.setRoleId}}),i("div",{staticClass:"main-wrapper box-chat"},[i("div",{staticClass:"chat-ai-list"},[i("div",{staticClass:"tab-list"},t._l(t.aiList,(function(s,e){return i("div",{staticClass:"tab-item",class:{active:t.ai.name===s.name,gold:t.isGpt4(s.name)},on:{click:function(s){return t.switchAI(e)}}},[t._v(" "+t._s(s.alias)+" ")])})),0)]),t.lists&&t.lists.length>0?i("div",{staticClass:"chat-msg style-chat"},[i("el-scrollbar",{ref:"msglist",attrs:{"wrap-class":"scrollbar-wrapper"}},[i("div",{staticClass:"msg-list"},[t._l(t.lists,(function(s,e){return i("div",{staticClass:"msg-row",class:"AI"===s.user?"row-ai":"row-user"},["AI"===s.user?i("div",{staticClass:"msg-item"},[i("div",{staticClass:"avatar"},[i("img",{attrs:{src:t.aiAvatar,alt:""}})]),i("div",{staticClass:"text markdown-body"},[i("Markdown",{attrs:{text:s.message,"show-tools":!0,"show-ppt":t.isPPT(t.lists[e-1].message),"show-table":t.isTable(t.lists[e-1].message),index:e},on:{retry:t.retryRequest}})],1)]):i("div",{staticClass:"msg-item"},[i("div",{staticClass:"avatar",staticStyle:{background:"#9aa37e"}},[i("img",{attrs:{src:t.userAvatar,alt:""}})]),i("div",{staticClass:"text markdown-body",domProps:{innerHTML:t._s(t.textToHtml(s.message))}})]),i("div",{staticStyle:{clear:"both"}})])})),t.writing||t.writingText?i("div",{staticClass:"msg-row row-ai"},[i("div",{staticClass:"msg-item"},[i("div",{staticClass:"avatar"},[i("img",{attrs:{src:t.aiAvatar,alt:""}})]),i("div",{staticClass:"text markdown-body"},[i("Markdown",{attrs:{text:t.writingText,writing:!(!t.writing&&!t.writingText)}}),i("div",{staticClass:"tools"},[i("span",{staticClass:"btn text-primary",on:{click:t.stopRequest}},[i("svg-icon",{staticClass:"icon",attrs:{"icon-class":"ic_stop"}}),t._v(t._s(t._f("lang")("停止回复")))],1)])],1)])]):t._e()],2)])],1):i("div",{staticClass:"chat-msg style-chat"},[i("welcome",{attrs:{title:t.welcomeTitle,desc:t.welcomeDesc,tips:t.welcomeTips},on:{use:t.quickMessage}})],1),i("div",{staticClass:"chat-input"},[i("div",{staticClass:"input"},[i("el-input",{ref:"messageInput",class:{gold:t.isGpt4(t.ai.name)},attrs:{placeholder:t.placeHolder,type:"textarea",autofocus:!0,autosize:{minRows:2,maxRows:8}},nativeOn:{keyup:function(s){return!s.type.indexOf("key")&&t._k(s.keyCode,"enter",13,s.key,"Enter")?null:t.onEnter(s)}},model:{value:t.message,callback:function(s){t.message=s},expression:"message"}}),i("el-button",{staticClass:"btn-send",attrs:{type:"default",loading:t.writing,title:t._f("lang")("发送")},on:{click:t.requestAI}},[t.writing?t._e():i("i",{staticClass:"el-icon-position"}),t._v(" 发送 ")])],1)])])],1)},a=[],o=i("e089"),n=(i("c9c8"),i("c565"),i("a7fa"),i("d3da"),i("30f8"),i("6db4")),c=i("d800"),l=i("b775");function r(t){return Object(l["a"])({url:"/cosplay/getAllRoles",method:"post",data:t})}function u(t){return Object(l["a"])({url:"/cosplay/getRole",method:"post",data:t})}var h=i("5f87"),d=i("114b"),p=i("ca00"),f=function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("div",[e("div",{staticClass:"module-header"},[e("div",{staticClass:"search"},[e("el-input",{attrs:{placeholder:t._f("lang")("搜索角色"),"prefix-icon":"el-icon-search",size:"large",clearable:!0,autocomplete:""},model:{value:t.searchKeyword,callback:function(s){t.searchKeyword=s},expression:"searchKeyword"}})],1)]),e("div",{staticClass:"module-body"},[e("div",{staticClass:"topic-group fixed-topic"},[t.activeTopic?e("div",{staticClass:"topic-title",class:{is_collapse:t.activeTopic.collapse},on:{click:function(s){return t.doCollapse(t.activeTopic.id)}}},[e("span",[t._v(t._s(t.activeTopic.title))]),e("i",[e("svg-icon",{staticClass:"collapse",attrs:{"icon-class":"ic_collapse"}})],1)]):t._e()]),e("el-scrollbar",{ref:"scroll",attrs:{"wrap-class":"scrollbar-wrapper"}},t._l(t.topicList,(function(s){return e("div",{staticClass:"topic-group"},[s.roles&&s.roles.length>0&&!s.hidden?e("div",{ref:"topic"+s.id,refInFor:!0,staticClass:"topic-title",class:{is_collapse:s.collapse},on:{click:function(i){return t.doCollapse(s.id)}}},[e("span",[t._v(t._s(s.title))]),e("i",[e("svg-icon",{staticClass:"collapse",attrs:{"icon-class":"ic_collapse"}})],1)]):t._e(),s.roles&&s.roles.length>0&&!s.hidden?e("div",{staticClass:"role-list",style:"height: "+(s.collapse?0:s.listHeight)+"px;"},t._l(s.roles,(function(s){return e("div",{staticClass:"role-item",class:{active:t.activeRoleId===s.id,hidden:s.hidden},on:{click:function(i){return t.setRoleId(s.id)}}},[e("div",{staticClass:"thumb"},[s.thumb?e("img",{attrs:{src:s.thumb,alt:""}}):e("img",{attrs:{src:t.aiAvatar,alt:""}})]),e("div",{staticStyle:{width:"134px"}},[e("div",{staticClass:"role-title"},[t._v(t._s(s.title))]),e("div",{staticClass:"role-ops"},[e("div",{staticClass:"op-item",attrs:{title:t._f("lang")("点击量")}},[e("svg-icon",{staticClass:"icon",attrs:{"icon-class":"ic_view"}}),t._v(" "+t._s(s.views)+" ")],1),e("div",{staticClass:"op-item",attrs:{title:t._f("lang")("使用量")}},[e("svg-icon",{staticClass:"icon",attrs:{"icon-class":"ic_usage"}}),t._v(" "+t._s(s.usages)+" ")],1)])])])})),0):t._e()])})),0)],1),e("div",{staticClass:"module-footer"},[e("div",{staticClass:"box-vip",on:{click:function(s){return t.showPay("vip")}}},[e("img",{staticClass:"icon",attrs:{src:i("c6d4")}}),t.vip_expire_time?e("div",{staticClass:"title"},[t._v(t._s(t._f("lang")("已开通会员")))]):e("div",{staticClass:"title"},[t._v(t._s(t._f("lang")("开通会员")))]),t.vip_expire_time?e("div",{staticClass:"desc"},[t._v(t._s(t.vip_expire_time)+" "+t._s(t._f("lang")("到期")))]):e("div",{staticClass:"desc"},[t._v(t._s(t._f("lang")("高速通道 无限对话")))])])])])},g=[],v=(i("cac0"),i("0f4e"),{data:function(){return{topicList:[],activeTopic:null,activeRoleId:0,scrollTop:0,searchKeyword:""}},computed:Object(o["a"])(Object(o["a"])({},Object(n["b"])(["vip_expire_time"])),{},{aiAvatar:function(){return"/static/img/avatar_cosplay.png"}}),watch:{searchKeyword:function(){this.filterList()},"$route.query":function(){var t=parseInt(this.$route.query.id);t&&(this.$emit("setRoleId",t),t!==this.activeRoleId&&(this.activeRoleId=t,Object(h["g"])("role_id",this.activeRoleId),this.scrollToActive()))}},mounted:function(){var t=this;this.setDefaultRole(),this.getAllRoles(),this.$nextTick((function(){setTimeout((function(){t.onScroll()}),300)}))},methods:{setDefaultRole:function(){if(this.$route.query.id)this.activeRoleId=parseInt(this.$route.query.id),Object(h["g"])("role_id",this.activeRoleId),this.$emit("setRoleId",this.activeRoleId);else{var t=Object(h["b"])("role_id");t&&this.setRoleId(parseInt(t))}},filterList:function(){var t=this.searchKeyword.toLowerCase(),s=this.topicList;s.forEach((function(i,e){if(i&&i["roles"]&&i["roles"].length>0){var a=!0,o=0;i["roles"].forEach((function(s,e){-1===s.title.toLowerCase().indexOf(t)?i["roles"][e].hidden=!0:(o++,i["roles"][e].hidden=!1,a=!1)})),i.hidden=a,i.listHeight=80*o,s[e]=i}})),this.topicList=s,this.$forceUpdate()},onScroll:function(){var t=this,s=this.$refs.scroll.wrap;s.onscroll=function(){t.handleScroll()}},handleScroll:function(){for(var t=this.$refs.scroll.wrap,s=this.topicList,i=s.length-1;i>=0;i--)if(!s[i].hidden&&0!==s[i].roles.length&&this.$refs["topic"+s[i].id][0].offsetTop<=t.scrollTop)return void(this.activeTopic=s[i])},scrollToActive:function(){var t=this,s=0,i=0;if(this.activeRoleId){var e=this.topicList;e.forEach((function(a,o){e[o].listHeight=80*a["roles"].length,t.activeRoleId&&a["roles"].forEach((function(e){i+=80,e.id===t.activeRoleId&&(s=i-200)}))}))}this.$refs.scroll.wrap.scrollTop=s,this.handleScroll()},getAllRoles:function(){var t=this;r().then((function(s){t.topicList=s.data,t.$nextTick((function(){t.scrollToActive()}))}))},setRoleId:function(t){t!==this.activeRoleId&&(this.activeRoleId=t,Object(h["g"])("role_id",this.activeRoleId),this.$router.replace({query:Object.assign({},this.$route.query?this.$route.query:{},{id:t})}).catch((function(t){})))},getActiveId:function(){return this.activeRole?this.activeRole.id:0},doCollapse:function(t){var s=this,i=this.topicList,e=this.$refs.scroll.wrap,a=null;i.forEach((function(e,o){e.id===t&&(i[o].collapse=!e.collapse,a=s.$refs["topic"+e.id][0])})),this.topicList=i,this.$forceUpdate(),this.$nextTick((function(){s.activeTopic&&t===s.activeTopic.id&&setTimeout((function(){e.scrollTop=a.offsetTop}),500)}))},showPay:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"vip";this.$modals.showPay(t)}}}),m=v,w=i("76b2"),_=Object(w["a"])(m,f,g,!1,null,null,null),b=_.exports,y=function(){var t=this,s=t.$createElement,i=t._self._c||s;return i("div",{},[i("div",{staticClass:"msg-list welcome"},[i("div",{staticClass:"msg-row row-ai"},[i("div",{staticClass:"msg-item"},[t._m(0),i("div",{staticClass:"text markdown-body",staticStyle:{"min-width":"480px","max-width":"600px"}},[t.welcomeTitle?i("div",{staticClass:"title"},[t._v(t._s(t.welcomeTitle))]):t._e(),t.welcomeDesc?i("div",{staticClass:"desc",domProps:{innerHTML:t._s(t.welcomeDesc)}}):t._e(),t.welcomeTips.length>0?i("div",{staticClass:"tips"},[i("ul",t._l(t.welcomeTips,(function(s){return s?i("li",{on:{click:function(i){return t.quickMessage(s)}}},[i("span",[t._v(t._s(s))]),i("i",{staticClass:"el-icon-position"})]):t._e()})),0)]):t._e()])])])])])},C=[function(){var t=this,s=t.$createElement,i=t._self._c||s;return i("div",{staticClass:"avatar"},[i("img",{attrs:{src:"/static/img/ic_ai.png"}})])}],T=(i("8198"),{props:{title:{type:String,default:""},desc:{type:String,default:""},tips:{type:String,default:""}},computed:{welcomeTitle:function(){return this.title?this.$lang("你好！我是")+this.title:""},welcomeDesc:function(){return this.desc?this.desc.replaceAll("\n","<br>"):""},welcomeTips:function(){return this.tips?this.tips.split("\n"):[]}},methods:{quickMessage:function(t){this.$emit("use",t)}}}),x=T,I=Object(w["a"])(x,y,C,!1,null,null,null),R=I.exports,$=i("61b2"),k=new d["a"],O=0,j={name:"Cosplay",components:{roleList:b,welcome:R,Markdown:$["c"]},data:function(){return{ai:{},lists:[],message:"",writingText:"",writing:!1,page:1,pagesize:10,role_id:0,cosplayRole:{}}},computed:Object(o["a"])(Object(o["a"])({},Object(n["b"])(["avatar","aiList","priceSetting"])),{},{aiAvatar:function(){return this.cosplayRole.thumb||"/static/img/avatar_cosplay.png"},userAvatar:function(){return this.avatar||"/static/img/ic_user.png"},placeHolder:function(){return this.cosplayRole&&this.cosplayRole.hint?this.cosplayRole.hint:this.$lang("输入您的问题，Ctrl+回车发送")},welcomeTitle:function(){return this.cosplayRole.title||""},welcomeDesc:function(){return this.cosplayRole.welcome||this.cosplayRole.hint||""},welcomeTips:function(){return this.cosplayRole.tips||""}}),watch:{message:function(){Object(h["g"])("cosplayPrompt",this.message)},aiList:{immediate:!0,handler:function(){this.setDefaultAI()}}},mounted:function(){this.startAutoFocus(),this.setDefaultMessage(),window.handlInputValue=this.miclinkInput},destroyed:function(){O&&clearInterval(O)},methods:{requestAI:function(){if(!this.writing&&!this.writingText){var t=Object(p["f"])(this.message);if(!t)return this.$message.error("请输入您的问题"),void(this.message="");this.lists.push({user:"user",message:t}),this.message="",this.writing=!0,this.scrollBottom();var s=this;k.onMessage=function(t){t&&(s.writingText+=t,s.scrollBottom())},k.onError=function(i){s.lists.pop(),s.message=t,-1!==i.indexOf("请登录")?(s.$modals.showLogin(),setTimeout((function(){s.$message.error(s.$lang(i))}),500)):-1!==i.indexOf("请充值")?(s.showPay(),setTimeout((function(){s.$message.error(s.$lang(i))}),500)):s.$alert(i,"系统提示")},k.onFinish=function(){s.writingText&&s.lists.push({user:"AI",message:s.writingText}),s.writing=!1,s.writingText="",s.scrollBottom()},k.request({message:t,ai:this.ai.name,role_id:this.role_id})}},showPay:function(){this.isGpt4(this.ai.name)?this.priceSetting.text40_vip?this.$modals.showPay("vip"):this.$modals.showPay("point"):this.$modals.showPay("vip")},miclinkInput:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;t&&(this.message=t),2!==s&&3!==s||this.requestAI()},switchAI:function(t){var s=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=this.aiList[t];this.ai.name!==i.name?this.writing?this.$message.warning(this.$lang("输出中，请稍等")):(this.ai=i,this.page=1,this.getHistoryMsg(),s&&this.$message.success("已切换至【"+i.alias+"】"),this.ai.name&&Object(h["g"])("ai",this.ai.name)):this.scrollTop+=1},setRoleId:function(t){this.role_id=t,this.role_id&&(this.page=1,this.getRole(),this.getHistoryMsg())},setDefaultAI:function(){if(this.aiList&&this.aiList.length>0){var t=Object(h["b"])("ai");if(this.ai.name===t)return;var s=0;t&&this.aiList.forEach((function(i,e){i.name===t&&(s=e)})),this.switchAI(s,!1)}},setDefaultMessage:function(){if(this.$route.query.prompt)this.message=decodeURIComponent(this.$route.query.prompt);else{var t=Object(h["b"])("cosplayPrompt");t&&(this.message=t)}},startAutoFocus:function(){var t=this;O=setInterval((function(){var s=window.getSelection?window.getSelection():document.selection.createRange().text;if(s.anchorNode){var i=s.anchorNode.className;if(i&&(-1!==i.indexOf("el-input")||-1!==i.indexOf("el-textarea")))return}!s.toString()&&t.$refs.messageInput&&t.$refs.messageInput.focus()}),1e3)},getHistoryMsg:function(){var t=this;this.ai.name&&this.role_id&&Object(c["c"])({ai:this.ai.name,role_id:this.role_id,page:this.page,pagesize:this.pagesize}).then((function(s){t.lists=s.data.list,t.$nextTick((function(){t.scrollBottom()}))}))},getRole:function(){var t=this;u({role_id:this.role_id}).then((function(s){t.cosplayRole=s.data}))},quickMessage:function(t){this.message=t},onEnter:function(t){return t.ctrlKey&&this.requestAI(),!1},retryRequest:function(t){t>0&&(this.message=this.lists[t-1].message,this.requestAI())},stopRequest:function(){var t=this,s=this.writingText;this.writing=!1,k.stop(),setTimeout((function(){s||t.lists.pop()}),50)},scrollBottom:function(){var t=this;this.$nextTick((function(){if(t.$refs["msglist"]){var s=t.$refs["msglist"].wrap;setTimeout((function(){s.scrollTop=s.scrollHeight}),200)}}))},textToHtml:p["d"],toDoc:p["e"],isPPT:p["b"],isTable:p["c"],isGpt4:p["a"]}},A=j,S=Object(w["a"])(A,e,a,!1,null,null,null);s["default"]=S.exports},"114b":function(t,s,i){"use strict";i.d(s,"a",(function(){return a}));i("a7fa"),i("f17d"),i("cac0"),i("0f4e"),i("c9c8"),i("c565"),i("96bb");var e=i("5f87");function a(){var t=this;this.apiUrl="/web.php/chat/sendText",this.onMessage=function(){},this.onError=function(){},this.onFinish=function(){},this.fetchCtrl="",this.outputStacks=[],this.outputSI=0,this.request=function(s){t.fetchCtrl=new AbortController;var i=new Headers;i.append("Content-Type","application/json"),i.append("X-token",Object(e["d"])()||""),i.append("X-site",Object(e["a"])()||""),fetch(this.apiUrl,{method:"POST",headers:i,body:JSON.stringify(s),signal:t.fetchCtrl.signal}).then((function(s){if(s.ok){var i=s.body.getReader(),e=new TextDecoder("utf-8");a(),t.startOutput()}else t.onError(s.statusText);function a(){i.read().then((function(s){var i=s.done,o=s.value;if(i)return t.stopOutput(),void t.onFinish();if(o){var n=e.decode(o);if(n){if(-1!==n.indexOf("[error]"))return t.stopOutput(),t.onError(n.replace("[error]","")),void t.onFinish();for(var c=0;c<n.length;c++)t.outputStacks.push(n[c])}}a()}))}})).catch((function(s){"AbortError"===s.name?(t.stopOutput(),t.onFinish(),console.log("请求已被取消")):console.log("网络错误",s)}))},this.startOutput=function(){t.stopOutput(),t.outputSI=setInterval((function(){t.outputStacks.length>0&&t.onMessage(t.outputStacks.shift())}),24)},this.stopOutput=function(){t.outputSI&&clearInterval(t.outputSI),t.outputSI=0,t.outputStacks.length>0&&t.onMessage(t.outputStacks.join("")),t.outputStacks=[]},this.stop=function(){t.fetchCtrl&&(t.fetchCtrl.abort(),t.fetchCtrl=null),t.stopOutput(),t.onFinish()}}},"96bb":function(t,s,i){"use strict";var e=i("a158"),a=i("9372"),o=i("86aa"),n=i("2663"),c=i("a05b"),l=a([].join),r=o!==Object,u=r||!c("join",",");e({target:"Array",proto:!0,forced:u},{join:function(t){return l(n(this),void 0===t?",":t)}})},d800:function(t,s,i){"use strict";i.d(s,"c",(function(){return a})),i.d(s,"d",(function(){return o})),i.d(s,"b",(function(){return n})),i.d(s,"a",(function(){return c}));var e=i("b775");function a(t){return Object(e["a"])({url:"/chat/getHistoryMsg",method:"post",data:t})}function o(t){return Object(e["a"])({url:"/chat/getPkHistoryMsg",method:"post",data:t})}function n(t){return Object(e["a"])({url:"/chat/getChatSetting",method:"post",data:t})}function c(t){return Object(e["a"])({url:"/chat/createPk",method:"post",data:t})}}}]);
(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-c463fcb8"],{1667:function(t,e,s){},7586:function(t,e,s){"use strict";var a=s("a158"),r=s("ff41"),i=s("752d").f,c=s("7e8f"),n=s("199e"),l=s("639d"),o=s("3a4d"),u=s("0445"),p=s("c9d8"),h=r("".endsWith),d=r("".slice),f=Math.min,g=u("endsWith"),v=!p&&!g&&!!function(){var t=i(String.prototype,"endsWith");return t&&!t.writable}();a({target:"String",proto:!0,forced:!v&&!g},{endsWith:function(t){var e=n(o(this));l(t);var s=arguments.length>1?arguments[1]:void 0,a=e.length,r=void 0===s?a:f(c(s),a),i=n(t);return h?h(e,i,r):d(e,r-i.length,r)===i}})},"78c3":function(t,e,s){"use strict";s.r(e);var a=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{ref:"searchContainer",staticClass:"module-search"},[s("el-scrollbar",{attrs:{"wrap-class":{"scrollbar-wrapper":!0,"result-container":t.writing||t.results.length>0}}},[s("div",{staticClass:"search-input"},[s("div",{staticClass:"model-list"},t._l(t.modelList,(function(e){return s("div",{staticClass:"model-item",class:{active:e.name===t.model},on:{click:function(s){return t.selectModel(e.name)}}},[e.name===t.model?s("svg-icon",{staticClass:"icon",attrs:{"icon-class":e.activeIcon}}):s("svg-icon",{staticClass:"icon",attrs:{"icon-class":e.icon}}),s("span",[t._v(t._s(e.title))])],1)})),0),s("div",{staticClass:"input"},[s("el-popover",{ref:"search-type-popover",attrs:{placement:"bottom-start",trigger:"click","popper-class":"search-type-list",offset:-8,"visible-arrow":!0}},[s("div",{staticClass:"btn-type btn-item",attrs:{slot:"reference"},slot:"reference"},[s("svg-icon",{staticClass:"icon",attrs:{"icon-class":t.typeList[t.type].icon}}),s("span",[t._v(t._s(t.typeList[t.type].title))]),s("svg-icon",{staticStyle:{"font-size":"8px"},attrs:{"icon-class":"ic_search_arrow"}})],1),t._l(t.typeList,(function(e){return s("div",{staticClass:"type-item",on:{click:function(s){return t.selectType(e.name)}}},[s("svg-icon",{attrs:{"icon-class":e.icon}}),s("span",[t._v(t._s(e.title))])],1)}))],2),s("el-input",{ref:"askInput",attrs:{placeholder:"输入你想搜索的内容",type:"text",autofocus:!1,maxlength:100},nativeOn:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.onEnter(e)}},model:{value:t.ask,callback:function(e){t.ask=e},expression:"ask"}}),s("div",{staticClass:"btn-send",on:{click:t.doSearch}},[s("i",{staticClass:"el-icon-search icon"}),s("span",[t._v("搜索")])])],1),s("div",{staticClass:"hot-list"},[s("ul",t._l(t.hots,(function(e,a){return s("li",{staticClass:"hot-item",on:{click:function(s){return t.quickSearch(e)}}},[s("span",{staticClass:"text"},[t._v(t._s(e))])])})),0)])]),t.results.length>0||t.writing?s("div",{staticClass:"search-result"},[s("SearchStep",{ref:"searchStep",attrs:{"result-step":t.resultStep,writing:t.writing}}),t.resultAsk?s("h1",{staticClass:"title"},[t._v(t._s(t.resultAsk))]):t._e(),s("div",{staticClass:"tips"},[t._v("内容由 AI 生成，不能保证真实无误")]),t.writing?s("div",{staticClass:"state-bar"},[s("div",{staticClass:"writing"},[s("svg-icon",{staticClass:"icon",attrs:{"icon-class":"ic_search_writing"}}),0===t.resultStep?s("span",[t._v("解析中...")]):1===t.resultStep?s("span",[t._v("搜索中...")]):s("span",[t._v("回答中...")])],1),s("div",{staticClass:"btn-stop",attrs:{title:"点击停止"},on:{click:t.stopFetch}},[s("svg-icon",{staticClass:"icon",attrs:{"icon-class":"ic_stop"}}),s("span",[t._v("停止")])],1)]):t._e(),s("div",{staticClass:"markdown-body"},[t._l(t.results,(function(e,a){return s("SearchCard",{key:a,attrs:{"card-type":e.type,"card-data":e.data,"source-list":t.sourceList}})})),!t.writing&&t.results.length>0?s("div",{staticClass:"tools"},[s("div",{staticClass:"btn-group"}),s("div",{staticClass:"btn-group"},[s("span",{staticClass:"btn text-primary",staticStyle:{"margin-right":"0"},on:{click:t.toPageTop}},[s("i",{staticClass:"el-icon-top icon"}),t._v("返回顶部")])])]):t._e()],2),t.sourceList.length>0?s("div",{staticClass:"side-source"},[s("div",{staticClass:"source-title"},[s("svg-icon",{staticClass:"icon",attrs:{"icon-class":"ic_search_link"}}),s("span",[t._v("参考链接")])],1),s("div",{staticClass:"source-list"},t._l(t.sourceList,(function(e,a){return s("div",{staticClass:"source-item"},[s("div",{staticClass:"row-link"},[s("a",{attrs:{href:e.seeMoreUrl,target:"_blank"}},[s("span",{staticClass:"link-index"},[t._v(t._s(a+1))]),s("span",{staticClass:"link-title"},[t._v(t._s(e.title))])])]),s("div",{staticClass:"row-desc"},[e.publishDate?s("span",{staticClass:"desc-date"},[t._v(t._s(e.publishDate.substring(0,10)))]):t._e(),s("span",{staticClass:"desc-text"},[t._v(t._s(e.snippet))])]),s("div",{staticClass:"row-site"},[e.image?s("span",{staticClass:"site-icon",style:"background-image: url("+e.image+");"}):t._e(),s("span",{staticClass:"site-name"},[t._v(t._s(e.showName))])])])})),0)]):t._e()],1):t._e()])],1)},r=[],i=s("05d4"),c=s("4c28"),n=s("e089"),l=(s("49ff"),s("a7fa"),s("f17d"),s("b838"),s("0d33"),s("cac0"),s("0f4e"),s("7586"),s("390d"),s("8198"),s("d3da"),s("c9c8"),s("30f8"),s("6db4")),o=s("5f87"),u=s("b775");function p(t){return Object(u["a"])({url:"/search/getSetting",method:"post",data:t})}function h(t){return Object(u["a"])({url:"/search/getResults",method:"post",data:t})}var d=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{domProps:{innerHTML:t._s(t.message)},on:{click:t.onClick}})},f=[],g=s("53b2"),v=(s("4209"),s("58d4"),s("9602")),_=s.n(v),b=s("f8a9"),m=s.n(b),k=s("ffeb"),y=s.n(k),S=s("548f"),C=s.n(S),w=s("bb91"),x=new _.a({linkify:!0,highlight:function(t,e){var s=w["a"].encode(t),a=t.split(/\r|\n/gi).length,r=!(!e||!C.a.getLanguage(e));t=r?C.a.highlight(t,{language:e}).value:C.a.highlightAuto(t).value;for(var i='<ul class="code-linenum">',c=0;c<a-1;c++)i+='<li class="code-linenum-line">'.concat(c+1,"</li>");return i+="</ul>",t=i+t,'<pre class="code-block-wrapper"><div class="code-block-header"><span class="code-block-header__lang">'.concat(e.toUpperCase(),'</span><a class="code-block-header__lang" style="margin-left: 15px;" data-action="copy" data-code="').concat(s,'">')+("zh-cn"===window.$lang?"复制":"copy")+'</a></div><code class="hljs code-block-body '.concat(e,'">').concat(t,"</code></pre>")}});x.use(y.a,{attrs:{target:"_blank",rel:"noopener"}}),x.use(m.a,{blockClass:"katexmath-block rounded-md p-[10px]",errorColor:" #cc0000"});var $={props:{cardType:{type:String,default:""},cardData:{type:[Array,Object,String],default:function(){return{}}},sourceList:{type:Array,default:function(){return[]}}},computed:{message:function(){var t="";try{switch(this.cardType){case"markdown":case"expand_query":t=this.cardData;break;case"outline":t=this.cardData["messages"];break;case"outline_json":var e=JSON.parse(this.cardData["messages"]);for(var s in e){t+="* **"+s+"**\n";var a,r=Object(g["a"])(e[s]);try{for(r.s();!(a=r.n()).done;){var i=a.value;t+="  - "+i+"\n"}}catch(c){r.e(c)}finally{r.f()}}break;case"related_events":t="# 相关事件\n",t+=this.cardData["messages"];break;case"related_people":t="# 相关人物\n",t+=this.cardData["messages"];break}return t=this.replaceSourceLink(t),x.render(t)}catch(n){console.log(n),console.log(this.cardType,this.cardData)}}},methods:{trim:function(t){return t.replace(/(^\s*)|(\s*$)/g,"")},onClick:function(t){var e=this,s=t.target.dataset.action;if("copy"===s){var a=t.target.dataset.code;e.$copyText(w["a"].decode(a)).then((function(){e.$message.success("已复制")}),(function(){e.$message.error("复制失败，请重试")}))}},replaceSourceLink:function(t){return this.sourceList.forEach((function(e,s){var a="";e.title&&(a=e.title,a=a.replaceAll('"'," "),a=a.replaceAll("|"," "),a=a.replaceAll("["," "),a=a.replaceAll("]"," "));var r=e.seeMoreUrl;t=t.replaceAll("["+(s+1)+"]","["+(s+1)+"]("+r+' "'+a+'")')})),t}}},O=$,T=s("76b2"),L=Object(T["a"])(O,d,f,!1,null,null,null),j=L.exports,A=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"steps"},[s("div",{staticClass:"step-line"},[s("div",{staticClass:"step-line-light",style:"width:"+t.lightLineWidth+"%"})]),s("div",{staticClass:"step-list"},t._l(t.steps,(function(e,a){return s("div",{staticClass:"step-item",class:{active:t.activeStep>=a}},["wait"===t.stepState(a)?s("svg-icon",{staticClass:"icon",attrs:{"icon-class":"ic_search_step_wait"}}):t._e(),"doing"===t.stepState(a)?s("svg-icon",{staticClass:"icon doing",attrs:{"icon-class":"ic_search_step_done"}}):t._e(),"done"===t.stepState(a)?s("svg-icon",{staticClass:"icon",attrs:{"icon-class":"ic_search_step_done"}}):t._e(),s("div",{staticClass:"step-title"},[t._v(t._s(e))])],1)})),0)])},I=[],M=(s("51c1"),{props:{resultStep:{type:Number,default:0},writing:{type:Boolean,default:!0}},data:function(){return{searchModel:"search",searchType:"all",activeStep:0}},computed:{lightLineWidth:function(){return this.activeStep*parseInt(100/(this.steps.length-1))},steps:function(){if("research"===this.searchModel){var t="全网搜索";switch(this.searchType){case"doc":t="文档搜索";break;case"scholar":t="学术搜索";break}return["解析问题",t,"AI汇总","深入研究","回答完成"]}return["解析问题","全网搜索","AI汇总","回答完成"]}},watch:{resultStep:function(){this.activeStep=this.resultStep},writing:function(){this.writing||(this.activeStep=this.steps.length-1)}},methods:{stepState:function(t){return this.activeStep===this.steps.length-1?"done":this.activeStep<t?"wait":this.activeStep===t?"doing":"done"},setSearchModel:function(t){this.searchModel=t},setSearchType:function(t){this.searchType=t}}}),E=M,q=(s("c2d3"),Object(T["a"])(E,A,I,!1,null,"5d58ba74",null)),D=q.exports,W=null,J={name:"Search",components:{SearchCard:j,SearchStep:D},data:function(){return{model:"search",type:"all",ask:"",modelList:{search:{name:"search",icon:"ic_search_search",activeIcon:"ic_search_search_active",title:"简洁"},copilot:{name:"copilot",icon:"ic_search_copilot",activeIcon:"ic_search_copilot_active",title:"增强"},research:{name:"research",icon:"ic_search_research",activeIcon:"ic_search_research_active",title:"研究"}},typeList:{all:{name:"all",icon:"ic_search_dot_green",title:"全网"},doc:{name:"doc",icon:"ic_search_dot_blue",title:"文档"},scholar:{name:"scholar",icon:"ic_search_dot_purple",title:"学术"}},resultStep:0,resultAsk:"",results:[],sourceList:[],writing:!1,page:1,pagesize:10,hots:[]}},computed:Object(n["a"])({},Object(l["b"])(["priceSetting"])),watch:{"$route.query":function(t){console.log("query",t),t.result?this.writing?this.$message.error("正在输出中，请稍候"):this.getResults(t.result):(this.writing&&this.stopFetch(),this.ask="",this.resultAsk="",this.resultStep=0,this.results=[],this.getSetting(),this.$refs.askInput.focus())}},mounted:function(){this.getSetting(),this.$route.query.result?this.getResults(this.$route.query.result):this.$refs.askInput.focus()},methods:{doSearch:function(){var t=this;return Object(c["a"])(Object(i["a"])().mark((function e(){var s,a,r,c,n,l,u,p,h,d,f,g,v;return Object(i["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(!t.writing){e.next=3;break}return t.$message.error("回答中，请停止后再发起搜索"),e.abrupt("return");case 3:if(s=t.trim(t.ask),s){e.next=9;break}return t.$message.error("请输入你想搜索的内容"),t.$refs.askInput.focus(),t.ask="",e.abrupt("return");case 9:return t.results=[],t.sourceList=[],t.writing=!0,t.resultAsk=s,t.$nextTick((function(){t.resultStep=0,t.$refs.searchStep.setSearchModel(t.model),t.$refs.searchStep.setSearchType(t.type)})),e.prev=14,a=new Headers,a.append("Content-Type","application/json"),a.append("X-token",Object(o["d"])()||""),a.append("X-site",Object(o["a"])()||""),r="/web.php/search/search",c={model:t.model,type:t.type,ask:s},W=new AbortController,e.next=24,fetch(r,{method:"POST",headers:a,body:JSON.stringify(c),signal:W.signal});case 24:if(n=e.sent,n.ok){e.next=29;break}return t.writing=!1,t.$message.error(n.statusText),e.abrupt("return");case 29:l=n.body.getReader(),u=new TextDecoder("utf-8"),p=!1,h="",d=Object(i["a"])().mark((function e(){var a,r,c,n;return Object(i["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,l.read();case 2:if(a=e.sent,r=a.value,c=a.done,p=c,r){e.next=8;break}return e.abrupt("return",0);case 8:if(f=u.decode(r),f&&"\n"!==f&&"string"===typeof f){e.next=11;break}return e.abrupt("return",0);case 11:if(-1===f.indexOf("[error]")){e.next=18;break}return t.writing=!1,t.results=[],t.ask=s,n=f.replace("[error]",""),-1!==n.indexOf("请登录")?(t.$modals.showLogin(),setTimeout((function(){t.$message.error(t.$lang(n))}),500)):-1!==n.indexOf("请充值")?(t.$modals.showPay("point"),setTimeout((function(){t.$message.error(t.$lang(n))}),500)):t.$alert(n,"系统提示"),e.abrupt("return",1);case 18:if(t.writing=!0,f.endsWith("}")){e.next=22;break}return h+=f,e.abrupt("return",0);case 22:h&&(f=h+f,h=""),g=[];try{f=JSON.parse(f),g=[f]}catch(i){-1!==f.indexOf('"}{"')&&(f=f.replaceAll('"}{"','"}||{"'),g=f.split("||"),g.forEach((function(t){try{t=JSON.parse(t),g.push(t)}catch(i){console.log("解析出错",t)}})))}g.forEach((function(e){if(t.results.length>0&&t.results[t.results.length-1].data&&e.type===t.results[t.results.length-1].type&&!t.results[t.results.length-1].data.endsWith("\n")?t.results[t.results.length-1].data+=e.data:t.results.push(e),0===t.resultStep?"search_query"===e.type&&(t.resultStep=1):1===t.resultStep?"search_result"===e.type&&(t.resultStep=2,t.sourceList=e.data):2===t.resultStep&&"research"===t.model&&"expand_query"===e.type&&(t.resultStep=3),"result_id"===e.type){var s=window.location.href;-1!==s.indexOf("search?")&&(s=s.substring(0,s.indexOf("search?"))+"search"),s=s+"?result="+e.data,history.pushState(null,null,s)}}));case 26:case"end":return e.stop()}}),e)}));case 34:if(p){e.next=43;break}return e.delegateYield(d(),"t0",36);case 36:if(v=e.t0,0!==v){e.next=39;break}return e.abrupt("continue",34);case 39:if(1!==v){e.next=41;break}return e.abrupt("break",43);case 41:e.next=34;break;case 43:t.writing=!1,e.next=51;break;case 46:e.prev=46,e.t1=e["catch"](14),e.t1=e.t1.toString(),-1!==e.t1.indexOf("user aborted")?console.log("已终止连接"):console.log("Request Error",e.t1),t.writing=!1;case 51:case"end":return e.stop()}}),e,null,[[14,46]])})))()},getResults:function(t){var e=this;h({result_id:t}).then((function(t){t.data?(e.ask=t.data.ask,e.resultAsk=t.data.ask,e.model=t.data.model,e.type=t.data.type,t.data.results.forEach((function(t){e.results.length>0&&t.type===e.results[e.results.length-1].type&&!e.results[e.results.length-1].data.endsWith("\n")?e.results[e.results.length-1].data+=t.data:e.results.push(t),"search_result"===t.type&&(e.sourceList=t.data)})),e.$nextTick((function(){e.$refs.searchStep.setSearchModel(e.model),e.$refs.searchStep.setSearchType(e.type),"research"===t.data.model?e.resultStep=4:e.resultStep=3}))):(e.resultStep=0,e.results=[],e.getSetting(),e.$refs.askInput.focus())}))},getSetting:function(){var t=this;p().then((function(e){t.hots=e.data.hots}))},selectModel:function(t){this.model!==t&&(this.model=t,"search"!==t&&"copilot"!==t||this.selectType("all"))},selectType:function(t){this.type=t,this.$refs["search-type-popover"].doClose(),"doc"!==t&&"scholar"!==t||this.selectModel("research")},quickSearch:function(t){this.ask=t,this.doSearch()},onEnter:function(t){return this.doSearch(),!1},retry:function(){this.doSearch()},stopFetch:function(){W.abort(),this.writing=!1},trim:function(t){return t&&(t=t.replace(/(^\s*)|(\s*$)/g,"")),t},toPageTop:function(){this.$refs.searchContainer&&(this.$refs.searchContainer.scrollTop=0)}}},N=J,R=(s("93454"),s("d88b"),Object(T["a"])(N,a,r,!1,null,"1f06f69c",null));e["default"]=R.exports},93454:function(t,e,s){"use strict";s("f4f2")},c2d3:function(t,e,s){"use strict";s("c8f9")},c8f9:function(t,e,s){},d88b:function(t,e,s){"use strict";s("1667")},f4f2:function(t,e,s){}}]);
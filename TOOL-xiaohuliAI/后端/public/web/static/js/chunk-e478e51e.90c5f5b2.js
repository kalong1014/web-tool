(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-e478e51e"],{"114b":function(t,i,s){"use strict";s.d(i,"a",(function(){return o}));s("a7fa"),s("f17d"),s("cac0"),s("0f4e"),s("c9c8"),s("c565"),s("96bb");var e=s("5f87");function o(){var t=this;this.apiUrl="/web.php/chat/sendText",this.onMessage=function(){},this.onError=function(){},this.onFinish=function(){},this.fetchCtrl="",this.outputStacks=[],this.outputSI=0,this.request=function(i){t.fetchCtrl=new AbortController;var s=new Headers;s.append("Content-Type","application/json"),s.append("X-token",Object(e["d"])()||""),s.append("X-site",Object(e["a"])()||""),fetch(this.apiUrl,{method:"POST",headers:s,body:JSON.stringify(i),signal:t.fetchCtrl.signal}).then((function(i){if(i.ok){var s=i.body.getReader(),e=new TextDecoder("utf-8");o(),t.startOutput()}else t.onError(i.statusText);function o(){s.read().then((function(i){var s=i.done,a=i.value;if(s)return t.stopOutput(),void t.onFinish();if(a){var r=e.decode(a);if(r){if(-1!==r.indexOf("[error]"))return t.stopOutput(),t.onError(r.replace("[error]","")),void t.onFinish();for(var n=0;n<r.length;n++)t.outputStacks.push(r[n])}}o()}))}})).catch((function(i){"AbortError"===i.name?(t.stopOutput(),t.onFinish(),console.log("请求已被取消")):console.log("网络错误",i)}))},this.startOutput=function(){t.stopOutput(),t.outputSI=setInterval((function(){t.outputStacks.length>0&&t.onMessage(t.outputStacks.shift())}),24)},this.stopOutput=function(){t.outputSI&&clearInterval(t.outputSI),t.outputSI=0,t.outputStacks.length>0&&t.onMessage(t.outputStacks.join("")),t.outputStacks=[]},this.stop=function(){t.fetchCtrl&&(t.fetchCtrl.abort(),t.fetchCtrl=null),t.stopOutput(),t.onFinish()}}},9336:function(t,i,s){"use strict";s("bc4a")},"96bb":function(t,i,s){"use strict";var e=s("a158"),o=s("9372"),a=s("86aa"),r=s("2663"),n=s("a05b"),c=o([].join),l=a!==Object,p=l||!n("join",",");e({target:"Array",proto:!0,forced:p},{join:function(t){return c(r(this),void 0===t?",":t)}})},bc4a:function(t,i,s){},d800:function(t,i,s){"use strict";s.d(i,"c",(function(){return o})),s.d(i,"d",(function(){return a})),s.d(i,"b",(function(){return r})),s.d(i,"a",(function(){return n}));var e=s("b775");function o(t){return Object(e["a"])({url:"/chat/getHistoryMsg",method:"post",data:t})}function a(t){return Object(e["a"])({url:"/chat/getPkHistoryMsg",method:"post",data:t})}function r(t){return Object(e["a"])({url:"/chat/getChatSetting",method:"post",data:t})}function n(t){return Object(e["a"])({url:"/chat/createPk",method:"post",data:t})}},e112:function(t,i,s){"use strict";s.r(i);var e=function(){var t=this,i=t.$createElement,s=t._self._c||i;return s("div",{staticClass:"module-write"},[s("prompt-list",{staticClass:"sub-sidebar",on:{setPromptId:t.setPromptId}}),s("div",{staticClass:"main-wrapper box-chat"},[s("div",{staticClass:"chat-ai-list"},[s("div",{staticClass:"tab-list"},t._l(t.aiList,(function(i,e){return s("div",{staticClass:"tab-item",class:{active:t.ai.name===i.name,gold:t.isGpt4(i.name)},on:{click:function(i){return t.switchAI(e)}}},[t._v(" "+t._s(i.alias)+" ")])})),0)]),t.lists&&t.lists.length>0?s("div",{staticClass:"chat-msg style-write"},[s("el-scrollbar",{ref:"msglist",attrs:{"wrap-class":"scrollbar-wrapper"}},[s("div",{staticClass:"msg-list"},[t._l(t.lists,(function(i,e){return s("div",{staticClass:"msg-row",class:"AI"===i.user?"row-ai":"row-user"},["AI"===i.user?s("div",{staticClass:"msg-item"},[s("div",{staticClass:"avatar"},[s("img",{attrs:{src:t.aiAvatar}})]),s("div",{staticClass:"text markdown-body"},[s("Markdown",{attrs:{text:i.message,"show-tools":!0,"show-ppt":t.isPPT(t.lists[e-1].message),"show-table":t.isTable(t.lists[e-1].message),index:e},on:{retry:t.retryRequest}})],1)]):s("div",{staticClass:"msg-item"},[s("div",{staticClass:"avatar",staticStyle:{background:"#9aa37e"}},[s("img",{attrs:{src:t.userAvatar,alt:""}})]),s("div",{staticClass:"text markdown-body",domProps:{innerHTML:t._s(t.textToHtml(i.message))}})]),s("div",{staticStyle:{clear:"both"}})])})),t.writing||t.writingText?s("div",{staticClass:"msg-row row-ai"},[s("div",{staticClass:"msg-item"},[s("div",{staticClass:"avatar"},[s("img",{attrs:{src:t.aiAvatar,alt:""}})]),s("div",{staticClass:"text markdown-body"},[s("Markdown",{attrs:{text:t.writingText,writing:!(!t.writing&&!t.writingText)}}),s("div",{staticClass:"tools"},[s("span",{staticClass:"btn text-primary",on:{click:t.stopRequest}},[s("svg-icon",{staticClass:"icon",attrs:{"icon-class":"ic_stop"}}),t._v(t._s(t._f("lang")("停止回复")))],1)])],1)])]):t._e()],2)])],1):s("div",{staticClass:"chat-msg style-write"},[s("welcome",{attrs:{title:t.welcomeTitle,desc:t.welcomeDesc,tips:t.welcomeTips},on:{use:t.quickMessage}})],1),s("div",{staticClass:"chat-input"},[s("div",{staticClass:"input"},[s("el-input",{ref:"messageInput",class:{gold:t.isGpt4(t.ai.name)},attrs:{placeholder:t._f("lang")(t.placeHolder),type:"textarea",autofocus:!0,autosize:{minRows:2,maxRows:8}},nativeOn:{keyup:function(i){return!i.type.indexOf("key")&&t._k(i.keyCode,"enter",13,i.key,"Enter")?null:t.onEnter(i)}},model:{value:t.message,callback:function(i){t.message=i},expression:"message"}}),s("el-button",{staticClass:"btn-send",attrs:{type:"default",loading:t.writing,title:t._f("lang")("发送")},on:{click:t.requestAI}},[t.writing?t._e():s("i",{staticClass:"el-icon-position"}),t._v(" 发送 ")])],1)])])],1)},o=[],a=s("e089"),r=(s("c9c8"),s("c565"),s("a7fa"),s("d3da"),s("30f8"),s("6db4")),n=s("d800"),c=s("b775");function l(t){return Object(c["a"])({url:"/write/getAllPrompt",method:"post",data:t})}function p(t){return Object(c["a"])({url:"/write/votePrompt",method:"post",data:t})}function u(t){return Object(c["a"])({url:"/write/getPrompt",method:"post",data:t})}var d=s("5f87"),h=s("114b"),m=s("ca00"),f=function(){var t=this,i=t.$createElement,e=t._self._c||i;return e("div",[e("div",{staticClass:"module-header"},[e("div",{staticClass:"search"},[e("el-input",{attrs:{placeholder:t._f("lang")("搜索模型"),"prefix-icon":"el-icon-search",size:"large",clearable:!0,autocomplete:""},model:{value:t.searchKeyword,callback:function(i){t.searchKeyword=i},expression:"searchKeyword"}})],1)]),e("div",{staticClass:"module-body"},[e("div",{staticClass:"topic-group fixed-topic"},[t.activeTopic?e("div",{staticClass:"topic-title",class:{is_collapse:t.activeTopic.collapse},on:{click:function(i){return t.doCollapse(t.activeTopic.id)}}},[e("span",[t._v(t._s(t.activeTopic.title))]),e("i",[e("svg-icon",{staticClass:"collapse",attrs:{"icon-class":"ic_collapse"}})],1)]):t._e()]),e("el-scrollbar",{ref:"scroll",attrs:{"wrap-class":"scrollbar-wrapper"}},t._l(t.topicList,(function(i,s){return e("div",{staticClass:"topic-group"},[i.prompts&&i.prompts.length>0&&!i.hidden?e("div",{ref:"topic"+i.id,refInFor:!0,staticClass:"topic-title",class:{is_collapse:i.collapse},attrs:{"data-id":"topic"+i.id},on:{click:function(s){return t.doCollapse(i.id)}}},[e("span",[t._v(t._s(i.title))]),e("i",[e("svg-icon",{staticClass:"collapse",attrs:{"icon-class":"ic_collapse"}})],1)]):t._e(),i.prompts&&i.prompts.length>0&&!i.hidden?e("div",{staticClass:"prompt-list",style:"height: "+(i.collapse?0:i.listHeight)+"px;"},t._l(i.prompts,(function(i,o){return e("div",{staticClass:"prompt-item",class:{active:t.activePromptId===i.id,hidden:i.hidden},on:{click:function(s){return t.setPromptId(i.id)}}},[e("div",{staticClass:"prompt-title"},[t._v(t._s(i.title))]),e("div",{staticClass:"prompt-desc"},[t._v(t._s(i.desc))]),e("div",{staticClass:"prompt-ops"},[e("div",{staticClass:"op-item",attrs:{title:t._f("lang")("点击量")}},[e("svg-icon",{staticClass:"icon",attrs:{"icon-class":"ic_view"}}),t._v(" "+t._s(i.views)+" ")],1),e("div",{staticClass:"op-item",attrs:{title:t._f("lang")("使用量")}},[e("svg-icon",{staticClass:"icon",attrs:{"icon-class":"ic_usage"}}),t._v(" "+t._s(i.usages)+" ")],1),e("div",{staticClass:"op-item",attrs:{title:t._f("lang")("收藏")},on:{click:function(i){return i.stopPropagation(),t.doPromptVote(s,o)}}},[1===i.isVote?e("svg-icon",{staticClass:"icon",attrs:{"icon-class":"ic_vote_active"}}):e("svg-icon",{staticClass:"icon",attrs:{"icon-class":"ic_vote"}})],1)])])})),0):t._e()])})),0)],1),e("div",{staticClass:"module-footer"},[e("div",{staticClass:"box-vip",on:{click:function(i){return t.showPay("vip")}}},[e("img",{staticClass:"icon",attrs:{src:s("c6d4")}}),t.vip_expire_time?e("div",{staticClass:"title"},[t._v(t._s(t._f("lang")("已开通会员")))]):e("div",{staticClass:"title"},[t._v(t._s(t._f("lang")("开通会员")))]),t.vip_expire_time?e("div",{staticClass:"desc"},[t._v(t._s(t.vip_expire_time)+" "+t._s(t._f("lang")("到期")))]):e("div",{staticClass:"desc"},[t._v(t._s(t._f("lang")("高速通道 无限对话")))])])])])},v=[],g=(s("cac0"),s("0f4e"),function(){var t=this,i=t.$createElement,s=t._self._c||i;return s("div",[s("el-dialog",{attrs:{"custom-class":"my-dialog",title:t._f("lang")("创作模型"),width:"1000px",height:"600px",visible:!0,"close-on-click-modal":!1,"append-to-body":!0,"before-close":t.closeForm}},[s("div",[s("div",{staticClass:"label"},[t._v(t._s(t._f("lang")("类别：")))]),s("ul",[s("li",[t._v("全部")])])]),s("div",t._l(t.topicList,(function(i){return s("div",{staticClass:"group-write"},[i.prompts&&i.prompts.length>0&&!i.hidden?s("div",{staticClass:"topic-title"},[s("span",[t._v(t._s(i.title))])]):t._e(),i.prompts&&i.prompts.length>0&&!i.hidden?s("div",{staticClass:"prompt-list"},t._l(i.prompts,(function(i){return s("div",{staticClass:"prompt-item",class:{active:t.activePromptId===i.id,hidden:i.hidden},on:{click:function(s){return t.changePrompt(i.id)}}},[s("div",{staticClass:"prompt-title"},[t._v(t._s(i.title))]),s("div",{staticClass:"prompt-desc"},[t._v(t._s(i.desc))]),s("div",{staticClass:"prompt-ops"},[s("div",{staticClass:"op-item",attrs:{title:t._f("lang")("点击量")}},[s("svg-icon",{staticClass:"icon",attrs:{"icon-class":"ic_view"}}),t._v(" "+t._s(i.views)+" ")],1),s("div",{staticClass:"op-item",attrs:{title:t._f("lang")("使用量")}},[s("svg-icon",{staticClass:"icon",attrs:{"icon-class":"ic_usage"}}),t._v(" "+t._s(i.usages)+" ")],1),s("div",{staticClass:"op-item",attrs:{title:t._f("lang")("收藏")},on:{click:function(s){return s.stopPropagation(),t.doPromptVote(i.id)}}},[1===i.isVote?s("svg-icon",{staticClass:"icon",attrs:{"icon-class":"ic_vote_active"}}):s("svg-icon",{staticClass:"icon",attrs:{"icon-class":"ic_vote"}})],1)])])})),0):t._e()])})),0)])],1)}),w=[],_=(s("51c1"),{props:{topicList:{type:Array,default:function(){return[]}},activePromptId:{type:Number,default:0}},data:function(){return{form:null,formRules:{title:[{required:!0,message:"此项必填",trigger:"blur"}]}}},created:function(){this.form=this.group},methods:{closeForm:function(){this.$emit("close")},doSubmit:function(){var t=this;this.$refs.form.validate((function(i){i?t.$emit("submit",t.form):t.$message.error("请填写必填项")}))}}}),C=_,b=(s("9336"),s("76b2")),P=Object(b["a"])(C,g,w,!1,null,"74369318",null),y=(P.exports,{components:{promptAll:void 0},data:function(){return{topicList:[],activeTopic:null,activePromptId:0,searchKeyword:""}},computed:Object(a["a"])({},Object(r["b"])(["vip_expire_time"])),watch:{searchKeyword:function(){this.filterList()},"$route.query":function(){var t=parseInt(this.$route.query.id);t&&(this.$emit("setPromptId",t),t!==this.activePromptId&&(this.activePromptId=t,Object(d["g"])("prompt_id",this.activePromptId),this.scrollToActive()))}},mounted:function(){var t=this;this.setDefaultPrompt(),this.getAllPrompt(),this.$nextTick((function(){setTimeout((function(){t.onScroll()}),300)}))},methods:{setDefaultPrompt:function(){if(this.$route.query.id)this.activePromptId=parseInt(this.$route.query.id),Object(d["g"])("prompt_id",this.activePromptId),this.$emit("setPromptId",this.activePromptId);else{var t=Object(d["b"])("prompt_id");t&&this.setPromptId(parseInt(t))}},filterList:function(){var t=this.searchKeyword.toLowerCase(),i=this.topicList;i.forEach((function(s,e){if(s&&s["prompts"]&&s["prompts"].length>0){var o=!0,a=0;s["prompts"].forEach((function(i,e){-1===i.title.toLowerCase().indexOf(t)?s["prompts"][e].hidden=!0:(a++,s["prompts"][e].hidden=!1,o=!1)})),s.hidden=o,s.listHeight=120*a,i[e]=s}})),this.topicList=i,this.$forceUpdate()},onScroll:function(){var t=this,i=this.$refs.scroll.wrap;i.onscroll=function(){t.handleScroll()}},handleScroll:function(){for(var t=this.$refs.scroll.wrap,i=this.topicList,s=i.length-1;s>=0;s--)if(!i[s].hidden&&0!==i[s].prompts.length&&this.$refs["topic"+i[s].id][0].offsetTop<=t.scrollTop)return void(this.activeTopic=i[s])},scrollToActive:function(){var t=this,i=0,s=0;if(this.activePromptId){var e=this.topicList;e.forEach((function(o,a){e[a].listHeight=120*o["prompts"].length,t.activePromptId&&o["prompts"].forEach((function(e){s+=122,e.id===t.activePromptId&&(i=s-400)}))}))}this.$refs.scroll.wrap.scrollTop=i,this.handleScroll()},getAllPrompt:function(){var t=this;l().then((function(i){t.topicList=i.data,t.$nextTick((function(){t.scrollToActive()}))}))},setPromptId:function(t){t!==this.activePromptId&&(this.activePromptId=t,Object(d["g"])("prompt_id",this.activePromptId),this.$router.replace({query:Object.assign({},this.$route.query?this.$route.query:{},{id:t})}).catch((function(t){})))},doPromptVote:function(t,i){var s=this,e=this.topicList[t].prompts[i];p({prompt_id:e.id}).then((function(o){s.$message.success(o.message),s.topicList[t].prompts[i].isVote=e.isVote?0:1,s.$forceUpdate()})).catch((function(t){403===t.errno&&s.$modals.showLogin()}))},doCollapse:function(t){var i=this,s=this.topicList,e=null,o=this.$refs.scroll.wrap;s.forEach((function(o,a){o.id===t&&(s[a].collapse=!o.collapse,e=i.$refs["topic"+o.id][0])})),this.topicList=s,this.$forceUpdate(),this.$nextTick((function(){i.activeTopic&&t===i.activeTopic.id&&setTimeout((function(){o.scrollTop=e.offsetTop}),500)}))},showPay:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"vip";this.$modals.showPay(t)}}}),T=y,x=Object(b["a"])(T,f,v,!1,null,null,null),I=x.exports,$=function(){var t=this,i=t.$createElement,s=t._self._c||i;return s("div",{},[s("div",{staticClass:"msg-list welcome"},[s("div",{staticClass:"msg-row row-ai"},[s("div",{staticClass:"msg-item"},[t._m(0),s("div",{staticClass:"text markdown-body",staticStyle:{"min-width":"480px","max-width":"600px"}},[t.welcomeTitle?s("div",{staticClass:"title"},[t._v(t._s(t.welcomeTitle))]):t._e(),t.welcomeDesc?s("div",{staticClass:"desc",domProps:{innerHTML:t._s(t.welcomeDesc)}}):t._e(),t.welcomeTips.length>0?s("div",{staticClass:"tips"},[s("ul",t._l(t.welcomeTips,(function(i){return i?s("li",{on:{click:function(s){return t.quickMessage(i)}}},[s("span",[t._v(t._s(i))]),s("i",{staticClass:"el-icon-position"})]):t._e()})),0)]):t._e()])])])])])},k=[function(){var t=this,i=t.$createElement,s=t._self._c||i;return s("div",{staticClass:"avatar"},[s("img",{attrs:{src:"/static/img/ic_ai.png"}})])}],O=(s("8198"),{props:{title:{type:String,default:""},desc:{type:String,default:""},tips:{type:String,default:""}},computed:{welcomeTitle:function(){return this.title?this.$lang("你好！我是")+this.title:""},welcomeDesc:function(){return this.desc?this.desc.replaceAll("\n","<br>"):""},welcomeTips:function(){return this.tips?this.tips.split("\n"):[]}},methods:{quickMessage:function(t){this.$emit("use",t)}}}),j=O,A=Object(b["a"])(j,$,k,!1,null,null,null),S=A.exports,L=s("61b2"),q=new h["a"],M=0,E={name:"Write",components:{Markdown:L["c"],welcome:S,promptList:I},data:function(){return{ai:{},lists:[],message:"",writingText:"",writing:!1,page:1,pagesize:10,prompt_id:0,writePrompt:{}}},computed:Object(a["a"])(Object(a["a"])({},Object(r["b"])(["avatar","aiList","priceSetting"])),{},{aiAvatar:function(){return"/static/img/ic_ai.png"},userAvatar:function(){return this.avatar||"/static/img/ic_user.png"},placeHolder:function(){var t="输入您的问题，Ctrl+回车发送";return this.writePrompt&&this.writePrompt.hint&&(t=this.writePrompt.hint),t},welcomeTitle:function(){return this.writePrompt.title||""},welcomeDesc:function(){return this.writePrompt.welcome||this.writePrompt.hint||""},welcomeTips:function(){return this.writePrompt.tips||""}}),watch:{message:function(){Object(d["g"])("writePrompt",this.message)},aiList:{immediate:!0,handler:function(){this.setDefaultAI()}}},mounted:function(){this.startAutoFocus(),this.setDefaultMessage(),window.handlInputValue=this.miclinkInput},destroyed:function(){M&&clearInterval(M)},methods:{requestAI:function(){if(!this.writing&&!this.writingText){var t=Object(m["f"])(this.message);if(!t)return this.$message.error("请输入您的问题"),void(this.message="");this.lists.push({user:"user",message:t}),this.message="",this.writing=!0,this.scrollBottom();var i=this;q.onMessage=function(t){t&&(i.writingText+=t,i.scrollBottom())},q.onError=function(s){i.lists.pop(),i.message=t,-1!==s.indexOf("请登录")?(i.$modals.showLogin(),setTimeout((function(){i.$message.error(i.$lang(s))}),500)):-1!==s.indexOf("请充值")?(i.showPay(),setTimeout((function(){i.$message.error(i.$lang(s))}),500)):i.$alert(s,"系统提示")},q.onFinish=function(){i.writingText&&i.lists.push({user:"AI",message:i.writingText}),i.writing=!1,i.writingText="",i.scrollBottom()},q.request({message:t,ai:this.ai.name,prompt_id:this.prompt_id})}},showPay:function(){this.isGpt4(this.ai.name)?this.priceSetting.text40_vip?this.$modals.showPay("vip"):this.$modals.showPay("point"):this.$modals.showPay("vip")},miclinkInput:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;t&&(this.message=t),2!==i&&3!==i||this.requestAI()},switchAI:function(t){var i=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],s=this.aiList[t];this.ai.name!==s.name?this.writing?this.$message.warning(this.$lang("输出中，请稍等")):(this.ai=s,this.page=1,this.getHistoryMsg(),i&&this.$message.success("已切换至【"+s.alias+"】"),this.ai.name&&Object(d["g"])("ai",this.ai.name)):this.scrollTop+=1},setPromptId:function(t){this.prompt_id=t,this.prompt_id&&(this.page=1,this.getPrompt(),this.getHistoryMsg())},setDefaultAI:function(){if(this.aiList&&this.aiList.length>0){var t=Object(d["b"])("ai");if(this.ai.name===t)return;var i=0;t&&this.aiList.forEach((function(s,e){s.name===t&&(i=e)})),this.switchAI(i,!1)}},setDefaultMessage:function(){if(this.$route.query.prompt)this.message=decodeURIComponent(this.$route.query.prompt);else{var t=Object(d["b"])("writePrompt");t&&(this.message=t)}},startAutoFocus:function(){var t=this;M=setInterval((function(){var i=window.getSelection?window.getSelection():document.selection.createRange().text;if(i.anchorNode){var s=i.anchorNode.className;if(s&&(-1!==s.indexOf("el-input")||-1!==s.indexOf("el-textarea")))return}!i.toString()&&t.$refs.messageInput&&t.$refs.messageInput.focus()}),1e3)},getHistoryMsg:function(){var t=this;this.ai.name&&this.prompt_id&&Object(n["c"])({ai:this.ai.name,prompt_id:this.prompt_id,page:this.page,pagesize:this.pagesize}).then((function(i){t.lists=i.data.list,t.$nextTick((function(){t.scrollBottom()}))}))},getPrompt:function(){var t=this;u({prompt_id:this.prompt_id}).then((function(i){t.writePrompt=i.data}))},quickMessage:function(t){this.message=t},onEnter:function(t){return t.ctrlKey&&this.requestAI(),!1},retryRequest:function(t){t>0&&(this.message=this.lists[t-1].message,this.requestAI())},stopRequest:function(){var t=this,i=this.writingText;this.writing=!1,q.stop(),setTimeout((function(){i||t.lists.pop()}),50)},scrollBottom:function(){var t=this;this.$nextTick((function(){if(t.$refs["msglist"]){var i=t.$refs["msglist"].wrap;setTimeout((function(){i.scrollTop=i.scrollHeight}),200)}}))},textToHtml:m["d"],toDoc:m["e"],isPPT:m["b"],isTable:m["c"],isGpt4:m["a"]}},H=E,D=Object(b["a"])(H,e,o,!1,null,null,null);i["default"]=D.exports}}]);
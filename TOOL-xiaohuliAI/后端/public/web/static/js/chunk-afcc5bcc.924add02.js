(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-afcc5bcc"],{"114b":function(t,s,i){"use strict";i.d(s,"a",(function(){return e}));i("a7fa"),i("f17d"),i("cac0"),i("0f4e"),i("c9c8"),i("c565"),i("96bb");var a=i("5f87");function e(){var t=this;this.apiUrl="/web.php/chat/sendText",this.onMessage=function(){},this.onError=function(){},this.onFinish=function(){},this.fetchCtrl="",this.outputStacks=[],this.outputSI=0,this.request=function(s){t.fetchCtrl=new AbortController;var i=new Headers;i.append("Content-Type","application/json"),i.append("X-token",Object(a["d"])()||""),i.append("X-site",Object(a["a"])()||""),fetch(this.apiUrl,{method:"POST",headers:i,body:JSON.stringify(s),signal:t.fetchCtrl.signal}).then((function(s){if(s.ok){var i=s.body.getReader(),a=new TextDecoder("utf-8");e(),t.startOutput()}else t.onError(s.statusText);function e(){i.read().then((function(s){var i=s.done,n=s.value;if(i)return t.stopOutput(),void t.onFinish();if(n){var o=a.decode(n);if(o){if(-1!==o.indexOf("[error]"))return t.stopOutput(),t.onError(o.replace("[error]","")),void t.onFinish();for(var c=0;c<o.length;c++)t.outputStacks.push(o[c])}}e()}))}})).catch((function(s){"AbortError"===s.name?(t.stopOutput(),t.onFinish(),console.log("请求已被取消")):console.log("网络错误",s)}))},this.startOutput=function(){t.stopOutput(),t.outputSI=setInterval((function(){t.outputStacks.length>0&&t.onMessage(t.outputStacks.shift())}),24)},this.stopOutput=function(){t.outputSI&&clearInterval(t.outputSI),t.outputSI=0,t.outputStacks.length>0&&t.onMessage(t.outputStacks.join("")),t.outputStacks=[]},this.stop=function(){t.fetchCtrl&&(t.fetchCtrl.abort(),t.fetchCtrl=null),t.stopOutput(),t.onFinish()}}},"7c2c":function(t,s,i){"use strict";i.r(s);var a=function(){var t=this,s=t.$createElement,i=t._self._c||s;return i("div",{staticClass:"module-batch"},[i("div",{staticClass:"sub-sidebar"},[i("div",{staticClass:"module-header"},[t._m(0),i("el-button",{staticClass:"item",attrs:{size:"small",type:"primary",plain:"",icon:"el-icon-circle-plus"},on:{click:function(s){return t.showBatchForm("")}}},[t._v("创建任务组")])],1),i("div",{staticClass:"module-body"},[i("el-scrollbar",{attrs:{"wrap-class":"scrollbar-wrapper"}},[i("div",{staticClass:"batch-list"},[t._l(t.batchList,(function(s){return i("div",{staticClass:"batch-item",class:{active:t.activeBatchId===s.batch_id},on:{click:function(i){return t.switchBatch(s.batch_id)}}},[i("div",{staticClass:"item-header"},[0===s.count_finished?i("el-tag",{attrs:{type:"info",size:"small"}},[t._v("未开始")]):s.count_finished<s.count_total?i("el-tag",{attrs:{type:"warning",size:"small"}},[t._v("未完成")]):s.count_finished===s.count_total?i("el-tag",{attrs:{type:"success",size:"small"}},[t._v("已完成")]):t._e(),i("div",{staticClass:"count"},[t._v(t._s(s.count_finished)+" / "+t._s(s.count_total))])],1),i("div",{staticClass:"item-body"},[t._v(t._s(s.prompt||"没有定义指令"))]),i("div",{staticClass:"item-footer"},[i("div",{staticClass:"time"},[t._v(" "+t._s(s.create_time)+" ")]),i("div",{staticClass:"ops",on:{click:function(t){t.stopPropagation()}}},[i("el-dropdown",{attrs:{trigger:"click"}},[i("span",{staticClass:"el-dropdown-link"},[i("i",{staticClass:"btn-dropdown el-icon-more"})]),i("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[i("el-dropdown-item",{nativeOn:{click:function(i){return i.stopPropagation(),t.showBatchForm(s.batch_id)}}},[t._v(t._s(t._f("lang")("编辑")))]),i("el-dropdown-item",{staticClass:"text-danger",nativeOn:{click:function(i){return i.stopPropagation(),t.delBatch(s.batch_id)}}},[t._v(t._s(t._f("lang")("删除")))])],1)],1)],1)])])})),t.hasMore?i("div",{staticClass:"load-more",on:{click:t.getBatchList}},[i("svg-icon",{staticClass:"icon",attrs:{"icon-class":"ic_load_more"}}),i("span",[t._v("加载更多")])],1):i("div",{staticClass:"no-more"},[i("svg-icon",{staticClass:"icon",attrs:{"icon-class":"ic_load_more"}}),i("span",[t._v("到底了~")])],1)],2)])],1)]),i("div",{staticClass:"main-wrapper"},[t.activeBatchId?i("task-list",{attrs:{batch_id:t.activeBatchId},on:{showBatchForm:t.showBatchForm,setBatchInfo:t.setBatchInfo,setWriting:t.setWriting}}):i("welcome",{attrs:{tips:t.batchList.length>0?"请选择任务组":"请先创建任务组"}})],1),t.batchForm?i("div",[i("el-dialog",{attrs:{"custom-class":"my-dialog",title:t._f("lang")(t.batchForm.batch_id?"任务组设置":"创建任务组"),width:"660px",visible:!0,"close-on-click-modal":!0,"append-to-body":!0,"before-close":t.closeBatchForm}},[i("el-form",{ref:"form",staticStyle:{padding:"20px 0"},attrs:{model:t.batchForm,"label-width":"100px"}},[i("el-form-item",{attrs:{label:t._f("lang")("AI通道")}},[i("el-select",{attrs:{placeholder:"请选择"},model:{value:t.batchForm.ai,callback:function(s){t.$set(t.batchForm,"ai",s)},expression:"batchForm.ai"}},t._l(t.aiList,(function(t){return i("el-option",{attrs:{label:t.alias,value:t.name}})})),1),t.isGpt4(t.batchForm.ai)?i("div",{staticClass:"text-primary"},[t.priceSetting.text40>0?i("p",{staticStyle:{"line-height":"24px",margin:"5px 0","font-size":"16px"}},[t._v("高级通道，每个子任务消耗 "+t._s(t.priceSetting.text40)+" "+t._s(t.priceSetting.title)),t.priceSetting.text40_vip?i("span",[t._v("（会员免费）")]):t._e()]):i("p",{staticStyle:{"line-height":"24px",margin:"5px 0","font-size":"16px"}},[t._v("高级通道，免费使用")])]):i("div",{staticClass:"text-primary"},[t.priceSetting.text35>0?i("p",{staticStyle:{"line-height":"24px",margin:"5px 0","font-size":"16px"}},[t._v("每个子任务消耗 "+t._s(t.priceSetting.text35)+" "+t._s(t.priceSetting.title)),t.priceSetting.text35_vip?i("span",[t._v("（会员免费）")]):t._e()]):i("p",{staticStyle:{"line-height":"24px",margin:"5px 0","font-size":"16px"}},[t._v("免费使用")])])],1),i("el-form-item",{attrs:{label:t._f("lang")("前置指令")}},[i("el-input",{staticStyle:{width:"480px"},attrs:{type:"textarea",rows:8,placeholder:t._f("lang")("如：请按照下面标题，写一篇3000字文章，符合SEO要求，并在文章结尾生成5个关键词"),size:"normal"},model:{value:t.batchForm.prompt,callback:function(s){t.$set(t.batchForm,"prompt",s)},expression:"batchForm.prompt"}})],1)],1),i("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{attrs:{type:"default",icon:"el-icon-close",size:"small"},on:{click:t.closeBatchForm}},[t._v(t._s(t._f("lang")("取 消")))]),i("el-button",{attrs:{type:"primary",icon:"el-icon-check",size:"small"},on:{click:t.saveBatchInfo}},[t._v(t._s(t._f("lang")("确 定")))])],1)],1)],1):t._e()])},e=[function(){var t=this,s=t.$createElement,i=t._self._c||s;return i("div",[i("i",{staticClass:"icon el-icon-s-unfold"}),i("span",[t._v("批量生成")])])}],n=i("e089"),o=(i("58d4"),i("c565"),i("233b"),i("cb2e"),i("6db4")),c=i("b775");function r(t){return Object(c["a"])({url:"/batch/getBatchList",method:"post",data:t})}function l(t){return Object(c["a"])({url:"/batch/getBatchInfo",method:"post",data:t})}function h(t){return Object(c["a"])({url:"/batch/saveBatchInfo",method:"post",data:t})}function d(t){return Object(c["a"])({url:"/batch/delBatch",method:"post",data:t})}function p(t){return Object(c["a"])({url:"/batch/getTaskList",method:"post",data:t})}function u(t){return Object(c["a"])({url:"/batch/delTask",method:"post",data:t})}function m(t){return Object(c["a"])({url:"/batch/saveTask",method:"post",data:t})}function f(t){return Object(c["a"])({url:"/batch/delAllTask",method:"post",data:t})}var g=i("ca00"),v=function(){var t=this,s=t.$createElement,i=t._self._c||s;return i("div",{staticClass:"task-empty"},[i("div",{staticClass:"box-empty"},[i("p",{staticClass:"icon"},[i("svg-icon",{attrs:{"icon-class":"ic_empty"}})],1),i("p",{staticClass:"tips"},[t._v(t._s(t.tips))])])])},b=[],_={props:{tips:{type:String,default:"请先添加或导入任务"}}},k=_,w=i("76b2"),x=Object(w["a"])(k,v,b,!1,null,null,null),y=x.exports,I=function(){var t=this,s=t.$createElement,i=t._self._c||s;return i("div",{staticClass:"box-task"},[i("div",{staticClass:"task-toolbar"},[i("div",{staticStyle:{width:"550px",display:"flex","justify-content":"space-between","align-items":"center"}},[i("div",[i("el-button",{attrs:{size:"small",icon:"el-icon-plus",type:"primary"},on:{click:function(s){return t.showTaskForm(null)}}},[t._v("添加任务")]),i("el-button",{attrs:{size:"small",icon:"el-icon-upload2",type:"default"},on:{click:t.showImportForm}},[t._v("批量导入任务")])],1),i("div",[t.taskList&&t.taskList.length>0?i("el-button",{attrs:{size:"small",type:"default",loading:t.taskRunning},on:{click:t.startAllTask}},[t.taskRunning?t._e():i("svg-icon",{attrs:{"icon-class":"ic_play"}}),t._v(" 全部开始 ")],1):t._e()],1)]),i("div",[i("el-button",{attrs:{size:"small",icon:"el-icon-s-tools",type:"default"},on:{click:t.openSetting}},[t._v("设置")]),i("el-button",{attrs:{size:"small",icon:"el-icon-brush",type:"default"},on:{click:t.delAllTask}},[t._v("清空任务列表")]),i("el-button",{attrs:{size:"small",icon:"el-icon-download",type:"default"},on:{click:t.exportZip}},[t._v("打包下载")])],1)]),t.activeIndex>=0?i("div",{staticClass:"task-main"},[i("el-scrollbar",{ref:"task-list",staticClass:"task-list",attrs:{"wrap-class":"scrollbar-wrapper"}},t._l(t.taskList,(function(s,a){return i("div",{staticClass:"task-item",class:{active:t.taskList[t.activeIndex].id===s.id},on:{click:function(s){return t.switchTask(a)}}},[i("div",{staticClass:"td index"},[i("span",[t._v("# "+t._s(t.tableIndex(a)))])]),i("div",{staticClass:"td state"},[1===s.state?i("el-tag",{attrs:{type:"success",size:"small"}},[t._v("已完成")]):a===t.activeIndex&&t.writing?i("el-tag",{attrs:{type:"warning",size:"small"}},[t._v("生成中")]):i("el-tag",{attrs:{type:"info",size:"small"}},[t._v("未开始")])],1),i("div",{staticClass:"td title"},[t._v(" "+t._s(s.message)+" ")]),i("div",{staticClass:"ops"},[i("el-dropdown",{attrs:{trigger:"click"}},[i("span",{staticClass:"el-dropdown-link"},[i("i",{staticClass:"btn-dropdown el-icon-more"})]),i("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[i("el-dropdown-item",{nativeOn:{click:function(s){return s.stopPropagation(),t.showTaskForm(a)}}},[t._v(t._s(t._f("lang")("编辑")))]),i("el-dropdown-item",{staticClass:"text-danger",nativeOn:{click:function(s){return s.stopPropagation(),t.delTask(a)}}},[t._v(t._s(t._f("lang")("删除")))])],1)],1)],1)])})),0),i("div",{staticClass:"task-chat box-chat"},[i("el-scrollbar",{ref:"chat-list",attrs:{"wrap-class":"scrollbar-wrapper"}},[t.activeIndex>=0?i("div",{staticClass:"chat-msg style-word"},[i("div",{staticClass:"msg-list"},[i("div",{staticClass:"msg-row row-user"},[i("div",{staticClass:"msg-item"},[i("div",{staticClass:"text markdown-body",domProps:{innerHTML:t._s(t.textToHtml(t.taskList[t.activeIndex].message))}})]),i("div",{staticStyle:{clear:"both"}})]),t.taskList[t.activeIndex].response?i("div",{staticClass:"msg-row row-ai"},[i("div",{staticClass:"msg-item"},[i("div",{staticClass:"text markdown-body"},[i("Markdown",{attrs:{id:"message-"+t.taskList[t.activeIndex].id,text:t.taskList[t.activeIndex].response,"show-tools":!0,"show-count":!0,"show-ppt":t.isPPT(t.taskList[t.activeIndex].message),"show-table":t.isTable(t.taskList[t.activeIndex].message),index:t.activeIndex},on:{retry:t.retryRequest}})],1)]),i("div",{staticStyle:{clear:"both"}})]):t.writing||t.taskList[t.activeIndex].writingText?i("div",{staticClass:"msg-row row-ai"},[i("div",{staticClass:"msg-item"},[i("div",{staticClass:"text markdown-body"},[i("Markdown",{attrs:{text:t.writingText,writing:!(!t.writing&&!t.writingText),"show-count":!0}}),i("div",{staticClass:"tools"},[i("span",{staticClass:"btn text-primary",on:{click:t.stopRequest}},[i("svg-icon",{staticClass:"icon",attrs:{"icon-class":"ic_stop"}}),t._v(t._s(t._f("lang")("停止生成")))],1)])],1)])]):i("div",{staticClass:"msg-row row-ai"},[i("div",{staticClass:"msg-item"},[i("div",{staticClass:"text markdown-body"},[i("span",{staticClass:"btn text-primary",staticStyle:{cursor:"pointer"},on:{click:t.requestAI}},[i("svg-icon",{staticClass:"icon",attrs:{"icon-class":"ic_play"}}),t._v(t._s(t._f("lang")("开始生成")))],1)])])])])]):t._e()])],1)],1):t._e(),t.taskList&&0!==t.taskList.length?t._e():i("welcome",{attrs:{tips:"请先添加或导入任务"}}),t.taskForm?i("div",[i("el-dialog",{attrs:{"custom-class":"my-dialog",title:t._f("lang")(t.taskForm.id?"编辑":"添加任务"),width:"600px",visible:!0,"close-on-click-modal":!0,"append-to-body":!0,"before-close":t.closeTaskForm}},[i("el-form",{ref:"form",staticStyle:{padding:"20px 0"},attrs:{model:t.taskForm,"label-width":"90px"}},[i("el-form-item",{attrs:{label:t._f("lang")("内容")}},[i("el-input",{staticStyle:{width:"430px"},attrs:{type:"textarea",rows:6,placeholder:"请输入",size:"normal"},model:{value:t.taskForm.message,callback:function(s){t.$set(t.taskForm,"message",s)},expression:"taskForm.message"}})],1)],1),i("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{attrs:{type:"default",icon:"el-icon-close",size:"small"},on:{click:t.closeTaskForm}},[t._v(t._s(t._f("lang")("取 消")))]),i("el-button",{attrs:{type:"primary",icon:"el-icon-check",size:"small"},on:{click:t.saveTask}},[t._v(t._s(t._f("lang")("提 交")))])],1)],1)],1):t._e(),t.importForm?i("div",[i("el-dialog",{attrs:{"custom-class":"my-dialog",title:t._f("lang")("批量导入任务"),width:"400px",visible:!0,"close-on-click-modal":!0,"append-to-body":!0,"before-close":t.closeImportForm}},[i("div",{staticStyle:{"text-align":"center"}},[i("p",[i("el-upload",{staticClass:"btn-import",attrs:{"before-upload":t.checkExcelFile,"on-success":t.importTaskSuccess,"show-file-list":!1,action:"/web.php/batch/importTask",data:{batch_id:t.batch_id}}},[i("el-button",{attrs:{type:"primary",icon:"el-icon-upload2",size:"large"}},[t._v(t._s(t._f("lang")("选择 Excel 文件")))])],1)],1),i("p",{staticStyle:{"font-size":"14px",margin:"30px 0"}},[i("a",{staticClass:"text-primary",attrs:{href:"/static/task.xlsx"}},[i("span",{staticStyle:{"margin-left":"10px"}},[t._v("下载导入模板")])])])])])],1):t._e(),t.zipExporting?i("div",{staticStyle:{opacity:"0"}},t._l(t.taskList,(function(s,a){return i("div",[1===s.state&&s.response?i("Markdown",{attrs:{id:"zipHtml-"+s.id,text:s.response}}):t._e()],1)})),0):t._e()],1)},T=[],L=(i("c9c8"),i("61b2")),C=i("fcf0"),F=i.n(C),B=i("0079"),$=i.n(B),S=i("4e9e"),O=i.n(S),z=i("114b"),j=new z["a"],E={name:"Batch",components:{Markdown:L["c"],welcome:y},props:{batch_id:{type:String,default:""},ai:{type:String,default:""}},data:function(){return{batchInfo:null,activeIndex:-1,taskList:[],taskForm:null,taskRunning:!1,importForm:null,writing:!1,writingText:"",zipExporting:!1}},computed:Object(n["a"])({},Object(o["b"])(["priceSetting"])),watch:{batch_id:{immediate:!0,handler:function(){this.activeIndex=-1,this.getTaskList()}},writing:function(){this.$emit("setWriting",this.writing)}},methods:{requestAI:function(){if(!this.writing&&!this.writingText){var t=Object(g["f"])(this.taskList[this.activeIndex].message);if(t){this.writing=!0,this.scrollBottom();var s=this;j.onMessage=function(t){t&&(s.writingText+=t,s.scrollBottom())},j.onError=function(t){s.writing=!1,s.writingText="",s.taskRunning=!1,-1!==t.indexOf("请登录")?(s.$modals.showLogin(),setTimeout((function(){s.$message.error(s.$lang(t))}),500)):-1!==t.indexOf("请充值")?(s.showPay(),setTimeout((function(){s.$message.error(s.$lang(t))}),500)):s.$alert(t,"系统提示")},j.onFinish=function(){s.writingText&&(s.taskList[s.activeIndex].response=s.writingText,s.taskList[s.activeIndex].state=1),s.writing=!1,s.writingText="",s.scrollBottom(),s.taskRunning&&setTimeout((function(){s.startAllTask()}),1e3)},j.request({message:t,batch_id:s.batch_id,task_id:s.taskList[s.activeIndex].id})}else this.$message.error("无内容")}},showPay:function(){Object(g["a"])(this.ai)?this.priceSetting.text40_vip?this.$modals.showPay("vip"):this.$modals.showPay("point"):this.$modals.showPay("vip")},retryRequest:function(){this.writing=!1,this.writingText="",this.taskList[this.activeIndex].response="",this.taskList[this.activeIndex].state=0,this.requestAI()},stopRequest:function(){var t=this,s=this.writingText;this.writing=!1,this.taskRunning=!1,j.stop(),setTimeout((function(){s||(t.taskList[t.activeIndex].response="",t.taskList[t.activeIndex].state=0)}),50)},scrollBottom:function(){var t=this;this.$nextTick((function(){if(t.$refs["chat-list"]){var s=t.$refs["chat-list"].wrap;setTimeout((function(){s.scrollTop=s.scrollHeight}),200)}}))},scrollTaskToView:function(){var t=this;this.$nextTick((function(){if(t.$refs["task-list"]){var s=t.$refs["task-list"].wrap;setTimeout((function(){var i=48,a=3*i,e=t.activeIndex*i,n=parseInt(s.scrollTop),o=s.offsetHeight;e<n?s.scrollTop=e-a:e-o+i>n&&(s.scrollTop=e-o+a)}),200)}}))},startAllTask:function(){if(this.writing)this.$message.error("已有任务正在运行中");else{for(var t=this.taskList,s=0;s<t.length;s++)if(0===t[s].state)return this.switchTask(s),this.scrollTaskToView(),this.taskRunning=!0,this.taskList[s].response="",void this.requestAI();this.taskRunning=!1,this.$message.success("所有任务已执行完毕")}},openSetting:function(){this.$emit("showBatchForm",this.batch_id)},getTaskList:function(){var t=this;this.batch_id?p({batch_id:this.batch_id}).then((function(s){t.taskList=s.data,t.taskList.length>0&&t.switchTask(0),t.getBatchInfo()})).catch((function(s){403===s.errno&&t.$modals.showLogin()})):this.taskList=[]},switchTask:function(t){this.writing?this.$message.error("任务执行中，请停止后切换"):this.activeIndex=t},tableIndex:function(t){return t+=1,t<10&&(t="0"+t),t},showTaskForm:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(null===t)this.taskForm={batch_id:this.batch_id,message:""};else{if(this.taskRunning&&this.activeIndex===t)return void this.$message.error("请先停止任务");var s=this.taskList[t];this.taskForm={batch_id:this.batch_id,task_id:s.id,message:s.message}}},closeTaskForm:function(){this.taskForm=null},delTask:function(t){var s=this;if(this.taskRunning&&this.activeIndex===t)this.$message.error("请先停止任务");else{var i=this.taskList[t].id;this.$confirm("删除后不可恢复，确认吗?","提示",{confirmButtonText:"确定删除",cancelButtonText:"取消",type:"warning"}).then((function(){u({batch_id:s.batch_id,task_id:i}).then((function(){s.activeIndex===s.taskList.length-1&&s.activeIndex--,s.taskList.splice(t,1),s.getBatchInfo()})).catch((function(t){403===t.errno&&s.$modals.showLogin()}))}))}},getBatchInfo:function(){var t=this;l({batch_id:this.batch_id}).then((function(s){t.batchInfo=s.data,t.$emit("setBatchInfo",t.batchInfo)})).catch((function(s){403===s.errno&&t.$modals.showLogin()}))},saveTask:function(){var t=this;m(this.taskForm).then((function(s){t.$message.success(s.message),t.taskForm.task_id?t.taskList[t.activeIndex].message=t.taskForm.message:(t.taskList.push({id:s.data.task_id,message:t.taskForm.message,response:"",total_tokens:0,state:0}),-1===t.activeIndex&&(t.activeIndex=0),t.getBatchInfo()),t.closeTaskForm()})).catch((function(s){403===s.errno&&t.$modals.showLogin()}))},showImportForm:function(){this.taskRunning?this.$message.error("请先停止任务"):this.importForm={}},closeImportForm:function(){this.importForm=null},checkExcelFile:function(t){if("application/vnd.ms-excel"!==t.type&&"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"!==t.type)return this.$message.error(this.$lang("请上传Excel文件")),!1},importTaskSuccess:function(t,s,i){t.errno>0?this.$message.error(t.message):(this.getTaskList(),this.closeImportForm(),this.$message.success(t.message))},delAllTask:function(){var t=this;this.$confirm("删除后不可恢复，确认吗?","提示",{confirmButtonText:"确定删除",cancelButtonText:"取消",type:"warning"}).then((function(){f({batch_id:t.batch_id}).then((function(s){t.activeIndex=-1,t.taskList=[],t.getBatchInfo(),t.$message.success(s.message)}))})).catch((function(s){403===s.errno&&t.$modals.showLogin()}))},exportZip:function(){var t=this,s=new F.a,i=0;this.zipExporting=!0,this.$loading({fullscreen:!0,lock:!0,text:"正在打包",background:"rgba(0,0,0,0.3)",customClass:"my-loading"}),this.$nextTick((function(){for(var a=0;a<t.taskList.length;a++){var e=t.taskList[a];if(1===e.state&&e.response){t.zipExportHtml=e.response;var n='<div style="font-size: 12pt;">'+t.textToHtml(e.response)+"</div>";e.message.length<=50&&(n="<p><center><h2>"+e.message+"</h2></center></p>"+n),s.file(e.message.substr(0,30)+".docx",$.a.asBlob(n)),i++}}t.zipExporting=!1,t.$loading().close(),0!==i?s.generateAsync({type:"blob"}).then((function(t){O.a.saveAs(t,"data.zip")})):t.$message.error("请先生成内容")}))},textToHtml:g["d"],isPPT:g["b"],isTable:g["c"]}},P=E,A=Object(w["a"])(P,I,T,!1,null,null,null),R=A.exports,M={name:"Batch",components:{taskList:R,welcome:y},data:function(){return{batchList:[],page:1,pagesize:10,hasMore:!1,activeBatchId:"",batchForm:null,writing:!1}},computed:Object(n["a"])({},Object(o["b"])(["aiList","priceSetting"])),mounted:function(){this.getBatchList()},methods:{getBatchList:function(){var t=this;r({page:this.page,pagesize:this.pagesize}).then((function(s){t.batchList=t.batchList.concat(s.data.list),1===t.page&&t.batchList.length>0&&t.switchBatch(s.data.list[0].batch_id),t.hasMore=t.batchList.length<s.data.count,t.page++})).catch((function(s){403===s.errno&&t.$modals.showLogin()}))},setBatchInfo:function(t){var s=this.getBatchIndex(t.batch_id);this.batchList[s].ai=t.ai,this.batchList[s].prompt=t.prompt,this.batchList[s].count_finished=t.count_finished,this.batchList[s].count_total=t.count_total,t.create_time&&(this.batchList[s].create_time=t.create_time)},setWriting:function(t){this.writing=t},showBatchForm:function(){var t=this,s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";s?l({batch_id:s}).then((function(s){t.batchForm={batch_id:s.data.batch_id,ai:s.data.ai,prompt:s.data.prompt}})):this.batchForm={ai:this.aiList.length>0?this.aiList[0].name:"",prompt:""}},closeBatchForm:function(){this.batchForm=null},delBatch:function(t){var s=this,i=this.getBatchIndex(t);this.activeBatchId===t&&this.writing?this.$message.error("请先停止任务"):this.$confirm("删除后不可恢复，确认删除吗?","提示",{confirmButtonText:"确定删除",cancelButtonText:"取消",type:"warning"}).then((function(){d({batch_id:t}).then((function(a){s.batchList.splice(i,1),s.activeBatchId===t&&(s.activeBatchId=""),s.$forceUpdate()})).catch((function(t){403===t.errno&&s.$modals.showLogin()}))}))},getBatchIndex:function(t){for(var s=-1,i=this.batchList,a=0;a<i.length;a++)if(i[a].batch_id===t){s=a;break}return s},saveBatchInfo:function(){var t=this;this.batchForm.ai?h(this.batchForm).then((function(s){if(t.batchForm.batch_id){var i=t.getBatchIndex(t.batchForm.batch_id);t.batchList[i]=s.data}else t.batchList.unshift(s.data),t.writing||t.switchBatch(s.data.batch_id);t.$message.success(s.message),t.closeBatchForm()})).catch((function(s){403===s.errno&&t.$modals.showLogin()})):this.$message.error("请选择AI通道")},switchBatch:function(t){this.activeBatchId!==t&&(this.writing?this.$message.error("请先停止任务"):this.activeBatchId=t)},isGpt4:g["a"],textToHtml:g["d"],isPPT:g["b"],isTable:g["c"]}},q=M,H=Object(w["a"])(q,a,e,!1,null,null,null);s["default"]=H.exports}}]);
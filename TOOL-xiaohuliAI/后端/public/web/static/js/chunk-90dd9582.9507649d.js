(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-90dd9582"],{"114b":function(t,e,i){"use strict";i.d(e,"a",(function(){return n}));i("a7fa"),i("f17d"),i("cac0"),i("0f4e"),i("c9c8"),i("c565"),i("96bb");var s=i("5f87");function n(){var t=this;this.apiUrl="/web.php/chat/sendText",this.onMessage=function(){},this.onError=function(){},this.onFinish=function(){},this.fetchCtrl="",this.outputStacks=[],this.outputSI=0,this.request=function(e){t.fetchCtrl=new AbortController;var i=new Headers;i.append("Content-Type","application/json"),i.append("X-token",Object(s["d"])()||""),i.append("X-site",Object(s["a"])()||""),fetch(this.apiUrl,{method:"POST",headers:i,body:JSON.stringify(e),signal:t.fetchCtrl.signal}).then((function(e){if(e.ok){var i=e.body.getReader(),s=new TextDecoder("utf-8");n(),t.startOutput()}else t.onError(e.statusText);function n(){i.read().then((function(e){var i=e.done,o=e.value;if(i)return t.stopOutput(),void t.onFinish();if(o){var a=s.decode(o);if(a){if(-1!==a.indexOf("[error]"))return t.stopOutput(),t.onError(a.replace("[error]","")),void t.onFinish();for(var c=0;c<a.length;c++)t.outputStacks.push(a[c])}}n()}))}})).catch((function(e){"AbortError"===e.name?(t.stopOutput(),t.onFinish(),console.log("请求已被取消")):console.log("网络错误",e)}))},this.startOutput=function(){t.stopOutput(),t.outputSI=setInterval((function(){t.outputStacks.length>0&&t.onMessage(t.outputStacks.shift())}),24)},this.stopOutput=function(){t.outputSI&&clearInterval(t.outputSI),t.outputSI=0,t.outputStacks.length>0&&t.onMessage(t.outputStacks.join("")),t.outputStacks=[]},this.stop=function(){t.fetchCtrl&&(t.fetchCtrl.abort(),t.fetchCtrl=null),t.stopOutput(),t.onFinish()}}},"199c":function(t,e,i){"use strict";var s=i("a158"),n=i("9372"),o=i("74e8"),a=i("e16b"),c=i("907e2"),r=i("6368"),l=RangeError,d=String,u=Math.floor,m=n(c),p=n("".slice),f=n(1..toFixed),h=function(t,e,i){return 0===e?i:e%2===1?h(t,e-1,i*t):h(t*t,e/2,i)},v=function(t){var e=0,i=t;while(i>=4096)e+=12,i/=4096;while(i>=2)e+=1,i/=2;return e},g=function(t,e,i){var s=-1,n=i;while(++s<6)n+=e*t[s],t[s]=n%1e7,n=u(n/1e7)},b=function(t,e){var i=6,s=0;while(--i>=0)s+=t[i],t[i]=u(s/e),s=s%e*1e7},w=function(t){var e=6,i="";while(--e>=0)if(""!==i||0===e||0!==t[e]){var s=d(t[e]);i=""===i?s:i+m("0",7-s.length)+s}return i},_=r((function(){return"0.000"!==f(8e-5,3)||"1"!==f(.9,0)||"1.25"!==f(1.255,2)||"1000000000000000128"!==f(0xde0b6b3a7640080,0)}))||!r((function(){f({})}));s({target:"Number",proto:!0,forced:_},{toFixed:function(t){var e,i,s,n,c=a(this),r=o(t),u=[0,0,0,0,0,0],f="",_="0";if(r<0||r>20)throw new l("Incorrect fraction digits");if(c!==c)return"NaN";if(c<=-1e21||c>=1e21)return d(c);if(c<0&&(f="-",c=-c),c>1e-21)if(e=v(c*h(2,69,1))-69,i=e<0?c*h(2,-e,1):c/h(2,e,1),i*=4503599627370496,e=52-e,e>0){g(u,0,i),s=r;while(s>=7)g(u,1e7,0),s-=7;g(u,h(10,s,1),0),s=e-1;while(s>=23)b(u,1<<23),s-=23;b(u,1<<s),g(u,1,1),b(u,2),_=w(u)}else g(u,0,i),g(u,1<<-e,0),_=w(u)+m("0",r);return r>0?(n=_.length,_=f+(n<=r?"0."+m("0",r-n)+_:p(_,0,n-r)+"."+p(_,n-r))):_=f+_,_}})},"1a7a":function(t,e,i){},"2b89":function(t,e,i){},"2c6a":function(t,e,i){"use strict";i("2b89")},"2d62":function(t,e,i){"use strict";i.r(e);var s=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"module-docs"},[i("div",{staticClass:"sub-sidebar"},[i("div",{staticClass:"module-header"},[t._m(0),i("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"PDF / Word / PPT / TXT",placement:"bottom"}},[i("el-upload",{attrs:{action:"","before-upload":t.uploadDocCheck,"http-request":t.uploadDoc,"show-file-list":!1,multiple:!1,accept:".pdf,.doc,.docx,.ppt,.pptx,.txt"}},[i("el-button",{attrs:{size:"small",type:"primary",plain:"",icon:"el-icon-circle-plus"}},[t._v("上传文档")])],1)],1)],1),i("div",{staticClass:"module-body"},[i("el-scrollbar",{attrs:{"wrap-class":"scrollbar-wrapper"}},[i("div",{staticClass:"docs-list"},t._l(t.docList,(function(e){return i("div",{staticClass:"doc-item",class:{active:t.activeDoc&&e.file_id===t.activeDoc.file_id},attrs:{title:e.title+"."+e.ext},on:{click:function(i){return t.selectDoc(e)}}},["pdf"===e.ext?i("svg-icon",{staticClass:"icon",attrs:{"icon-class":"ic_doc_pdf"}}):"doc"===e.ext||"docx"===e.ext?i("svg-icon",{staticClass:"icon",attrs:{"icon-class":"ic_doc_word"}}):"ppt"===e.ext||"pptx"===e.ext?i("svg-icon",{staticClass:"icon",attrs:{"icon-class":"ic_doc_ppt"}}):"txt"===e.ext?i("svg-icon",{staticClass:"icon",attrs:{"icon-class":"ic_doc_txt"}}):"xls"===e.ext||"xlsx"===e.ext?i("svg-icon",{staticClass:"icon",attrs:{"icon-class":"ic_doc_excel"}}):"zip"===e.ext?i("svg-icon",{staticClass:"icon",attrs:{"icon-class":"ic_doc_zip"}}):"url"===e.ext?i("svg-icon",{staticClass:"icon",attrs:{"icon-class":"ic_doc_link"}}):i("svg-icon",{staticClass:"icon",attrs:{"icon-class":"ic_doc_unknow"}}),i("div",{staticClass:"doc-info"},[i("div",{staticClass:"title"},[t._v(t._s(e.title)+"."+t._s(e.ext))]),i("div",{staticClass:"state"},[i("span",{staticClass:"size"},[t._v(t._s(t.formatSize(e.file_size)))]),!isNaN(e.extracted)&&e.extracted<3?i("span",{staticClass:"state-msg"},[i("svg-icon",{staticClass:"loading",attrs:{"icon-class":"ic_doc_loading"}}),t._v(" 解析中")],1):t._e()])]),i("el-dropdown",{attrs:{trigger:"click"}},[i("span",{staticClass:"el-dropdown-link"},[i("i",{staticClass:"btn-dropdown el-icon-more"})]),i("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[i("el-dropdown-item",{nativeOn:{click:function(i){return i.stopPropagation(),t.showDocRename(e.file_id,e.title)}}},[t._v(t._s(t._f("lang")("重命名")))]),i("el-dropdown-item",{staticClass:"text-danger",nativeOn:{click:function(i){return i.stopPropagation(),t.delDoc(e.file_id)}}},[t._v(t._s(t._f("lang")("删除")))])],1)],1)],1)})),0)])],1)]),t.renameDoc?i("div",[i("el-dialog",{attrs:{"custom-class":"my-dialog",title:"文件重命名",width:"440px",visible:!0,"close-on-click-modal":!1,"append-to-body":!0,"before-close":t.closeDocRename}},[i("el-form",{ref:"form",staticStyle:{padding:"20px 0"},attrs:{model:t.renameDoc,"label-width":"100px"}},[i("el-form-item",{attrs:{label:"新名称"}},[i("el-input",{ref:"renameInput",staticStyle:{width:"240px"},attrs:{placeholder:"请输入新名称",size:"normal"},model:{value:t.renameDoc.title,callback:function(e){t.$set(t.renameDoc,"title",e)},expression:"renameDoc.title"}})],1)],1),i("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{attrs:{type:"default",icon:"el-icon-close",size:"small"},on:{click:t.closeDocRename}},[t._v(t._s(t._f("lang")("取 消")))]),i("el-button",{attrs:{type:"primary",icon:"el-icon-check",size:"small"},on:{click:t.setDocTitle}},[t._v(t._s(t._f("lang")("提 交")))])],1)],1)],1):t._e(),i("div",{staticClass:"main-wrapper"},[i("div",{staticClass:"docs-reader",staticStyle:{bottom:"0"}},[i("iframe",{staticClass:"pdf-window",staticStyle:{width:"100%",height:"100%"},attrs:{id:"pdf-iframe-preview",src:t.fileUrl,frameborder:"0"}})]),i("div",{staticClass:"docs-handle"},[i("div",{staticClass:"handle-header"},[i("div",{staticClass:"tab-list"},[i("div",{staticClass:"tabs"},[i("div",{staticClass:"tab-item",class:{active:"abstract"===t.activeTab},on:{click:function(e){return t.switchTab("abstract")}}},[t._v("导读摘要")]),i("div",{staticClass:"tab-item",class:{active:"mind"===t.activeTab},on:{click:function(e){return t.switchTab("mind")}}},[t._v("思维导图")]),i("div",{staticClass:"tab-item",class:{active:"chat"===t.activeTab},on:{click:function(e){return t.switchTab("chat")}}},[t._v("AI提问")])])])]),i("div",{staticClass:"handle-body"},["abstract"===t.activeTab?i("el-scrollbar",{attrs:{"wrap-class":"scrollbar-wrapper"}},[i("div",{staticClass:"docs-abstract markdown-body"},[t.activeDoc&&t.activeDoc.abstract?i("Markdown",{attrs:{text:t.activeDoc.abstract}}):t._e()],1)]):"mind"===t.activeTab?i("DocMind",{attrs:{content:t.activeDoc.mind}}):"chat"===t.activeTab?i("DocChat",{attrs:{file_id:t.activeDoc.file_id,questions:t.activeDoc.questions}}):t._e()],1)])])])},n=[function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"title"},[i("i",{staticClass:"icon el-icon-s-unfold"}),i("span",[t._v("文件列表")])])}],o=(i("233b"),i("c565"),i("b5aa"),i("cb2e"),i("199c"),i("a7fa"),i("d3da"),i("b775"));function a(t){return Object(o["a"])({url:"/doc/getDocList",method:"post",data:t})}function c(t){return Object(o["a"])({url:"/doc/uploadDoc",method:"post",data:t})}function r(t){return Object(o["a"])({url:"/doc/setDocTitle",method:"post",data:t})}function l(t){return Object(o["a"])({url:"/doc/delDoc",method:"post",data:t})}function d(t){return Object(o["a"])({url:"/doc/getHistoryMsg",method:"post",data:t})}function u(t){return Object(o["a"])({url:"/doc/extract",method:"post",data:t,hideLoading:!0})}var m=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"box-chat"},[i("div",{staticClass:"chat-msg style-chat",staticStyle:{bottom:"150px"}},[i("el-scrollbar",{ref:"msglist",attrs:{"wrap-class":"scrollbar-wrapper"}},[i("div",{staticClass:"msg-list",staticStyle:{"padding-top":"30px"}},[t._l(t.lists,(function(e,s){return i("div",{staticClass:"msg-row",class:"AI"===e.user?"row-ai":"row-user"},["AI"===e.user?i("div",{staticClass:"msg-item"},[i("div",{staticClass:"avatar"},[i("img",{attrs:{src:t.aiAvatar,alt:""}})]),i("div",{staticClass:"text markdown-body"},[i("Markdown",{attrs:{text:e.message,"show-tools":!0,"show-ppt":t.isPPT(t.lists[s-1].message),"show-table":t.isTable(t.lists[s-1].message),index:s},on:{retry:t.retryRequest}})],1)]):i("div",{staticClass:"msg-item"},[i("div",{staticClass:"avatar",staticStyle:{background:"#9aa37e"}},[i("img",{attrs:{src:t.userAvatar,alt:""}})]),i("div",{staticClass:"text markdown-body",domProps:{innerHTML:t._s(t.textToHtml(e.message))}})]),i("div",{staticStyle:{clear:"both"}})])})),t.writing||t.writingText?i("div",{staticClass:"msg-row row-ai"},[i("div",{staticClass:"msg-item"},[i("div",{staticClass:"avatar"},[i("img",{attrs:{src:t.aiAvatar,alt:""}})]),i("div",{staticClass:"text markdown-body"},[i("Markdown",{attrs:{text:t.writingText,writing:!(!t.writing&&!t.writingText)}}),i("div",{staticClass:"tools"},[i("span",{staticClass:"btn text-primary",on:{click:t.stopRequest}},[i("svg-icon",{staticClass:"icon",attrs:{"icon-class":"ic_stop"}}),t._v(t._s(t._f("lang")("停止回复")))],1)])],1)])]):t._e()],2)])],1),i("div",{staticClass:"chat-input"},[i("div",{staticClass:"input"},[i("el-input",{ref:"messageInput",attrs:{placeholder:"请输入您的问题，对本文档提问，Ctrl+回车发送",type:"textarea",autofocus:!0,autosize:{minRows:2,maxRows:8}},nativeOn:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.onEnter(e)}},model:{value:t.message,callback:function(e){t.message=e},expression:"message"}}),i("el-button",{staticClass:"btn-send",attrs:{type:"default",loading:t.writing,title:t._f("lang")("发送")},on:{click:t.requestAI}},[t.writing?t._e():i("i",{staticClass:"el-icon-position"}),t._v(" 发送 ")])],1),t.suggestList&&t.suggestList.length>0?i("div",{staticClass:"suggest-list"},t._l(t.suggestList,(function(e){return i("div",{staticClass:"suggest-item",on:{click:function(i){return t.quickMessage(e)}}},[t._v(t._s(e))])})),0):t._e()])])},p=[],f=i("e089"),h=(i("390d"),i("c9c8"),i("6db4")),v=i("ca00"),g=i("61b2"),b=i("114b"),w=new b["a"],_={components:{Markdown:g["c"]},props:{file_id:{type:String,default:""},questions:{type:String,default:""}},data:function(){return{lists:[],message:"",writingText:"",writing:!1,page:1,pagesize:10}},computed:Object(f["a"])(Object(f["a"])({},Object(h["b"])(["avatar","nickname"])),{},{aiAvatar:function(){return"/static/img/ic_ai.png"},userAvatar:function(){return this.avatar||"/static/img/ic_user.png"},suggestList:function(){var t=[];return this.questions&&(t=JSON.parse(this.questions)),t}}),watch:{file_id:{immediate:!0,handler:function(){this.lists=[],this.getHistoryMsg()}}},methods:{requestAI:function(){if(!this.writing&&!this.writingText){var t=Object(v["f"])(this.message);if(!t)return this.$message.error("请输入您的问题"),void(this.message="");this.lists.push({user:"user",message:t}),this.message="",this.writing=!0,this.scrollBottom();var e=this;w.apiUrl="/web.php/doc/chat",w.onMessage=function(t){t&&(e.writingText+=t,e.scrollBottom())},w.onError=function(i){e.lists.pop(),e.message=t,-1!==i.indexOf("请登录")?(e.$modals.showLogin(),setTimeout((function(){e.$message.error(e.$lang(i))}),500)):-1!==i.indexOf("请充值")?(e.$modals.showPay("point"),setTimeout((function(){e.$message.error(e.$lang(i))}),500)):e.$alert(i,"系统提示")},w.onFinish=function(){e.writingText&&e.lists.push({user:"AI",message:e.writingText}),e.writing=!1,e.writingText="",e.scrollBottom()},w.request({message:t,file_id:this.file_id})}},getHistoryMsg:function(){var t=this;d({file_id:this.file_id,page:this.page,pagesize:this.pagesize}).then((function(e){t.lists=e.data.list,t.$nextTick((function(){t.scrollBottom()}))}))},quickMessage:function(t){this.message=t},onEnter:function(t){return t.ctrlKey&&this.requestAI(),!1},retryRequest:function(t){t>0&&(this.message=this.lists[t-1].message,this.requestAI())},stopRequest:function(){var t=this,e=this.writingText;this.writing=!1,w.stop(),setTimeout((function(){e||t.lists.pop()}),50)},scrollBottom:function(){var t=this;this.$nextTick((function(){if(t.$refs["msglist"]){var e=t.$refs["msglist"].wrap;setTimeout((function(){e.scrollTop=e.scrollHeight}),200)}}))},textToHtml:v["d"],isPPT:v["b"],isTable:v["c"],isGpt4:v["a"]}},x=_,C=i("76b2"),y=Object(C["a"])(x,m,p,!1,null,null,null),k=y.exports,D=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"module-mind",staticStyle:{"min-width":"auto"}},[i("div",{staticClass:"doc-minder-container",attrs:{id:"minder-container"}}),t.minder?i("div",{staticClass:"doc-minder-tools"},[i("div",{staticStyle:{display:"flex","align-items":"center"}},[i("drag",{attrs:{minder:t.minder},on:{"update:minder":function(e){t.minder=e}}}),i("zoom",{attrs:{minder:t.minder},on:{"update:minder":function(e){t.minder=e}}}),i("template-dropdown",{attrs:{minder:t.minder},on:{"update:minder":function(e){t.minder=e}}}),i("theme",{attrs:{minder:t.minder,"default-theme":"fresh-soil-compat"},on:{"update:minder":function(e){t.minder=e}}})],1),i("div",{staticStyle:{display:"flex","align-items":"center"}},[i("resetview",{attrs:{minder:t.minder},on:{"update:minder":function(e){t.minder=e}}}),i("expand",{attrs:{minder:t.minder},on:{"update:minder":function(e){t.minder=e}}}),i("pick",{attrs:{minder:t.minder},on:{"update:minder":function(e){t.minder=e}}}),i("div",{staticClass:"split"}),i("export-data",{attrs:{minder:t.minder},on:{"update:minder":function(e){t.minder=e}}})],1)]):t._e()])},O=[],T=(i("cac0"),i("0f4e"),i("8198"),i("eca0"),i("9345"),i("28a3"),function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("el-dropdown",{attrs:{placement:"bottom",trigger:"click"},on:{command:t.handleExpand}},[i("div",{staticClass:"tools-item"},[i("span",{staticClass:"el-dropdown-link"},[i("el-tooltip",{attrs:{content:"展开节点"}},[i("a",[t._v("展开")])])],1),i("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[i("div",{staticClass:"option-list"},t._l(t.expandItems,(function(e,s){return i("el-dropdown-item",{attrs:{command:s}},[i("div",{staticClass:"option-item"},[t._v(t._s(e))])])})),1)])],1)])}),S=[],j={props:{minder:{type:Object,default:null}},data:function(){return{expandItems:["全部展开","展开到 1 层节点","展开到 2 层节点","展开到 3 层节点","展开到 4 层节点","展开到 5 层节点","展开到 6 层节点"]}},methods:{handleExpand:function(t){this.minder.execCommand("ExpandToLevel",t||999)},handleSelected:function(t){this.selectNode(t)}}},$=j,E=Object(C["a"])($,T,S,!1,null,null,null),N=E.exports,L=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("el-dropdown",{attrs:{placement:"bottom"},on:{command:t.handleSelected}},[i("div",{staticClass:"tools-item"},[i("span",{staticClass:"el-dropdown-link"},[i("el-tooltip",{attrs:{content:"选择节点"}},[i("a",[t._v("选择")])])],1),i("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[i("div",{staticClass:"option-list"},t._l(Object.keys(t.selectedItems),(function(e,s){return i("el-dropdown-item",{attrs:{command:s}},[i("div",{staticClass:"option-item"},[t._v(t._s(t.selectedItems[e]))])])})),1)])],1)])},z=[],I=(i("2025"),{props:{minder:{type:Object,default:null}},data:function(){return{selectedItems:{selectall:"全选",selectrevert:"反选",selectlevel:"选中同级",selecttree:"选择子树"}}},methods:{handleSelected:function(t){var e=Object.keys(this.selectedItems)[t];this.selectNode(e)},selectNode:function(t){if(this.minder&&t){var e=this.minder,i={selectall:function(){var t=[];e.getRoot().traverse((function(e){t.push(e)})),e.select(t,!0),e.fire("receiverfocus")},selectrevert:function(){var t=e.getSelectedNodes(),i=[];e.getRoot().traverse((function(e){-1===t.indexOf(e)&&i.push(e)})),e.select(i,!0),e.fire("receiverfocus")},selectsiblings:function(){var t=e.getSelectedNodes(),i=[];t.forEach((function(t){t.parent&&t.parent.children.forEach((function(t){-1===i.indexOf(t)&&i.push(t)}))})),e.select(i,!0),e.fire("receiverfocus")},selectlevel:function(){var t=e.getSelectedNodes().map((function(t){return t.getLevel()})),i=[];e.getRoot().traverse((function(e){-1!==t.indexOf(e.getLevel())&&i.push(e)})),e.select(i,!0),e.fire("receiverfocus")},selectpath:function(){var t=e.getSelectedNodes(),i=[];t.forEach((function(t){while(t&&-1===i.indexOf(t))i.push(t),t=t.parent})),e.select(i,!0),e.fire("receiverfocus")},selecttree:function(){var t=e.getSelectedNodes(),i=[];t.forEach((function(t){t.traverse((function(t){-1===i.indexOf(t)&&i.push(t)}))})),e.select(i,!0),e.fire("receiverfocus")}};i[t]()}}}}),M=I,q=Object(C["a"])(M,L,z,!1,null,null,null),R=q.exports,A=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("el-tooltip",{attrs:{content:"一键整理布局"}},[i("div",{staticClass:"tools-item"},[i("a",{on:{click:function(e){return t.minder.execCommand("resetlayout")}}},[t._v("整理")])])])},P=[],F={props:{minder:{type:Object,default:null}},methods:{}},B=F,H=Object(C["a"])(B,A,P,!1,null,null,null),U=(H.exports,function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("el-tooltip",{attrs:{content:"调整视野到中心位置"}},[i("div",{staticClass:"tools-item"},[i("a",{on:{click:function(e){t.minder.execCommand("camera",t.minder.getSelectedNode()||t.minder.getRoot(),600)}}},[i("svg-icon",{staticClass:"icon",attrs:{"icon-class":"ic_mind_resetview"}})],1)])])}),J=[],X={props:{minder:{type:Object,default:null}},methods:{isDisabled:function(t){return-1===this.minder.queryCommandState(t)}}},G=X,V=Object(C["a"])(G,U,J,!1,null,null,null),Z=V.exports,K=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("el-dropdown",{attrs:{placement:"bottom",trigger:"click"},on:{command:t.handleCommand}},[i("div",{staticClass:"tools-item"},[i("span",{staticClass:"el-dropdown-link"},[i("el-tooltip",{attrs:{content:"类型"}},[i("a",[i("svg-icon",{staticClass:"icon",attrs:{"icon-class":"ic_mind_tpl_"+t.curName}})],1)])],1),i("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[i("div",{staticClass:"tpl-list"},t._l(Object.keys(t.templateList),(function(e){return i("div",[i("el-dropdown-item",{attrs:{command:e}},[i("el-tooltip",{attrs:{content:t.titles[e],placement:"right"}},[i("div",{staticClass:"tpl-item",class:{active:t.curName===e}},[i("svg-icon",{attrs:{"icon-class":"ic_mind_tpl_"+e}})],1)])],1)],1)})),0)])],1)])},W=[],Q={props:{minder:{type:Object,default:null}},data:function(){return{templateList:window.kityminder.Minder.getTemplateList(),curName:"right",titles:{default:"思维导图",structure:"组织结构图",filetree:"目录组织图",right:"逻辑结构图 - 右","fish-bone":"鱼骨图",tianpan:"天盘图"}}},mounted:function(){this.curName=this.minder.queryCommandValue("template")||"default"},methods:{handleCommand:function(t){this.curName=t,this.minder.execCommand("template",t)}}},Y=Q,tt=(i("5b4f"),Object(C["a"])(Y,K,W,!1,null,"d4685700",null)),et=tt.exports,it=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticStyle:{display:"flex","align-items":"center"}},[i("el-dropdown",{attrs:{placement:"bottom",trigger:"click"},on:{command:t.handleCommand}},[i("div",{staticClass:"tools-item"},[i("span",{staticClass:"el-dropdown-link"},[i("el-tooltip",{attrs:{content:"配色"}},[i("a",{staticClass:"color-block",style:"background-color: "+t.themes[t.curName.replace("-compat","")].color})])],1),i("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[i("div",{staticClass:"theme-list"},t._l(Object.keys(t.themes),(function(e){return i("el-dropdown-item",{attrs:{command:e}},[i("a",{staticClass:"theme-item",style:"background-color: "+t.themes[e].color},[t._v(t._s(t.themes[e].title))])])})),1)])],1)]),i("div",{staticClass:"tools-item",class:{active:-1!==t.curName.indexOf("-compat")},on:{click:t.switchCompat}},[i("el-tooltip",{attrs:{content:"紧凑布局"}},[i("a",[t._v("紧凑")])])],1)],1)},st=[],nt={props:{minder:{type:Object,default:null},defaultTheme:{type:String,default:"fresh-green"}},data:function(){return{themes:{"fresh-red":{title:"红",color:"#bf7373"},"fresh-soil":{title:"黄",color:"#bf9373"},"fresh-green":{title:"绿",color:"#73bf76"},"fresh-blue":{title:"蓝",color:"#73a1bf"},"fresh-purple":{title:"紫",color:"#7b73bf"},"fresh-pink":{title:"粉",color:"#bf7394"}},curName:"fresh-green"}},computed:{thumbStyle:function(){var t=this.themes[this.curName.replace("-compat","")];return{color:t["color"],"border-radius":"10px","background-color":t["color"]}},isCompat:function(){return-1!==this.curName.indexOf("-compat")}},mounted:function(){this.defaultTheme?this.curName=this.defaultTheme:this.curName=this.minder.queryCommandValue("theme")||"fresh-green",this.minder.execCommand("theme",this.curName)},methods:{handleCommand:function(t){this.isCompat&&(t+="-compat"),this.curName=t,this.minder.execCommand("theme",this.curName)},switchCompat:function(){this.isCompat?this.curName=this.curName.replace("-compat",""):this.curName+="-compat",this.minder.execCommand("theme",this.curName)}}},ot=nt,at=(i("c382"),Object(C["a"])(ot,it,st,!1,null,"7071eb84",null)),ct=at.exports,rt=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"tools-item",class:{active:1===t.minder.queryCommandState("hand")},on:{click:function(e){return t.minder.execCommand("hand")}}},[i("el-tooltip",{attrs:{content:"拖动模式"}},[i("a",[i("svg-icon",{staticClass:"icon",attrs:{"icon-class":"ic_mind_drag"}})],1)])],1)},lt=[],dt={props:{editor:{type:Object,default:null},minder:{type:Object,default:null}},mounted:function(){}},ut=dt,mt=Object(C["a"])(ut,rt,lt,!1,null,null,null),pt=mt.exports,ft=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("el-dropdown",{attrs:{trigger:"click",placement:"bottom"}},[i("div",{staticClass:"tools-item",staticStyle:{width:"52px"},on:{dblclick:function(e){return t.setZoom(100)}}},[i("span",{staticClass:"el-dropdown-link"},[i("a",[t._v(t._s(t.zoom)+"%")])]),i("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[i("el-slider",{staticStyle:{height:"150px"},attrs:{min:10,max:200,vertical:"",value:t.zoom,"show-tooltip":!1,marks:{100:""}},on:{input:t.setZoom}})],1)],1)])},ht=[],vt={props:{minder:{type:Object,default:null}},data:function(){return{zoom:100}},mounted:function(){var t=this;this.minder.setDefaultOptions({zoom:[10,20,40,60,80,100,120,140,160,180,200]}),this.minder.on("zoom",(function(e){t.zoom=e.zoom}))},methods:{setZoom:function(t){var e=t;this.zoom=e,this.minder.execCommand("zoom",e)}}},gt=vt,bt=Object(C["a"])(gt,ft,ht,!1,null,null,null),wt=bt.exports,_t=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("el-dropdown",{attrs:{placement:"bottom",trigger:"click"},on:{command:t.handleExport}},[i("div",{staticClass:"tools-item"},[i("div",{staticClass:"el-dropdown-link"},[i("div",{staticStyle:{display:"flex","align-items":"center"}},[i("svg-icon",{staticClass:"icon",attrs:{"icon-class":"ic_mind_export"}}),i("a",{staticStyle:{"margin-left":"5px"}},[t._v("导出")])],1)]),i("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[i("div",{staticClass:"option-list"},t._l(t.types,(function(e,s){return i("el-dropdown-item",{attrs:{command:s}},[i("div",{staticClass:"option-item"},[t._v(t._s(e.title))])])})),1)])],1)])},xt=[],Ct=i("4e9e"),yt=i.n(Ct),kt={props:{minder:{type:Object,default:null}},data:function(){return{types:[{name:"png",title:"PNG图片（.png）",ext:"png"},{name:"svg",title:"SVG矢量图（.svg）",ext:"svg"},{name:"text",title:"文本文件（.txt）",ext:"txt"},{name:"markdown",title:"Markdown文件（.md）",ext:"md"},{name:"json",title:"JSON格式（.json）",ext:"json"}]}},methods:{handleExport:function(t){var e=this.types[t];this.minder.exportData(e.name).then((function(t){var i="";"png"===e.name?i=t:("json"===e.name&&(t=t.replace(',"version":"1.4.43"',"")),i=new Blob([t],{type:"text/plain;charset=utf-8"})),yt.a.saveAs(i,"思维导图."+e.ext)}))}}},Dt=kt,Ot=Object(C["a"])(Dt,_t,xt,!1,null,null,null),Tt=Ot.exports,St={components:{templateDropdown:et,theme:ct,resetview:Z,expand:N,pick:R,drag:pt,zoom:wt,exportData:Tt},props:{content:{type:String,default:""}},data:function(){return{minder:null,editor:null}},watch:{content:function(t){this.importData(t)}},mounted:function(){this.minder=new window.kityminder.Minder({renderTo:"#minder-container"}),this.minder.execCommand("theme","fresh-soil-compat"),this.importData(this.content)},methods:{importData:function(t){var e=this;while(this.minder._root.getChildren().length)this.minder.removeNode(this.minder._root.getChildren()[0]);if(!t)return this.minder._root.setData("text","暂无内容"),void this.minder.refresh();t=t.replaceAll("```markdown",""),t=t.replaceAll("```",""),this.minder.decodeData("markdown",t).then((function(t){t.data.text&&(e.minder.importNode(e.minder._root,t),e.minder.refresh())}))}}},jt=St,$t=(i("2c6a"),Object(C["a"])(jt,D,O,!1,null,null,null)),Et=$t.exports,Nt={name:"Doc",components:{DocMind:Et,DocChat:k,Markdown:g["c"]},data:function(){return{docList:[],page:1,pagesize:10,renameDoc:null,activeDoc:null,activeTab:"abstract"}},computed:{fileUrl:function(){return this.activeDoc&&this.activeDoc.url?"/static/pdf/web/viewer.html?file="+encodeURIComponent(this.activeDoc.url):""}},mounted:function(){this.getDocList(!0)},methods:{getDocList:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];a({page:this.page,pagesize:this.pagesize}).then((function(i){t.docList=i.data.list,e&&i.data.list.length>0&&t.selectDoc(i.data.list[0])}))},showDocRename:function(t,e){var i=this;this.renameDoc={file_id:t,title:e},this.$nextTick((function(){i.$refs.renameInput.focus()}))},closeDocRename:function(){this.renameDoc=null},setDocTitle:function(){var t=this;this.renameDoc.title?r({file_id:this.renameDoc.file_id,title:this.renameDoc.title}).then((function(e){for(var i in t.docList)if(t.docList[i].file_id===t.renameDoc.file_id){t.docList[i].title=t.renameDoc.title;break}t.$forceUpdate(),t.$message.success(e.message),t.closeDocRename()})).catch((function(e){403===e.errno&&t.$modals.showLogin()})):this.$message.error("请输入新文件名称")},delDoc:function(t){var e=this;this.$confirm("删除后不可恢复，确认删除吗?","提示",{confirmButtonText:"确定删除",cancelButtonText:"取消",type:"warning"}).then((function(){l({file_id:t}).then((function(i){for(var s in e.docList)if(e.docList[s].file_id===t){e.docList.splice(s,1),e.$forceUpdate();break}e.$message.success(i.message),e.getDocList(t===e.activeDoc.file_id)})).catch((function(t){403===t.errno&&e.$modals.showLogin()}))}))},selectDoc:function(t){this.activeDoc=t},switchTab:function(t){var e=this;this.activeTab=t,"mind"===t&&setTimeout((function(){e.activeDoc.mind||(void 0)({file_id:e.activeDoc.file_id}).then((function(t){e.activeDoc.mind=t.data.mind}))}),1e3)},uploadDocCheck:function(t){var e=t.name.split(".").pop().toLowerCase();if(!["pdf","doc","docx","ppt","pptx","txt"].includes(e))return this.$message.error("暂不支持此文件格式"),!1;if("txt"===e){if(t.size>3145728)return this.$message.error("TXT文档仅支持3M以下"),!1}else if(t.size>10485760)return this.$message.error("仅支持 10M 以下文件"),!1;return!0},uploadDoc:function(t){var e=this,i=new FormData;i.append("file",t.file),c(i).then((function(t){e.$message.success("上传成功");var i=t.data;i.extracted=0,e.docList.unshift(i),e.selectDoc(i),e.docExtract("mind",i.file_id),e.docExtract("abstract",i.file_id),e.docExtract("questions",i.file_id)})).catch((function(t){403===t.errno&&e.$modals.showLogin()}))},formatSize:function(t){return t>=1048576?t=(t/1024/1024).toFixed(1)+"M":t>=1024?t=(t/1024).toFixed(1)+"K":t+="B",t},docExtract:function(t,e){var i=this;u({type:t,file_id:e}).then((function(s){i.docList.forEach((function(n,o){n.file_id===e&&(i.docList[o][t]=s.data,i.docList[o]["extracted"]++)}))})).catch((function(s){-1!==s.message.indexOf("File parsing in progress")?setTimeout((function(){i.docExtract(t,e)}),1e4):i.docList.forEach((function(t,s){t.file_id===e&&i.docList[s]["extracted"]++}))}))}}},Lt=Nt,zt=Object(C["a"])(Lt,s,n,!1,null,null,null);e["default"]=zt.exports},"5b4f":function(t,e,i){"use strict";i("5ec8")},"5ec8":function(t,e,i){},"907e2":function(t,e,i){"use strict";var s=i("74e8"),n=i("199e"),o=i("3a4d"),a=RangeError;t.exports=function(t){var e=n(o(this)),i="",c=s(t);if(c<0||c===1/0)throw new a("Wrong number of repetitions");for(;c>0;(c>>>=1)&&(e+=e))1&c&&(i+=e);return i}},c382:function(t,e,i){"use strict";i("1a7a")},cb2e:function(t,e,i){"use strict";var s=i("a158"),n=i("1d9a"),o=i("4e11"),a=i("e478"),c=i("a6ed"),r=i("c0bb"),l=1!==[].unshift(0),d=function(){try{Object.defineProperty([],"length",{writable:!1}).unshift()}catch(t){return t instanceof TypeError}},u=l||!d();s({target:"Array",proto:!0,arity:1,forced:u},{unshift:function(t){var e=n(this),i=o(e),s=arguments.length;if(s){r(i+s);var l=i;while(l--){var d=l+s;l in e?e[d]=e[l]:c(e,d)}for(var u=0;u<s;u++)e[u]=arguments[u]}return a(e,i+s)}})}}]);
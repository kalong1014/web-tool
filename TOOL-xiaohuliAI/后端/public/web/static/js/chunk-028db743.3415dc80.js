(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-028db743"],{"114b":function(t,e,i){"use strict";i.d(e,"a",(function(){return a}));i("a7fa"),i("f17d"),i("cac0"),i("0f4e"),i("c9c8"),i("c565"),i("96bb");var s=i("5f87");function a(){var t=this;this.apiUrl="/web.php/chat/sendText",this.onMessage=function(){},this.onError=function(){},this.onFinish=function(){},this.fetchCtrl="",this.outputStacks=[],this.outputSI=0,this.request=function(e){t.fetchCtrl=new AbortController;var i=new Headers;i.append("Content-Type","application/json"),i.append("X-token",Object(s["d"])()||""),i.append("X-site",Object(s["a"])()||""),fetch(this.apiUrl,{method:"POST",headers:i,body:JSON.stringify(e),signal:t.fetchCtrl.signal}).then((function(e){if(e.ok){var i=e.body.getReader(),s=new TextDecoder("utf-8");a(),t.startOutput()}else t.onError(e.statusText);function a(){i.read().then((function(e){var i=e.done,n=e.value;if(i)return t.stopOutput(),void t.onFinish();if(n){var o=s.decode(n);if(o){if(-1!==o.indexOf("[error]"))return t.stopOutput(),t.onError(o.replace("[error]","")),void t.onFinish();for(var r=0;r<o.length;r++)t.outputStacks.push(o[r])}}a()}))}})).catch((function(e){"AbortError"===e.name?(t.stopOutput(),t.onFinish(),console.log("请求已被取消")):console.log("网络错误",e)}))},this.startOutput=function(){t.stopOutput(),t.outputSI=setInterval((function(){t.outputStacks.length>0&&t.onMessage(t.outputStacks.shift())}),24)},this.stopOutput=function(){t.outputSI&&clearInterval(t.outputSI),t.outputSI=0,t.outputStacks.length>0&&t.onMessage(t.outputStacks.join("")),t.outputStacks=[]},this.stop=function(){t.fetchCtrl&&(t.fetchCtrl.abort(),t.fetchCtrl=null),t.stopOutput(),t.onFinish()}}},"675b":function(t,e,i){},"833a":function(t,e){t.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABIAAAASCAYAAABWzo5XAAAACXBIWXMAAAsTAAALEwEAmpwYAAAKTWlDQ1BQaG90b3Nob3AgSUNDIHByb2ZpbGUAAHjanVN3WJP3Fj7f92UPVkLY8LGXbIEAIiOsCMgQWaIQkgBhhBASQMWFiApWFBURnEhVxILVCkidiOKgKLhnQYqIWotVXDjuH9yntX167+3t+9f7vOec5/zOec8PgBESJpHmomoAOVKFPDrYH49PSMTJvYACFUjgBCAQ5svCZwXFAADwA3l4fnSwP/wBr28AAgBw1S4kEsfh/4O6UCZXACCRAOAiEucLAZBSAMguVMgUAMgYALBTs2QKAJQAAGx5fEIiAKoNAOz0ST4FANipk9wXANiiHKkIAI0BAJkoRyQCQLsAYFWBUiwCwMIAoKxAIi4EwK4BgFm2MkcCgL0FAHaOWJAPQGAAgJlCLMwAIDgCAEMeE80DIEwDoDDSv+CpX3CFuEgBAMDLlc2XS9IzFLiV0Bp38vDg4iHiwmyxQmEXKRBmCeQinJebIxNI5wNMzgwAABr50cH+OD+Q5+bk4eZm52zv9MWi/mvwbyI+IfHf/ryMAgQAEE7P79pf5eXWA3DHAbB1v2upWwDaVgBo3/ldM9sJoFoK0Hr5i3k4/EAenqFQyDwdHAoLC+0lYqG9MOOLPv8z4W/gi372/EAe/tt68ABxmkCZrcCjg/1xYW52rlKO58sEQjFu9+cj/seFf/2OKdHiNLFcLBWK8ViJuFAiTcd5uVKRRCHJleIS6X8y8R+W/QmTdw0ArIZPwE62B7XLbMB+7gECiw5Y0nYAQH7zLYwaC5EAEGc0Mnn3AACTv/mPQCsBAM2XpOMAALzoGFyolBdMxggAAESggSqwQQcMwRSswA6cwR28wBcCYQZEQAwkwDwQQgbkgBwKoRiWQRlUwDrYBLWwAxqgEZrhELTBMTgN5+ASXIHrcBcGYBiewhi8hgkEQcgIE2EhOogRYo7YIs4IF5mOBCJhSDSSgKQg6YgUUSLFyHKkAqlCapFdSCPyLXIUOY1cQPqQ28ggMor8irxHMZSBslED1AJ1QLmoHxqKxqBz0XQ0D12AlqJr0Rq0Hj2AtqKn0UvodXQAfYqOY4DRMQ5mjNlhXIyHRWCJWBomxxZj5Vg1Vo81Yx1YN3YVG8CeYe8IJAKLgBPsCF6EEMJsgpCQR1hMWEOoJewjtBK6CFcJg4Qxwicik6hPtCV6EvnEeGI6sZBYRqwm7iEeIZ4lXicOE1+TSCQOyZLkTgohJZAySQtJa0jbSC2kU6Q+0hBpnEwm65Btyd7kCLKArCCXkbeQD5BPkvvJw+S3FDrFiOJMCaIkUqSUEko1ZT/lBKWfMkKZoKpRzame1AiqiDqfWkltoHZQL1OHqRM0dZolzZsWQ8ukLaPV0JppZ2n3aC/pdLoJ3YMeRZfQl9Jr6Afp5+mD9HcMDYYNg8dIYigZaxl7GacYtxkvmUymBdOXmchUMNcyG5lnmA+Yb1VYKvYqfBWRyhKVOpVWlX6V56pUVXNVP9V5qgtUq1UPq15WfaZGVbNQ46kJ1Bar1akdVbupNq7OUndSj1DPUV+jvl/9gvpjDbKGhUaghkijVGO3xhmNIRbGMmXxWELWclYD6yxrmE1iW7L57Ex2Bfsbdi97TFNDc6pmrGaRZp3mcc0BDsax4PA52ZxKziHODc57LQMtPy2x1mqtZq1+rTfaetq+2mLtcu0W7eva73VwnUCdLJ31Om0693UJuja6UbqFutt1z+o+02PreekJ9cr1Dund0Uf1bfSj9Rfq79bv0R83MDQINpAZbDE4Y/DMkGPoa5hpuNHwhOGoEctoupHEaKPRSaMnuCbuh2fjNXgXPmasbxxirDTeZdxrPGFiaTLbpMSkxeS+Kc2Ua5pmutG003TMzMgs3KzYrMnsjjnVnGueYb7ZvNv8jYWlRZzFSos2i8eW2pZ8ywWWTZb3rJhWPlZ5VvVW16xJ1lzrLOtt1ldsUBtXmwybOpvLtqitm63Edptt3xTiFI8p0in1U27aMez87ArsmuwG7Tn2YfYl9m32zx3MHBId1jt0O3xydHXMdmxwvOuk4TTDqcSpw+lXZxtnoXOd8zUXpkuQyxKXdpcXU22niqdun3rLleUa7rrStdP1o5u7m9yt2W3U3cw9xX2r+00umxvJXcM970H08PdY4nHM452nm6fC85DnL152Xlle+70eT7OcJp7WMG3I28Rb4L3Le2A6Pj1l+s7pAz7GPgKfep+Hvqa+It89viN+1n6Zfgf8nvs7+sv9j/i/4XnyFvFOBWABwQHlAb2BGoGzA2sDHwSZBKUHNQWNBbsGLww+FUIMCQ1ZH3KTb8AX8hv5YzPcZyya0RXKCJ0VWhv6MMwmTB7WEY6GzwjfEH5vpvlM6cy2CIjgR2yIuB9pGZkX+X0UKSoyqi7qUbRTdHF09yzWrORZ+2e9jvGPqYy5O9tqtnJ2Z6xqbFJsY+ybuIC4qriBeIf4RfGXEnQTJAntieTE2MQ9ieNzAudsmjOc5JpUlnRjruXcorkX5unOy553PFk1WZB8OIWYEpeyP+WDIEJQLxhP5aduTR0T8oSbhU9FvqKNolGxt7hKPJLmnVaV9jjdO31D+miGT0Z1xjMJT1IreZEZkrkj801WRNberM/ZcdktOZSclJyjUg1plrQr1zC3KLdPZisrkw3keeZtyhuTh8r35CP5c/PbFWyFTNGjtFKuUA4WTC+oK3hbGFt4uEi9SFrUM99m/ur5IwuCFny9kLBQuLCz2Lh4WfHgIr9FuxYji1MXdy4xXVK6ZHhp8NJ9y2jLspb9UOJYUlXyannc8o5Sg9KlpUMrglc0lamUycturvRauWMVYZVkVe9ql9VbVn8qF5VfrHCsqK74sEa45uJXTl/VfPV5bdra3kq3yu3rSOuk626s91m/r0q9akHV0IbwDa0b8Y3lG19tSt50oXpq9Y7NtM3KzQM1YTXtW8y2rNvyoTaj9nqdf13LVv2tq7e+2Sba1r/dd3vzDoMdFTve75TsvLUreFdrvUV99W7S7oLdjxpiG7q/5n7duEd3T8Wej3ulewf2Re/ranRvbNyvv7+yCW1SNo0eSDpw5ZuAb9qb7Zp3tXBaKg7CQeXBJ9+mfHvjUOihzsPcw83fmX+39QjrSHkr0jq/dawto22gPaG97+iMo50dXh1Hvrf/fu8x42N1xzWPV56gnSg98fnkgpPjp2Snnp1OPz3Umdx590z8mWtdUV29Z0PPnj8XdO5Mt1/3yfPe549d8Lxw9CL3Ytslt0utPa49R35w/eFIr1tv62X3y+1XPK509E3rO9Hv03/6asDVc9f41y5dn3m978bsG7duJt0cuCW69fh29u0XdwruTNxdeo94r/y+2v3qB/oP6n+0/rFlwG3g+GDAYM/DWQ/vDgmHnv6U/9OH4dJHzEfVI0YjjY+dHx8bDRq98mTOk+GnsqcTz8p+Vv9563Or59/94vtLz1j82PAL+YvPv655qfNy76uprzrHI8cfvM55PfGm/K3O233vuO+638e9H5ko/ED+UPPR+mPHp9BP9z7nfP78L/eE8/sl0p8zAAAAIGNIUk0AAHolAACAgwAA+f8AAIDpAAB1MAAA6mAAADqYAAAXb5JfxUYAAAQjSURBVHjaVNNZbFRlGIDh95w525zpdGa6TVtbykBbyiICxQY0AhYTJUCiiYqGqEEiJhKQmBg0ESPeeCGRENEYb4jhBr0gNQrRlCBiSgyLaSlSaKEs3Wemy+xnzuqFYdD/6rt6ku/N9wue55EcPwWArCgIgkx5ZRuYVxsnJ801Z05f3jY1MRnb/HxHV+uSph9RKq4mhkdwbZVgdQ2SHkPTwgj/h1QUWWi8/tfg/hM/XN/Y2zfaZnkSnuRDtLMsXhBOvrJtya/LlrcdMs1Qb1lVRQmSAEDAsU1kxpgamXp3y+azu1esreK9dyRqs9PIjkW6OsLx7lTV1ld/237s8HRV57MbnvO8CA+e9GCQFTk6Mza+4/0P+t9a9VSEI3uyTH/eR27aB2Ed31Q/Hx1sI6BHOPT13c5Frd0HW9p3HPUQEwAigJW9RDp+bstrOy981nVGLN/7RpHUV70YfXnEAtjxFPasxPDBQXatjzNTdOQXtg983H/51AFFy1KCIg2bNIdC+8270NwmUmelsXqSqHkDK5PDl8iCW0QcnEW+lqCjvcjQuMZ4YnQRTkotQUZu4GkjcfZNv19G011kXw4vayNYNvqCCvSVTciOgABgeuhBGwhgz5zbkI2ff7HUqJiNR2QktbbSYnBYYqbMT/ilKI4SIbT/GcRylbnvLmJ2X8N7tJ7rR8OE/BbliqEYea81WIotmOs02WFpc55Lf0f5/mSI3dsamOgxSX7ZjaALuBmB6M6FnB+S+POCwmOLk1QFFAqZyQWl1YrpiRZJLvDkygyC5NJ1XCax7xYNiTQVEYVIuUulayIcGeLkpw6WK7GuPY/fb2CkhleXIFFe8XPGaKBj9QxLW1Ik0bg8EuT2zRCJYZvZIYepe0EGbvi4bQUJVZhs2phADFYj+df0lBqJUnaekS4SUHXe3jrOnoE2PhSewHfRpfZGgcryIvfHdQruQlLo7Ns6QizqkJ31CIUlqwQJXuWUpDXj6qOsW32HT3YNImll9FwJsb4jyaLmWQ4fa6a+2sQw0ry8YZSiHcPxxXBtMfCv4XkUCrfliWs/fTE31rtTVfv9vsIorvQIniMhqXM4popVcJFVMHMpfMEaLPdxR1Tnna1b1vl6tGntpAjgCTNWONZyIFBR8Ydtr6EgrCI3VySfzZPLBDHyIq5gkpmzcOUmTGMF+bh7M9LYulfWzMmHBzk7Fpq9deWEYxjrtaCMXjWfstp6BCGNXZzBdYqYhogWqkMum4+oBVD0YnP63u/fFqbv1D+M7VSlBbmmK5uYaLYLYwslfwFVAyXQiOfcx3XyyGIM8DDn0lgWyGokHogu/0UJxpL/+f2e569s/CZQZ53OpzJr0+NXludUfb5jVdf7VUGXJUPIZast1S9PeII6jFDT5xMjFwO1S4c8zwTgnwEAxufYSzA67PMAAAAASUVORK5CYII="},"96bb":function(t,e,i){"use strict";var s=i("a158"),a=i("9372"),n=i("86aa"),o=i("2663"),r=i("a05b"),c=a([].join),l=n!==Object,u=l||!r("join",",");s({target:"Array",proto:!0,forced:u},{join:function(t){return c(o(this),void 0===t?",":t)}})},d800:function(t,e,i){"use strict";i.d(e,"c",(function(){return a})),i.d(e,"d",(function(){return n})),i.d(e,"b",(function(){return o})),i.d(e,"a",(function(){return r}));var s=i("b775");function a(t){return Object(s["a"])({url:"/chat/getHistoryMsg",method:"post",data:t})}function n(t){return Object(s["a"])({url:"/chat/getPkHistoryMsg",method:"post",data:t})}function o(t){return Object(s["a"])({url:"/chat/getChatSetting",method:"post",data:t})}function r(t){return Object(s["a"])({url:"/chat/createPk",method:"post",data:t})}},d827:function(t,e,i){"use strict";i.r(e);var s=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"module-chat"},[i("group-list",{staticClass:"sub-sidebar",on:{setGroupId:t.setGroupId}}),i("div",{staticClass:"main-wrapper box-chat"},[i("div",{staticClass:"chat-ai-list"},[i("div",{staticClass:"tab-list"},t._l(t.aiList,(function(e,s){return i("div",{staticClass:"tab-item",class:{active:t.ai.name===e.name,gold:t.isGpt4(e.name)},on:{click:function(e){return t.switchAI(s)}}},[t._v(" "+t._s(e.alias)+" ")])})),0)]),t.lists&&t.lists.length>0?i("div",{staticClass:"chat-msg style-chat"},[i("el-scrollbar",{ref:"msglist",attrs:{"wrap-class":"scrollbar-wrapper"}},[i("div",{staticClass:"msg-list"},[t._l(t.lists,(function(e,s){return i("div",{staticClass:"msg-row",class:"AI"===e.user?"row-ai":"row-user"},["AI"===e.user?i("div",{staticClass:"msg-item"},[i("div",{staticClass:"avatar"},[i("img",{attrs:{src:t.aiAvatar}})]),i("div",{staticClass:"text markdown-body"},[i("Markdown",{attrs:{text:e.message,"show-tools":!0,"show-ppt":t.isPPT(t.lists[s-1].message),"show-table":t.isTable(t.lists[s-1].message),index:s},on:{retry:t.retryRequest}})],1)]):i("div",{staticClass:"msg-item"},[i("div",{staticClass:"avatar",staticStyle:{background:"#9aa37e"}},[i("img",{attrs:{src:t.userAvatar}})]),i("div",{staticClass:"text markdown-body",domProps:{innerHTML:t._s(t.textToHtml(e.message))}})]),i("div",{staticStyle:{clear:"both"}})])})),t.writing||t.writingText?i("div",{staticClass:"msg-row row-ai"},[i("div",{staticClass:"msg-item"},[i("div",{staticClass:"avatar"},[i("img",{attrs:{src:t.aiAvatar}})]),i("div",{staticClass:"text markdown-body"},[i("Markdown",{attrs:{text:t.writingText,writing:!0}}),i("div",{staticClass:"tools"},[i("span",{staticClass:"btn text-primary",on:{click:t.stopRequest}},[i("svg-icon",{staticClass:"icon",attrs:{"icon-class":"ic_stop"}}),t._v(t._s(t._f("lang")("停止回复")))],1)])],1)])]):t._e()],2)])],1):i("div",{staticClass:"chat-msg style-chat"},[i("welcome",{attrs:{title:t.welcomeTitle,desc:t.welcomeDesc,tips:t.welcomeTips},on:{use:t.quickMessage}})],1),i("div",{staticClass:"chat-input"},[i("div",{staticClass:"input"},[i("el-input",{ref:"messageInput",class:{gold:t.isGpt4(t.ai.name)},attrs:{placeholder:t.placeHolder,type:"textarea",autofocus:!0,autosize:{minRows:2,maxRows:8}},nativeOn:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.onEnter(e)}},model:{value:t.message,callback:function(e){t.message=e},expression:"message"}}),i("el-button",{staticClass:"btn-send",attrs:{type:"default",loading:t.writing,title:t._f("lang")("发送")},on:{click:t.requestAI}},[t.writing?t._e():i("i",{staticClass:"el-icon-position"}),t._v(" 发送 ")])],1),i("copyright")],1)])],1)},a=[],n=i("e089"),o=(i("c9c8"),i("c565"),i("a7fa"),i("d3da"),i("30f8"),i("6db4")),r=i("d800"),c=i("5f87"),l=i("ca00"),u=i("114b"),p=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",[s("div",{staticClass:"module-header"},[s("div",{staticClass:"btn-group-add",on:{click:function(e){return t.editGroup(0)}}},[s("i",{staticClass:"icon el-icon-plus"}),s("span",[t._v(t._s(t._f("lang")("创建新会话")))])])]),s("div",{staticClass:"module-body"},[s("el-scrollbar",{attrs:{"wrap-class":"scrollbar-wrapper"}},[s("div",{staticClass:"group-list"},t._l(t.groupList,(function(e,i){return s("div",{staticClass:"group-item",class:{active:e.id===t.activeGroupId}},[s("div",{staticClass:"group-title",on:{click:function(i){return t.setGroupId(e.id)}}},[s("i",{staticClass:"icon el-icon-chat-dot-square"}),s("span",[t._v(t._s(e.title))])]),s("el-dropdown",{attrs:{trigger:"click"}},[s("span",{staticClass:"el-dropdown-link"},[s("i",{staticClass:"btn-dropdown el-icon-more"})]),s("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[s("el-dropdown-item",{nativeOn:{click:function(i){return i.stopPropagation(),t.editGroup(e.id)}}},[t._v(t._s(t._f("lang")("编辑")))]),s("el-dropdown-item",{staticClass:"text-danger",nativeOn:{click:function(i){return i.stopPropagation(),t.delGroup(e.id)}}},[t._v(t._s(t._f("lang")("删除")))])],1)],1)],1)})),0)])],1),s("div",{staticClass:"module-footer"},[s("div",{staticClass:"box-vip",on:{click:function(e){return t.showPay("vip")}}},[s("img",{staticClass:"icon",attrs:{src:i("c6d4")}}),t.vip_expire_time?s("div",{staticClass:"title"},[t._v(t._s(t._f("lang")("已开通会员")))]):s("div",{staticClass:"title"},[t._v(t._s(t._f("lang")("开通会员")))]),t.vip_expire_time?s("div",{staticClass:"desc"},[t._v(t._s(t.vip_expire_time)+" "+t._s(t._f("lang")("到期")))]):s("div",{staticClass:"desc"},[t._v(t._s(t._f("lang")("高速通道 无限对话")))])])]),t.group?s("group-edit",{attrs:{group:t.group},on:{close:t.closeGroupEdit,submit:t.saveGroup}}):t._e()],1)},g=[],d=(i("233b"),i("b775"));function f(t){return Object(d["a"])({url:"/group/getGroupList",method:"post",data:t})}function h(t){return Object(d["a"])({url:"/group/getGroup",method:"post",data:t})}function m(t){return Object(d["a"])({url:"/group/saveGroup",method:"post",data:t})}function v(t){return Object(d["a"])({url:"/group/delGroup",method:"post",data:t})}var w=function(){var t=this,e=t.$createElement,i=t._self._c||e;return t.form?i("div",[i("el-dialog",{attrs:{"custom-class":"my-dialog",title:t._f("lang")(t.group.id?"编辑会话":"创建新会话"),width:"440px",visible:!0,"close-on-click-modal":!1,"append-to-body":!0,"before-close":t.closeForm}},[i("el-form",{ref:"form",staticStyle:{padding:"20px 0"},attrs:{model:t.form,rules:t.formRules,"label-width":"100px"}},[i("el-form-item",{attrs:{label:t._f("lang")("会话标题"),prop:"num"}},[i("el-input",{staticStyle:{width:"240px"},attrs:{placeholder:t._f("lang")("自定义会话标题"),size:"normal"},model:{value:t.form.title,callback:function(e){t.$set(t.form,"title",e)},expression:"form.title"}})],1)],1),i("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{attrs:{type:"default",icon:"el-icon-close",size:"small"},on:{click:t.closeForm}},[t._v(t._s(t._f("lang")("取 消")))]),i("el-button",{attrs:{type:"primary",icon:"el-icon-check",size:"small"},on:{click:t.doSubmit}},[t._v(t._s(t._f("lang")("提 交")))])],1)],1)],1):t._e()},b=[],A={props:{group:{type:Object,default:null}},data:function(){return{form:null,formRules:{title:[{required:!0,message:"此项必填",trigger:"blur"}]}}},created:function(){this.form=this.group},methods:{closeForm:function(){this.$emit("close")},doSubmit:function(){var t=this;this.$refs.form.validate((function(e){e?t.$emit("submit",t.form):t.$message.error("请填写必填项")}))}}},C=A,y=(i("eb6d"),i("76b2")),k=Object(y["a"])(C,w,b,!1,null,"2bfd12c5",null),x=k.exports,I={components:{groupEdit:x},data:function(){return{groupList:[],group:null,activeGroupId:null}},computed:Object(n["a"])({},Object(o["b"])(["vip_expire_time"])),mounted:function(){this.getGroupList(!0)},methods:{getGroupList:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];f({page:this.page,pagesize:this.pagesize}).then((function(i){t.groupList=i.data.list,e&&i.data.list.length>0&&t.setGroupId(i.data.list[0].id)}))},editGroup:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;e?h({id:e}).then((function(e){t.group=e.data})).catch((function(e){403===e.errno&&t.$modals.showLogin()})):this.group={title:this.$lang("新的会话")}},closeGroupEdit:function(){this.group=null},saveGroup:function(t){var e=this;m(t).then((function(i){if(e.group.id){for(var s in e.groupList)if(e.groupList[s].id===t.id){e.groupList[s].title=t.title;break}}else e.page=1,e.getGroupList(!0);e.$forceUpdate(),e.$message.success(i.message),e.closeGroupEdit()})).catch((function(t){403===t.errno&&e.$modals.showLogin()}))},delGroup:function(t){var e=this;this.$confirm("删除后不可恢复，确认删除吗?","提示",{confirmButtonText:"确定删除",cancelButtonText:"取消",type:"warning"}).then((function(){v({id:t}).then((function(i){for(var s in e.groupList)if(e.groupList[s].id===t){e.groupList.splice(s,1),e.$forceUpdate();break}e.$message.success(i.message),e.getGroupList(t===e.activeGroupId)})).catch((function(t){403===t.errno&&e.$modals.showLogin()}))}))},setGroupId:function(t){this.activeGroupId=t,this.$emit("setGroupId",t)},getActiveId:function(){return this.activeGroupId},showPay:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"vip";this.$modals.showPay(t)}}},O=I,S=Object(y["a"])(O,p,g,!1,null,null,null),M=S.exports,j=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{},[i("div",{staticClass:"msg-list welcome"},[i("div",{staticClass:"msg-row row-ai"},[i("div",{staticClass:"msg-item"},[t._m(0),i("div",{staticClass:"text markdown-body",staticStyle:{"min-width":"480px","max-width":"600px"}},[t.welcomeTitle?i("div",{staticClass:"title"},[t._v(t._s(t.welcomeTitle))]):t._e(),t.welcomeDesc?i("div",{staticClass:"desc",domProps:{innerHTML:t._s(t.welcomeDesc)}}):t._e(),t.welcomeTips.length>0?i("div",{staticClass:"tips"},[i("ul",t._l(t.welcomeTips,(function(e){return e?i("li",{on:{click:function(i){return t.quickMessage(e)}}},[i("span",[t._v(t._s(e))]),i("i",{staticClass:"el-icon-position"})]):t._e()})),0)]):t._e()])])])])])},T=[function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"avatar"},[i("img",{attrs:{src:"/static/img/ic_ai.png"}})])}],L=(i("cac0"),i("0f4e"),i("8198"),{props:{title:{type:String,default:""},desc:{type:String,default:""},tips:{type:String,default:""}},computed:{welcomeTitle:function(){return this.title?this.$lang("你好！我是")+this.title:""},welcomeDesc:function(){return this.desc?this.desc.replaceAll("\n","<br>"):""},welcomeTips:function(){return this.tips?this.tips.split("\n"):[]}},methods:{quickMessage:function(t){this.$emit("use",t)}}}),E=L,_=Object(y["a"])(E,j,T,!1,null,null,null),P=_.exports,B=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"copyright"},[t.copyright||t.icp||t.gongan?s("div",[s("a",{on:{click:function(e){return t.toDoc("legal")}}},[t._v(t._s(t.copyright))]),t.gongan?s("a",{staticStyle:{"margin-left":"15px"},attrs:{href:"http://www.beian.gov.cn/portal/registerSystemInfo?recordcode="+t.gongan.replace(/[^\d]/g,""),target:"_blank"}},[s("img",{staticStyle:{"margin-right":"3px",position:"relative",top:"2px",height:"14px"},attrs:{src:i("833a")}}),t._v(t._s(t.gongan)+" ")]):t._e(),t.icp?s("a",{staticStyle:{"margin-left":"15px"},attrs:{href:"https://beian.miit.gov.cn/",target:"_blank"}},[t._v(t._s(t.icp))]):t._e()]):t._e()])},G=[],q={computed:Object(n["a"])({},Object(o["b"])(["copyright","icp","gongan"])),methods:{toDoc:function(t){Object(l["e"])(t)}}},Y=q,Q=Object(y["a"])(Y,B,G,!1,null,null,null),H=Q.exports,X=i("61b2"),U=new u["a"],W=0,D={name:"Chat",components:{groupList:M,Markdown:X["c"],welcome:P,copyright:H},data:function(){return{ai:{},group_id:0,lists:[],message:"",writingText:"",writing:!1,page:1,pagesize:10,chatSetting:{}}},computed:Object(n["a"])(Object(n["a"])({},Object(o["b"])(["avatar","nickname","page_title","aiList","priceSetting"])),{},{aiAvatar:function(){return"/static/img/ic_ai.png"},userAvatar:function(){return this.avatar||"/static/img/ic_user.png"},placeHolder:function(){return this.$lang("输入您的问题，Ctrl+回车发送")},welcomeTitle:function(){return this.page_title||""},welcomeDesc:function(){return this.chatSetting.welcome||this.chatSetting.tips?this.chatSetting.welcome||"":this.$lang("请输入你的问题")},welcomeTips:function(){return this.chatSetting.tips||""}}),watch:{message:function(){Object(c["g"])("chatPrompt",this.message)},aiList:{immediate:!0,handler:function(){this.setDefaultAI()}}},mounted:function(){this.startAutoFocus(),this.getChatSetting(),this.setDefaultMessage(),window.handlInputValue=this.miclinkInput},destroyed:function(){W&&clearInterval(W)},methods:{requestAI:function(){if(!this.writing&&!this.writingText){var t=Object(l["f"])(this.message);if(!t)return this.$message.error("请输入您的问题"),void(this.message="");this.lists.push({user:"user",message:t}),this.message="",this.writing=!0,this.scrollBottom();var e=this;U.onMessage=function(t){t&&(e.writingText+=t,e.scrollBottom())},U.onError=function(i){e.lists.pop(),e.message=t,-1!==i.indexOf("请登录")?(e.$modals.showLogin(),setTimeout((function(){e.$message.error(e.$lang(i))}),500)):-1!==i.indexOf("请充值")?(e.showPay(),setTimeout((function(){e.$message.error(e.$lang(i))}),500)):e.$alert(i,"系统提示")},U.onFinish=function(){e.writingText&&e.lists.push({user:"AI",message:e.writingText}),e.writing=!1,e.writingText="",e.scrollBottom()},U.request({message:t,ai:this.ai.name,group_id:this.group_id})}},showPay:function(){this.isGpt4(this.ai.name)?this.priceSetting.text40_vip?this.$modals.showPay("vip"):this.$modals.showPay("point"):this.$modals.showPay("vip")},miclinkInput:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;t&&(this.message=t),2!==e&&3!==e||this.requestAI()},switchAI:function(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=this.aiList[t];this.ai.name!==i.name?this.writing?this.$message.warning(this.$lang("输出中，请稍等")):(this.ai=i,this.page=1,this.getHistoryMsg(),e&&this.$message.success("已切换至【"+i.alias+"】"),this.ai.name&&Object(c["g"])("ai",this.ai.name)):this.scrollTop+=1},setGroupId:function(t){this.group_id=t,this.page=1,this.ai.name&&this.getHistoryMsg()},setDefaultAI:function(){if(this.aiList&&this.aiList.length>0){var t=Object(c["b"])("ai");if(this.ai.name===t)return;var e=0;t&&this.aiList.forEach((function(i,s){i.name===t&&(e=s)})),this.switchAI(e,!1)}},setDefaultMessage:function(){if(this.$route.query.prompt)this.message=decodeURIComponent(this.$route.query.prompt);else{var t=Object(c["b"])("chatPrompt");t&&(this.message=t)}},startAutoFocus:function(){var t=this;W=setInterval((function(){var e=window.getSelection?window.getSelection():document.selection.createRange().text;if(e.anchorNode){var i=e.anchorNode.className;if(i&&(-1!==i.indexOf("el-input")||-1!==i.indexOf("el-textarea")))return}!e.toString()&&t.$refs.messageInput&&t.$refs.messageInput.focus()}),1e3)},getHistoryMsg:function(){var t=this;this.group_id&&Object(r["c"])({ai:this.ai.name,group_id:this.group_id,page:this.page,pagesize:this.pagesize}).then((function(e){t.lists=e.data.list,t.$nextTick((function(){t.scrollBottom()}))}))},getChatSetting:function(){var t=this;Object(r["b"])().then((function(e){t.chatSetting=e.data}))},quickMessage:function(t){this.message=t},onEnter:function(t){return t.ctrlKey&&this.requestAI(),!1},retryRequest:function(t){t>0&&(this.message=this.lists[t-1].message,this.requestAI())},stopRequest:function(){var t=this,e=this.writingText;this.writing=!1,U.stop(),setTimeout((function(){e||t.lists.pop()}),50)},scrollBottom:function(){var t=this;this.$nextTick((function(){if(t.$refs["msglist"]){var e=t.$refs["msglist"].wrap;setTimeout((function(){e.scrollTop=e.scrollHeight}),200)}}))},textToHtml:l["d"],toDoc:l["e"],isPPT:l["b"],isTable:l["c"],isGpt4:l["a"]}},F=D,V=Object(y["a"])(F,s,a,!1,null,null,null);e["default"]=V.exports},eb6d:function(t,e,i){"use strict";i("675b")}}]);
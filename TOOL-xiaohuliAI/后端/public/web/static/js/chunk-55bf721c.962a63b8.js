(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-55bf721c"],{"0af2":function(t,s,i){},"0bcf":function(t,s,i){"use strict";i("7522")},"114b":function(t,s,i){"use strict";i.d(s,"a",(function(){return a}));i("a7fa"),i("f17d"),i("cac0"),i("0f4e"),i("c9c8"),i("c565"),i("96bb");var e=i("5f87");function a(){var t=this;this.apiUrl="/web.php/chat/sendText",this.onMessage=function(){},this.onError=function(){},this.onFinish=function(){},this.fetchCtrl="",this.outputStacks=[],this.outputSI=0,this.request=function(s){t.fetchCtrl=new AbortController;var i=new Headers;i.append("Content-Type","application/json"),i.append("X-token",Object(e["d"])()||""),i.append("X-site",Object(e["a"])()||""),fetch(this.apiUrl,{method:"POST",headers:i,body:JSON.stringify(s),signal:t.fetchCtrl.signal}).then((function(s){if(s.ok){var i=s.body.getReader(),e=new TextDecoder("utf-8");a(),t.startOutput()}else t.onError(s.statusText);function a(){i.read().then((function(s){var i=s.done,o=s.value;if(i)return t.stopOutput(),void t.onFinish();if(o){var n=e.decode(o);if(n){if(-1!==n.indexOf("[error]"))return t.stopOutput(),t.onError(n.replace("[error]","")),void t.onFinish();for(var c=0;c<n.length;c++)t.outputStacks.push(n[c])}}a()}))}})).catch((function(s){"AbortError"===s.name?(t.stopOutput(),t.onFinish(),console.log("请求已被取消")):console.log("网络错误",s)}))},this.startOutput=function(){t.stopOutput(),t.outputSI=setInterval((function(){t.outputStacks.length>0&&t.onMessage(t.outputStacks.shift())}),24)},this.stopOutput=function(){t.outputSI&&clearInterval(t.outputSI),t.outputSI=0,t.outputStacks.length>0&&t.onMessage(t.outputStacks.join("")),t.outputStacks=[]},this.stop=function(){t.fetchCtrl&&(t.fetchCtrl.abort(),t.fetchCtrl=null),t.stopOutput(),t.onFinish()}}},"1b76":function(t,s,i){},"29bb":function(t,s,i){"use strict";i("0af2")},"5c9b":function(t,s,i){},"63d1":function(t,s,i){},7522:function(t,s,i){},"82d7":function(t,s,i){},8743:function(t,s,i){"use strict";i("e0bc")},"96bb":function(t,s,i){"use strict";var e=i("a158"),a=i("9372"),o=i("86aa"),n=i("2663"),c=i("a05b"),l=a([].join),r=o!==Object,u=r||!c("join",",");e({target:"Array",proto:!0,forced:u},{join:function(t){return l(n(this),void 0===t?",":t)}})},b140:function(t,s,i){"use strict";var e=function(){var t=this,s=t.$createElement,i=t._self._c||s;return t.pageTotal>1?i("div",{staticClass:"pages"},[i("span",{staticStyle:{width:"88px"},on:{click:t.toPrev}},[t._v("上页")]),i("div",{staticStyle:{"text-align":"center"}},t._l(t.pageTotal,(function(s){return i("span",{class:{active:t.page===s},on:{click:function(i){return t.toPage(s)}}},[t._v(t._s(s))])})),0),i("span",{staticStyle:{width:"88px"},on:{click:t.toNext}},[t._v("下页")])]):t._e()},a=[],o=(i("51c1"),{props:{page:{type:Number,default:1},pageTotal:{type:Number,default:1}},methods:{toPage:function(t){this.page!==t&&this.$emit("change",t)},toPrev:function(){this.page>1&&this.toPage(this.page-1)},toNext:function(){this.page<this.pageTotal&&this.toPage(this.page+1)}}}),n=o,c=i("76b2"),l=Object(c["a"])(n,e,a,!1,null,null,null);s["a"]=l.exports},d517:function(t,s,i){"use strict";i.r(s);var e=function(){var t=this,s=t.$createElement,i=t._self._c||s;return i("div",{staticClass:"module-music"},[i("div",{staticClass:"platform-list"},[t.sunoSetting&&t.sunoSetting["is_open"]?i("div",{staticClass:"item",class:{active:"suno"===t.activePlatform},on:{click:function(s){return t.switchPlatform("suno")}}},[t._v("SunoAI")]):t._e()]),i("div",{staticClass:"sub-sidebar"},[i("div",{staticClass:"module-body"},["suno"===t.activePlatform?i("musicSuno",{ref:"musicSetting"}):t._e()],1),"suno"===t.activePlatform?i("div",{staticClass:"module-footer"},[t.priceSetting.music>0?i("div",{staticClass:"box-price",on:{click:t.showPay}},[i("svg-icon",{staticClass:"icon",attrs:{"icon-class":"ic_mod_music"}}),i("span",{staticClass:"num"},[t._v(t._s(t.priceSetting.music))]),t._v(t._s(t.priceSetting.title)+"/"+t._s(t._f("lang")("次"))+" "),t.priceSetting.music_vip?i("span",{staticClass:"vip"},[t._v("会员免费")]):t._e()],1):i("div",{staticClass:"box-price",staticStyle:{cursor:"default"},on:{click:t.showUserInfo}},[i("svg-icon",{staticClass:"icon",attrs:{"icon-class":"ic_mod_music"}}),i("span",{staticClass:"vip"},[t._v("免费使用")])],1),i("el-button",{staticClass:"btn-music",attrs:{type:"primary",title:t._f("lang")("发送")},on:{click:t.submitTask}},[i("svg-icon",{attrs:{"icon-class":"ic_mod_music"}}),t._v(" 生成音乐 ")],1)],1):t._e()]),i("div",{staticClass:"main-wrapper box-chat"},[t.musicShopIsOpen?i("div",{staticClass:"type-list"},[i("div",{staticClass:"tab-type"},[i("div",{staticClass:"tab-item",class:{active:"public"===t.listType},on:{click:function(s){return t.switchListType("public")}}},[t._v("音乐广场")]),i("div",{staticClass:"tab-item",class:{active:"my"===t.listType},on:{click:function(s){return t.switchListType("my")}}},[t._v("我的作品")])])]):t._e(),t.musicShopIsOpen&&"public"===t.listType?i("div",{staticClass:"chat-msglist",staticStyle:{bottom:"0"}},[i("el-scrollbar",{ref:"publicList",attrs:{"wrap-class":"scrollbar-wrapper"}},[i("div",{staticClass:"music-list"},t._l(t.publicList,(function(s){return i("div",{staticClass:"music-item",on:{click:function(i){return i.stopPropagation(),t.showVideoDetail(s)}}},[i("div",{staticClass:"video"},[i("video",{attrs:{id:"public_video_"+s.video_id,muted:"",poster:s.poster,src:s.video,loop:"loop",preload:"none"},domProps:{muted:!0}}),i("div",{staticClass:"poster",style:"background-image: url("+s.poster+");"}),i("div",{staticClass:"btn-play"},[i("div",{staticClass:"icon",staticStyle:{"background-image":"url(/static/img/ic_play.png)"}})]),i("div",{staticClass:"prompt"},[t._v(t._s(s.prompt))])])])})),0),i("div",{staticStyle:{width:"100%",margin:"20px 0"}},[i("pages",{attrs:{page:t.publicPage,"page-total":t.publicPageTotal},on:{change:t.changePublicPage}})],1)])],1):"my"===t.listType&&t.myList&&t.myList.length>0?i("div",{staticClass:"chat-msg style-write",staticStyle:{bottom:"0"}},[i("el-scrollbar",{ref:"myList",attrs:{"wrap-class":"scrollbar-wrapper"}},[i("div",{staticClass:"msg-list",staticStyle:{width:"862px"},style:t.musicShopIsOpen?"padding-top: 70px;":"padding-top: 0;"},t._l(t.myList,(function(s){return i("div",{staticClass:"msg-row"},[i("div",{staticClass:"msg-item row-user",staticStyle:{padding:"20px 30px 10px 30px",width:"862px"}},[i("div",{staticClass:"avatar",staticStyle:{background:"#9aa37e"}},[i("img",{attrs:{src:t.userAvatar,alt:""}})]),i("div",{staticClass:"text"},[i("div",[i("span",{staticClass:"label"},[t._v("【模式】")]),1===s.options.custom_mode?i("span",[t._v("专业模式")]):i("span",[t._v("灵感模式")])]),i("div",[i("span",{staticClass:"label"},[t._v("【类型】")]),1===s.options.make_instrumental?i("span",[t._v("纯音乐")]):i("span",[t._v("歌曲")])]),s.options.prompt?i("div",[1===s.options.custom_mode?i("span",{staticClass:"label"},[t._v("【歌词】")]):i("span",{staticClass:"label"},[t._v("【描述】")]),s.options.prompt.length>40?i("span",[t._v(t._s(s.options.prompt.substring(0,40))+"...")]):i("span",[t._v(t._s(s.options.prompt))])]):t._e(),s.options.title?i("div",[i("span",{staticClass:"label"},[t._v("【歌名】")]),i("span",[t._v(t._s(s.options.title))])]):t._e(),s.options.tags?i("div",[i("span",{staticClass:"label"},[t._v("【曲风】")]),i("span",[t._v(t._s(s.options.tags))])]):t._e(),i("div",{staticClass:"tools",staticStyle:{opacity:"1"}},[i("span",{staticClass:"btn text-primary",attrs:{title:"将参数填充到左侧面板"},on:{click:function(i){return t.copyOptions(s.music_id)}}},[i("svg-icon",{staticClass:"icon",attrs:{"icon-class":"ic_copy"}}),t._v(t._s(t._f("lang")("复用参数")))],1),i("span",{staticStyle:{"font-size":"13px",color:"#898989"}},[t._v(t._s(s.create_time))])])])]),i("div",{staticClass:"msg-item row-ai",staticStyle:{padding:"15px 30px 20px 30px",width:"862px"}},[i("div",{staticClass:"avatar",staticStyle:{opacity:"0"}}),i("div",{staticClass:"text",staticStyle:{width:"620px",display:"flex","align-items":"center","margin-bottom":"15px"}},[i("div",{staticClass:"video",staticStyle:{"margin-right":"20px"},on:{click:function(i){return t.showMusicDetail(s,"result1")}}},[i("musicItem",{attrs:{music:s,result:s.result1},on:{retry:function(i){return t.retryMusic(s.music_id)}}})],1),i("div",{staticClass:"video",on:{click:function(i){return t.showMusicDetail(s,"result2")}}},[i("musicItem",{attrs:{music:s,result:s.result2},on:{retry:function(i){return t.retryMusic(s.music_id)}}})],1)])]),i("div",{staticStyle:{clear:"both"}})])})),0)])],1):t._e(),"public"===t.listType&&0===t.publicList.length?i("welcome",{attrs:{desc:"广场空空的~"}}):t._e(),"my"===t.listType&&0===t.myList.length?i("welcome",{attrs:{desc:"您还没有作品，快去创作吧"}}):t._e(),t.activeMusic?i("musicDetail",{attrs:{music:t.activeMusic},on:{close:t.closeMusicDetail,copyOptions:t.copyOptions}}):t._e()],1)])},a=[],o=i("e089"),n=(i("c9c8"),i("f17d"),i("a7fa"),i("d3da"),i("6db4")),c=i("5f87"),l=i("c24f"),r=i("b775");function u(t){return Object(r["a"])({url:"/music/submitTask",method:"post",data:t})}function p(t){return Object(r["a"])({url:"/music/getMusicSetting",method:"post",data:t})}function m(t){return Object(r["a"])({url:"/music/getMusicDetail",method:"post",data:t})}function d(t){return Object(r["a"])({url:"/music/getHistoryMsg",method:"post",data:t})}function f(t){return Object(r["a"])({url:"/music/getPublicList",method:"post",data:t})}function g(t){return Object(r["a"])({url:"/music/getMusicResult",method:"post",hideLoading:!0,data:t})}var v=function(){var t=this,s=t.$createElement,i=t._self._c||s;return i("el-scrollbar",{attrs:{"wrap-class":"scrollbar-wrapper"}},[i("div",{staticClass:"box-setting"},[i("div",{staticClass:"setting-row"},[i("div",{staticClass:"setting-item"},[i("div",{staticClass:"header"},[i("span",[t._v("✳ "+t._s(t._f("lang")("生成模式")))]),i("el-tooltip",{attrs:{effect:"dark",content:"自动模式只需要写歌曲描述，会自动生成歌曲和歌词，专业模式需要写歌词",placement:"bottom"}},[i("i",{staticClass:"el-icon-warning-outline tips"})])],1),i("div",{staticClass:"options"},[i("el-radio-group",{attrs:{size:"small"},model:{value:t.options.custom_mode,callback:function(s){t.$set(t.options,"custom_mode",s)},expression:"options.custom_mode"}},[i("el-radio-button",{attrs:{label:0}},[t._v("灵感模式")]),i("el-radio-button",{attrs:{label:1}},[t._v("专业模式")])],1)],1)])]),i("div",{staticClass:"setting-row"},[i("div",{staticClass:"setting-item"},[i("div",{staticClass:"header"},[i("span",[t._v("✳ "+t._s(t._f("lang")("类型")))])]),i("div",{staticClass:"options"},[i("el-radio-group",{attrs:{size:"small"},model:{value:t.options.make_instrumental,callback:function(s){t.$set(t.options,"make_instrumental",s)},expression:"options.make_instrumental"}},[i("el-radio-button",{attrs:{label:0}},[t._v("歌曲")]),i("el-radio-button",{attrs:{label:1}},[t._v("纯音乐")])],1)],1)])]),0===t.options.custom_mode?i("div",{staticClass:"setting-row"},[i("div",{staticClass:"setting-item"},[i("div",{staticClass:"header"},[i("span",[t._v("✳ "+t._s(t._f("lang")("歌曲描述（必填）")))])]),i("div",{staticClass:"options",staticStyle:{position:"relative"}},[i("el-input",{ref:"messageInput",attrs:{placeholder:t._f("lang")("输入文字描述，自动生成音乐"),type:"textarea",autofocus:!0,autosize:{minRows:4,maxRows:8},maxlength:"200","show-word-limit":""},model:{value:t.options.prompt,callback:function(s){t.$set(t.options,"prompt",s)},expression:"options.prompt"}})],1)])]):t._e(),1===t.options.custom_mode?i("div",[i("div",{staticClass:"setting-row"},[i("div",{staticClass:"setting-item"},[i("div",{staticClass:"header"},[i("span",[t._v("✳ "+t._s(t._f("lang")("歌名（选填）")))])]),i("div",{staticClass:"options"},[i("el-input",{staticStyle:{width:"420px"},attrs:{type:"text",placeholder:t._f("lang")("请输入歌曲名称"),size:"normal"},model:{value:t.options.title,callback:function(s){t.$set(t.options,"title",s)},expression:"options.title"}}),i("div",{staticStyle:{clear:"both"}})],1)])]),i("div",{staticClass:"setting-row"},[i("div",{staticClass:"setting-item"},[i("div",{staticClass:"header"},[i("span",[t._v("✳ "+t._s(t._f("lang")("曲风（选填）")))])]),i("div",{staticClass:"options",staticStyle:{position:"relative"}},[i("el-input",{ref:"messageInput",attrs:{placeholder:t._f("lang")("比如：摇滚、柔和、轻快、沧桑等"),type:"textarea",autofocus:!0,autosize:{minRows:3,maxRows:8},maxlength:"120","show-word-limit":""},model:{value:t.options.tags,callback:function(s){t.$set(t.options,"tags",s)},expression:"options.tags"}})],1)])]),0===t.options.make_instrumental?i("div",{staticClass:"setting-row"},[i("div",{staticClass:"setting-item"},[i("div",{staticClass:"header"},[i("span",[t._v("✳ "+t._s(t._f("lang")("自定义歌词（必填）")))]),t.writing?i("el-button",{attrs:{type:"primary",plain:"",size:"mini",title:"所有参数恢复默认"},on:{click:t.stopMakeLyric}},[t._v("停止生成")]):i("el-button",{attrs:{type:"primary",plain:"",size:"mini",title:"所有参数恢复默认"},on:{click:t.showMakeLyric}},[t._v("AI写歌词")])],1),i("div",{staticClass:"options",staticStyle:{position:"relative"}},[i("el-input",{ref:"messageInput",attrs:{placeholder:t._f("lang")("输入自定义歌词"),type:"textarea",autofocus:!0,autosize:{minRows:6,maxRows:20},maxlength:"1200","show-word-limit":""},model:{value:t.options.prompt,callback:function(s){t.$set(t.options,"prompt",s)},expression:"options.prompt"}})],1)])]):t._e()]):t._e(),t.makeLyricShow?i("div",[i("el-dialog",{attrs:{"custom-class":"my-dialog",title:t._f("lang")("生成歌词"),width:"620px",visible:!0,"close-on-click-modal":!1,"append-to-body":!0,"before-close":t.closeMakeLyric}},[i("el-form",{ref:"form",staticStyle:{padding:"20px 0"},attrs:{model:t.lyricForm,"label-width":"100px"}},[i("el-form-item",{attrs:{label:t._f("lang")("写作要求")}},[i("el-input",{staticStyle:{width:"430px"},attrs:{id:"lyric",type:"textarea",rows:8,placeholder:t._f("lang")("请输入歌词要求"),size:"normal"},model:{value:t.lyricForm.prompt,callback:function(s){t.$set(t.lyricForm,"prompt",s)},expression:"lyricForm.prompt"}})],1)],1),i("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{attrs:{type:"default",icon:"el-icon-close",size:"small"},on:{click:t.closeMakeLyric}},[t._v(t._s(t._f("lang")("取 消")))]),i("el-button",{attrs:{type:"primary",icon:"el-icon-check",size:"small"},on:{click:t.startMakeLyric}},[t._v(t._s(t._f("lang")("开始生成")))])],1)],1)],1):t._e(),i("div",{staticClass:"setting-row"},[i("div",{staticClass:"setting-item"},[i("div",{staticClass:"header"},[i("span",[t._v("✳ "+t._s(t._f("lang")("排除风格")))])]),i("div",{staticClass:"options"},[i("el-input",{staticStyle:{width:"420px"},attrs:{type:"text",placeholder:t._f("lang")("请输入想从音乐中排除的内容"),size:"normal"},model:{value:t.options.negative_tags,callback:function(s){t.$set(t.options,"negative_tags",s)},expression:"options.negative_tags"}}),i("div",{staticStyle:{clear:"both"}})],1)])])])])},h=[],_=(i("390d"),i("114b")),y=new _["a"],b={data:function(){return{defaultOptions:{custom_mode:0,make_instrumental:0,title:"",prompt:"",tags:"",negative_tags:""},options:{},lyricForm:{prompt:""},makeLyricShow:!1,writing:!1}},created:function(){this.init()},methods:{init:function(){this.options=JSON.parse(JSON.stringify(this.defaultOptions))},optionChange:function(t,s){this.$set(this.options,t,s)},getMusicOptions:function(){return JSON.parse(JSON.stringify(this.options))},clearMusicOptions:function(){this.options.title="",this.options.prompt="",this.options.tags="",this.options.negative_tags=""},setMusicOptions:function(t){t=Object.assign(this.defaultOptions,t),this.options=JSON.parse(JSON.stringify(t))},showMakeLyric:function(){this.makeLyricShow=!0;var t="";this.options.title&&(t+="歌名："+this.options.title+"\n"),this.options.tags&&(t+="曲风："+this.options.tags+"\n"),this.lyricForm={prompt:t}},closeMakeLyric:function(){this.makeLyricShow=!1},startMakeLyric:function(){if(!this.writing&&!this.writingText){var t="正在生成...",s=this.options.prompt,i=this.lyricForm.prompt;if(i){this.options.prompt=t,document.getElementById("lyric").focus(),this.writing=!0,this.scrollLyricBottom(),this.closeMakeLyric();var e=this;y.onMessage=function(s){if(s){if(e.options.prompt===t&&(e.options.prompt=""),""===e.options.prompt&&" "===s)return;e.options.prompt+=s,e.scrollLyricBottom()}},y.onError=function(t){e.writing=!1,e.options.prompt=s,-1!==t.indexOf("请登录")?(e.$modals.showLogin(),setTimeout((function(){e.$message.error(e.$lang(t))}),500)):-1!==t.indexOf("请充值")?(e.$modals.showPay("point"),setTimeout((function(){e.$message.error(e.$lang(t))}),500)):e.$alert(t,"系统提示")},y.onFinish=function(){e.writing=!1},y.request({tool:"lyric",message:i})}else this.$message.error("请输入歌词要求")}},scrollLyricBottom:function(){this.$nextTick((function(){}))},stopMakeLyric:function(){this.writing=!1,y.stop()}}},C=b,w=(i("e2aa"),i("ecd4"),i("76b2")),S=Object(w["a"])(C,v,h,!1,null,"5c18e589",null),x=S.exports,k=function(){var t=this,s=t.$createElement,i=t._self._c||s;return i("div",{staticClass:"welcome"},[i("div",{staticClass:"nodata"},[i("img",{attrs:{src:"/static/img/draw_nodata.png"}}),i("p",{staticClass:"tips"},[t._v(t._s(t.desc))])])])},O=[],L={props:{desc:{type:String,default:""}}},T=L,$=(i("fe21"),Object(w["a"])(T,k,O,!1,null,"7fb6223f",null)),M=$.exports,P=function(){var t=this,s=t.$createElement,i=t._self._c||s;return i("div",[0===t.music.state?i("div",[t.result&&t.result.video_url?i("div",{staticClass:"video"},[i("img",{staticClass:"thumb",attrs:{src:t.result.image_url}}),i("div",{staticClass:"btn-play"},[i("svg-icon",{attrs:{"icon-class":"ic_music_play"}})],1)]):i("div",{staticClass:"writing"},[i("music-loading",{attrs:{title:t._f("lang")("生成中，预计需要1-3分钟左右"),color:"#04BABE","text-color":"#999"}})],1)]):1===t.music.state?i("div",[t.result&&t.result.video_url?i("div",{staticClass:"video"},[i("img",{staticClass:"thumb",attrs:{src:t.result.image_url}}),i("div",{staticClass:"btn-play"},[i("svg-icon",{attrs:{"icon-class":"ic_music_play"}})],1)]):i("div",{staticClass:"writing fail"},[i("div",{staticClass:"errmsg"},[i("i",{staticClass:"el-icon-error"}),i("span",{staticStyle:{"max-width":"460px"}},[t._v(t._s(t._f("lang")("生成失败")))])])])]):2===t.music.state?i("div",{staticClass:"writing fail"},[i("div",{staticClass:"errmsg"},[i("i",{staticClass:"el-icon-error"}),i("span",{staticStyle:{"max-width":"460px"}},[t._v(t._s(t.music.errmsg||"生成失败")+" ")])]),i("div",[i("span",{staticClass:"btn-retry",on:{click:function(s){return t.retry(t.music.music_id)}}},[t._v(t._s(t._f("lang")("重新生成")))])])]):t._e()])},j=[],z=function(){var t=this,s=t.$createElement,i=t._self._c||s;return i("div",{staticClass:"loading"},[i("div",{staticClass:"fox-spinner"},[i("div",{staticClass:"spinner-inner",style:"color:"+t.color},[i("div",{staticClass:"spinner-line"}),i("div",{staticClass:"spinner-line"}),i("div",{staticClass:"spinner-line"}),i("div",{staticClass:"spinner-circle"},[t._v(" ● ")])])]),t.title?i("div",{staticClass:"title",style:"color:"+t.textColor},[t._v(t._s(t.title))]):t._e()])},I=[],E={name:"Loading",props:{title:{type:String,default:""},color:{type:String,default:"#04BABE"},textColor:{type:String,default:"#999"}},data:function(){return{}}},B=E,R=(i("8743"),Object(w["a"])(B,z,I,!1,null,"127b3e4f",null)),F=R.exports,A=i("4e9e"),N=i.n(A),D={components:{musicLoading:F},props:{music:{type:Object,default:function(){return{}}},result:{type:Object/String,default:function(){return{}}}},methods:{previewImage:function(t){this.$emit("preview",t)},retry:function(t){this.$emit("retry",t)},download:function(t){N.a.saveAs(t,"video.mp4")}}},J=D,U=(i("29bb"),Object(w["a"])(J,P,j,!1,null,"461c5eaa",null)),H=U.exports,q=function(){var t=this,s=t.$createElement,i=t._self._c||s;return i("div",[i("el-dialog",{attrs:{"custom-class":"my-dialog",title:"播放音乐",visible:!0,width:"520px","show-close":!0,"append-to-body":!0,"before-close":t.closeMusic}},[i("div",{staticClass:"container"},[i("div",{staticClass:"video"},[i("video",{staticClass:"uni-video-video",staticStyle:{"object-fit":"contain"},attrs:{src:t.music.result.video_url,loop:"",autoplay:"",playsinline:"",controls:"",disablepictureinpicture:"",controlslist:"nodownload noplaybackrate","play-btn-position":"center"}})]),i("div",{staticClass:"tools"},[i("div",{staticClass:"btn-group"},[i("el-button",{attrs:{size:"small",type:"primary",icon:"el-icon-document-copy",title:"复用参数，生成同款音乐"},on:{click:t.copyOptions}},[t._v("复制参数")]),t.music.result.video_url?i("el-button",{attrs:{size:"small",type:"default",icon:"el-icon-download"},on:{click:function(s){return t.download("video")}}},[t._v("下载mp4视频")]):t._e(),t.music.result.audio_url?i("el-button",{attrs:{size:"small",type:"default",icon:"el-icon-download"},on:{click:function(s){return t.download("audio")}}},[t._v("下载mp3音频")]):t._e(),t.music.result.prompt?i("el-button",{attrs:{size:"small",type:"default",icon:"el-icon-document-copy"},on:{click:function(s){return t.copyText(t.music.result.prompt)}}},[t._v("复制歌词")]):t._e()],1),t.music.seed?i("span",{staticStyle:{"font-size":"12px",color:"#898989",float:"right"},attrs:{title:"种子值 --seed"}},[i("svg-icon",{staticClass:"icon",attrs:{"icon-class":"ic_seed"}}),t._v(" "+t._s(t.music.seed))],1):t._e()])])])],1)},X=[],V={props:{music:{type:Object,default:function(){return{}}}},methods:{closeMusic:function(){this.$emit("close")},download:function(t){var s="";"video"===t?s=this.music.result.video_url:"audio"===t&&(s=this.music.result.audio_url);var i=s.split("/").pop();N.a.saveAs(s,i)},copyOptions:function(){this.$emit("copyOptions",this.music.music_id),this.closeMusic()},copyText:function(t){var s=this;this.$copyText(t).then((function(){s.$message.success(s.$lang("已复制"))}),(function(){s.$message.error(s.$lang("复制失败，请重试"))}))}}},G=V,K=(i("e589"),Object(w["a"])(G,q,X,!1,null,"7713c78d",null)),Q=K.exports,W=i("b140"),Y={name:"Music",components:{musicSuno:x,musicItem:H,welcome:M,musicDetail:Q,pages:W["a"]},data:function(){return{activePlatform:"pika",listType:"public",publicList:[],publicPage:1,publicPageSize:30,publicTotalCount:0,myList:[],page:1,pagesize:10,activeMusic:null,sunoSetting:{},tiangongSetting:{},user_balance_music:0,is_share:!0}},computed:Object(o["a"])(Object(o["a"])({},Object(n["b"])(["user_id","avatar","nickname","priceSetting"])),{},{userAvatar:function(){return this.avatar||"/static/img/ic_user.png"},aiAvatar:function(){return"/static/img/ic_ai.png"},publicPageTotal:function(){return Math.ceil(this.publicTotalCount/this.publicPageSize)},musicShopIsOpen:function(){return"suno"===this.activePlatform?!!this.sunoSetting["shop_open"]:"tiangong"===this.activePlatform&&!!this.tiangongSetting["shop_open"]}}),created:function(){var t=Object(c["b"])("musicListType");t&&(this.listType=t),this.getMusicSetting(),this.getUserBalance()},methods:{switchPlatform:function(t){this.activePlatform=t,this.publicPage=1,this.publicTotalCount=0,this.publicList=[],this.musicShopIsOpen?this.getPublicList():this.switchListType("my"),this.getHistoryMsg()},switchListType:function(t){this.listType=t,Object(c["g"])("musicListType",t)},getMusicSetting:function(){var t=this;p().then((function(s){t.sunoSetting=s.data.suno,t.sunoSetting["is_open"]&&t.switchPlatform("suno")})).catch((function(s){-1!==s.message.indexOf("已停用")&&setTimeout((function(){t.$router.push({name:"chat"})}),500)}))},getUserBalance:function(){var t=this;Object(l["i"])().then((function(s){t.user_balance_music=s.data.balance_music}))},submitTask:function(){var t=this,s=this.getMusicOptions();if(0===s.custom_mode){if(!s.prompt)return void this.$message.error("请输入歌曲描述");s.title="",s.tags=""}else{if(!s.make_instrumental&&!s.prompt)return void this.$message.error("请输入自定义歌词");1===s.make_instrumental&&(s.prompt="")}u({platform:this.activePlatform,options:JSON.stringify(s)}).then((function(i){t.switchListType("my"),t.myList.push({state:0,music_id:i.data.music_id,action:s.action,create_time:i.data.create_time,platform:t.activePlatform,options:i.data.options,result1:"",result2:""}),t.clearOptions(),setTimeout((function(){t.startLoopResult(i.data.music_id)}),1e3),t.getUserBalance(),setTimeout((function(){t.scrollBottom()}),500)})).catch((function(s){403===s.errno?t.$modals.showLogin():-1!==s.message.indexOf("充值")&&(t.showPay(),setTimeout((function(){t.$message.error(s.message)}),500))}))},startLoopResult:function(t){var s=this;setTimeout((function(){g({music_id:t}).then((function(i){var e=i.data.state;if(-1!==e)if(0!==e){if(1===e||2===e){var a=s.myList;a.forEach((function(s,o){s.music_id===t&&(a[o].state=e,1===e?(a[o].result1=i.data.result1,a[o].result2=i.data.result2):2===e&&(a[o].errmsg=i.data.message))})),s.myList=a,setTimeout((function(){s.getUserBalance()}),300)}}else s.startLoopResult(t)})).catch((function(){s.startLoopResult(t)}))}),1e4)},retryMusic:function(t){var s=this;u({music_id:t}).then((function(i){var e=s.myList;e.forEach((function(i,a){i.music_id===t&&(e[a].state=0,e[a].errmsg="",setTimeout((function(){s.startLoopResult(t)}),1e3))})),s.myList=e,s.getUserBalance()}))},getHistoryMsg:function(){var t=this;d({platform:this.activePlatform,page:this.page,pagesize:this.pagesize}).then((function(s){if(s.data.length>0){var i=s.data;i&&i.forEach((function(s,i){0!==s.state&&3!==s.state||t.startLoopResult(s.music_id)})),t.myList=i}setTimeout((function(){t.scrollBottom()}),500)}))},getPublicList:function(){var t=this;f({page:this.publicPage,pagesize:this.publicPageSize,platform:this.activePlatform}).then((function(s){t.publicList=s.data.list,t.publicTotalCount=s.data.count,t.$nextTick((function(){if(t.$refs["publicList"]){var s=t.$refs["publicList"].wrap;setTimeout((function(){s.scrollTop=0}),200)}}))}))},changePublicPage:function(t){this.publicPage=t,this.getPublicList()},getMusicOptions:function(){var t={};return this.$refs.musicSetting&&(t=this.$refs.musicSetting.getMusicOptions()),t},clearOptions:function(){this.$refs.musicSetting&&this.$refs.musicSetting.clearMusicOptions()},copyOptions:function(t){var s=this;this.closeMusicDetail(),m({type:"my",music_id:t}).then((function(t){var i=t.data.options;i.action="generate",s.setMusicOptions(i)})).catch((function(t){-1!==t.message.indexOf("请登录")&&s.$modals.showLogin()}))},scrollBottom:function(){var t=this;this.$nextTick((function(){if(t.$refs["myList"]){var s=t.$refs["myList"].wrap;setTimeout((function(){s.scrollTop=s.scrollHeight}),200)}}))},showPay:function(){this.priceSetting.music_vip?this.$modals.showPay("vip"):this.$modals.showPay("point")},showUserInfo:function(){this.$modals.showUserInfo()},showMusicDetail:function(t,s){t.result=t[s],this.activeMusic=t},closeMusicDetail:function(){this.activeMusic=null},setMusicOptions:function(t){this.$refs.musicSetting.setMusicOptions(t)}}},Z=Y,tt=(i("0bcf"),Object(w["a"])(Z,e,a,!1,null,"1c64ec38",null));s["default"]=tt.exports},e0bc:function(t,s,i){},e2aa:function(t,s,i){"use strict";i("82d7")},e589:function(t,s,i){"use strict";i("63d1")},ecd4:function(t,s,i){"use strict";i("5c9b")},fe21:function(t,s,i){"use strict";i("1b76")}}]);